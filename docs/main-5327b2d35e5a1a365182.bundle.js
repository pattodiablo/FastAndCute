(()=>{"use strict";var e,t,s,i={792:(e,t,s)=>{var i=s(440),a=s.n(i);class n extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"OpenChestanimation",a??"OpenChestAnimation0001.png"),this.setInteractive({useHandCursor:!0}),this.on("pointerdown",()=>{this.IsOpen||this.isOpening||this.OpenChest()}),this.OpenChestSound=this.scene.sound.add("chestOpening"),this.CloseChestSound=this.scene.sound.add("closeChest"),this.scene.addFx(this.OpenChestSound)}IsOpen=!1;isOpening=!1;OpenChestSound;CloseChestSound;OpenChest(){this.isOpening=!0,this.play("OpenChest"),this.scene.time.delayedCall(1500,()=>this.OpenChestSound?.play()),this.once("animationcomplete-OpenChest",()=>{this.scene.player.startMoving(),this.IsOpen=!0,this.scene.events.emit("chest-opened",this),this.scene.add.particles(0,0,"BubbleParticle",{x:this.x,y:this.y,speed:{min:100,max:250},angle:{min:0,max:360},lifespan:{min:1e3,max:4e3},scale:{start:0,end:1},quantity:20,maxParticles:20,frequency:0,gravityY:-100})})}resetChest(){this.IsOpen=!1,this.isOpening=!1,this.play("CloseChest"),this.CloseChestSound?.play()}}class r extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"DoorShine",a??"DoorShine0018.png"),this.setInteractive(new Phaser.Geom.Rectangle(0,0,92,136),Phaser.Geom.Rectangle.Contains),e.physics.add.existing(this,!1),this.body.moves=!1,this.body.allowGravity=!1,this.body.allowDrag=!1,this.body.allowRotation=!1,this.body.pushable=!1,this.body.immovable=!0,this.body.setSize(92,136,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}IsOpen=!1;shineTimer;IsVisible=!1;AppearDoorSound;create(){this.AppearDoorSound=this.scene.sound.add("DoorAppear"),this.scene.addFx(this.AppearDoorSound),this.scene.physics.add.overlap(this.scene.player,this,this.OpenDoor,void 0,this),this.IsVisible||(this.setVisible(!1),this.body.enable=!1)}OpenDoor(e,t){this.IsOpen||(this.IsOpen=!0,this.play("OpenDoor"),e.CompleteLevel(this.x,this.y),e.body.enable=!1)}AppearDoor(){console.log("Aparece la puerta"),this.IsVisible||(this.IsVisible=!0,this.setVisible(!0),this.body.enable=!0,this.play("DoorAppear"),this.AppearDoorSound?.play(),this.once("animationcomplete-DoorAppear",()=>{this.IsOpen||this.startShineLoop()}))}startShineLoop(){if(this.shineTimer)return;const e=()=>{this.IsOpen?this.shineTimer&&(this.shineTimer.remove(),this.shineTimer=void 0):(this.play("DoorShine"),this.once("animationcomplete-DoorShine",()=>{this.setTexture("DoorShine"),this.setFrame(0),this.shineTimer=this.scene.time.delayedCall(Phaser.Math.Between(5e3,1e4),e,[],this)}))};e()}}if("undefined"!=typeof window&&window.Phaser){let e=window.require;window.require=t=>e?e(t):"Phaser"===t?window.Phaser:void 0}const o="spine";class l{entries={};size=0;add(e){let t=this.entries[e];return this.entries[e]=!0,!t&&(this.size++,!0)}addAll(e){let t=this.size;for(var s=0,i=e.length;s<i;s++)this.add(e[s]);return t!=this.size}contains(e){return this.entries[e]}clear(){this.entries={},this.size=0}}class h{r;g;b;a;static WHITE=new h(1,1,1,1);static RED=new h(1,0,0,1);static GREEN=new h(0,1,0,1);static BLUE=new h(0,0,1,1);static MAGENTA=new h(1,0,1,1);constructor(e=0,t=0,s=0,i=0){this.r=e,this.g=t,this.b=s,this.a=i}set(e,t,s,i){return this.r=e,this.g=t,this.b=s,this.a=i,this.clamp()}setFromColor(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}setFromString(e){return e="#"==e.charAt(0)?e.substr(1):e,this.r=parseInt(e.substr(0,2),16)/255,this.g=parseInt(e.substr(2,2),16)/255,this.b=parseInt(e.substr(4,2),16)/255,this.a=8!=e.length?1:parseInt(e.substr(6,2),16)/255,this}add(e,t,s,i){return this.r+=e,this.g+=t,this.b+=s,this.a+=i,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(e,t){e.r=((4278190080&t)>>>24)/255,e.g=((16711680&t)>>>16)/255,e.b=((65280&t)>>>8)/255,e.a=(255&t)/255}static rgb888ToColor(e,t){e.r=((16711680&t)>>>16)/255,e.g=((65280&t)>>>8)/255,e.b=(255&t)/255}static fromString(e){return(new h).setFromString(e)}}class c{static PI=3.1415927;static PI2=2*c.PI;static radiansToDegrees=180/c.PI;static radDeg=c.radiansToDegrees;static degreesToRadians=c.PI/180;static degRad=c.degreesToRadians;static clamp(e,t,s){return e<t?t:e>s?s:e}static cosDeg(e){return Math.cos(e*c.degRad)}static sinDeg(e){return Math.sin(e*c.degRad)}static signum(e){return e>0?1:e<0?-1:0}static toInt(e){return e>0?Math.floor(e):Math.ceil(e)}static cbrt(e){let t=Math.pow(Math.abs(e),1/3);return e<0?-t:t}static randomTriangular(e,t){return c.randomTriangularWith(e,t,.5*(e+t))}static randomTriangularWith(e,t,s){let i=Math.random(),a=t-e;return i<=(s-e)/a?e+Math.sqrt(i*a*(s-e)):t-Math.sqrt((1-i)*a*(t-s))}static isPowerOfTwo(e){return e&&!(e&e-1)}}class d{static SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;static arrayCopy(e,t,s,i,a){for(let n=t,r=i;n<t+a;n++,r++)s[r]=e[n]}static arrayFill(e,t,s,i){for(let a=t;a<s;a++)e[a]=i}static setArraySize(e,t,s=0){let i=e.length;if(i==t)return e;if(e.length=t,i<t)for(let a=i;a<t;a++)e[a]=s;return e}static ensureArrayCapacity(e,t,s=0){return e.length>=t?e:d.setArraySize(e,t,s)}static newArray(e,t){let s=new Array(e);for(let i=0;i<e;i++)s[i]=t;return s}static newFloatArray(e){if(d.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);{let t=new Array(e);for(let e=0;e<t.length;e++)t[e]=0;return t}}static newShortArray(e){if(d.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);{let t=new Array(e);for(let e=0;e<t.length;e++)t[e]=0;return t}}static toFloatArray(e){return d.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}static toSinglePrecision(e){return d.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}static webkit602BugfixHelper(e,t){}static contains(e,t,s=!0){for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1}static enumValue(e,t){return e[t[0].toUpperCase()+t.slice(1)]}}class u{items=new Array;instantiator;constructor(e){this.instantiator=e}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(e){e.reset&&e.reset(),this.items.push(e)}freeAll(e){for(let t=0;t<e.length;t++)this.free(e[t])}clear(){this.items.length=0}}class g{x;y;constructor(e=0,t=0){this.x=e,this.y=t}set(e,t){return this.x=e,this.y=t,this}length(){let e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}normalize(){let e=this.length();return 0!=e&&(this.x/=e,this.y/=e),this}}class m{name;constructor(e){if(!e)throw new Error("name cannot be null.");this.name=e}}class p extends m{static nextID=0;id=p.nextID++;bones=null;vertices=[];worldVerticesLength=0;timelineAttachment=this;constructor(e){super(e)}computeWorldVertices(e,t,s,i,a,n){s=a+(s>>1)*n;let r=e.bone.skeleton,o=e.deform,l=this.vertices,h=this.bones;if(!h){o.length>0&&(l=o);let r=e.bone,h=r.worldX,c=r.worldY,d=r.a,u=r.b,g=r.c,m=r.d;for(let e=t,r=a;r<s;e+=2,r+=n){let t=l[e],s=l[e+1];i[r]=t*d+s*u+h,i[r+1]=t*g+s*m+c}return}let c=0,d=0;for(let e=0;e<t;e+=2){let e=h[c];c+=e+1,d+=e}let u=r.bones;if(0==o.length)for(let e=a,t=3*d;e<s;e+=n){let s=0,a=0,n=h[c++];for(n+=c;c<n;c++,t+=3){let e=u[h[c]],i=l[t],n=l[t+1],r=l[t+2];s+=(i*e.a+n*e.b+e.worldX)*r,a+=(i*e.c+n*e.d+e.worldY)*r}i[e]=s,i[e+1]=a}else{let e=o;for(let t=a,r=3*d,o=d<<1;t<s;t+=n){let s=0,a=0,n=h[c++];for(n+=c;c<n;c++,r+=3,o+=2){let t=u[h[c]],i=l[r]+e[o],n=l[r+1]+e[o+1],d=l[r+2];s+=(i*t.a+n*t.b+t.worldX)*d,a+=(i*t.c+n*t.d+t.worldY)*d}i[t]=s,i[t+1]=a}}}copyTo(e){this.bones?(e.bones=new Array(this.bones.length),d.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,this.vertices&&(e.vertices=d.newFloatArray(this.vertices.length),d.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)),e.worldVerticesLength=this.worldVerticesLength,e.timelineAttachment=this.timelineAttachment}}class f{static _nextID=0;id=f.nextID();regions;start=0;digits=0;setupIndex=0;constructor(e){this.regions=new Array(e)}copy(){let e=new f(this.regions.length);return d.arrayCopy(this.regions,0,e.regions,0,this.regions.length),e.start=this.start,e.digits=this.digits,e.setupIndex=this.setupIndex,e}apply(e,t){let s=e.sequenceIndex;-1==s&&(s=this.setupIndex),s>=this.regions.length&&(s=this.regions.length-1);let i=this.regions[s];t.region!=i&&(t.region=i,t.updateRegion())}getPath(e,t){let s=e,i=(this.start+t).toString();for(let e=this.digits-i.length;e>0;e--)s+="0";return s+=i,s}static nextID(){return f._nextID++}}var y;!function(e){e[e.hold=0]="hold",e[e.once=1]="once",e[e.loop=2]="loop",e[e.pingpong=3]="pingpong",e[e.onceReverse=4]="onceReverse",e[e.loopReverse=5]="loopReverse",e[e.pingpongReverse=6]="pingpongReverse"}(y||(y={}));const w=[y.hold,y.once,y.loop,y.pingpong,y.onceReverse,y.loopReverse,y.pingpongReverse];class x{name;timelines=[];timelineIds=new l;duration;constructor(e,t,s){if(!e)throw new Error("name cannot be null.");this.name=e,this.setTimelines(t),this.duration=s}setTimelines(e){if(!e)throw new Error("timelines cannot be null.");this.timelines=e,this.timelineIds.clear();for(var t=0;t<e.length;t++)this.timelineIds.addAll(e[t].getPropertyIds())}hasTimeline(e){for(let t=0;t<e.length;t++)if(this.timelineIds.contains(e[t]))return!0;return!1}apply(e,t,s,i,a,n,r,o){if(!e)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(s%=this.duration,t>0&&(t%=this.duration));let l=this.timelines;for(let i=0,h=l.length;i<h;i++)l[i].apply(e,t,s,a,n,r,o)}}var b,v;!function(e){e[e.setup=0]="setup",e[e.first=1]="first",e[e.replace=2]="replace",e[e.add=3]="add"}(b||(b={})),function(e){e[e.mixIn=0]="mixIn",e[e.mixOut=1]="mixOut"}(v||(v={}));class k{propertyIds;frames;constructor(e,t){this.propertyIds=t,this.frames=d.newFloatArray(e*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(e,t){let s=e.length;for(let i=1;i<s;i++)if(e[i]>t)return i-1;return s-1}static search(e,t,s){let i=e.length;for(let a=s;a<i;a+=s)if(e[a]>t)return a-s;return i-s}}class S extends k{curves;constructor(e,t,s){super(e,s),this.curves=d.newFloatArray(e+18*t),this.curves[e-1]=1}setLinear(e){this.curves[e]=0}setStepped(e){this.curves[e]=1}shrink(e){let t=this.getFrameCount()+18*e;if(this.curves.length>t){let e=d.newFloatArray(t);d.arrayCopy(this.curves,0,e,0,t),this.curves=e}}setBezier(e,t,s,i,a,n,r,o,l,h,c){let d=this.curves,u=this.getFrameCount()+18*e;0==s&&(d[t]=2+u);let g=.03*(i-2*n+o),m=.03*(a-2*r+l),p=.006*(3*(n-o)-i+h),f=.006*(3*(r-l)-a+c),y=2*g+p,w=2*m+f,x=.3*(n-i)+g+.16666667*p,b=.3*(r-a)+m+.16666667*f,v=i+x,k=a+b;for(let e=u+18;u<e;u+=2)d[u]=v,d[u+1]=k,x+=y,b+=w,y+=p,w+=f,v+=x,k+=b}getBezierValue(e,t,s,i){let a=this.curves;if(a[i]>e){let n=this.frames[t],r=this.frames[t+s];return r+(e-n)/(a[i]-n)*(a[i+1]-r)}let n=i+18;for(i+=2;i<n;i+=2)if(a[i]>=e){let t=a[i-2],s=a[i-1];return s+(e-t)/(a[i]-t)*(a[i+1]-s)}t+=this.getFrameEntries();let r=a[n-2],o=a[n-1];return o+(e-r)/(this.frames[t]-r)*(this.frames[t+s]-o)}}class C extends S{constructor(e,t,s){super(e,t,[s])}getFrameEntries(){return 2}setFrame(e,t,s){e<<=1,this.frames[e]=t,this.frames[e+1]=s}getCurveValue(e){let t=this.frames,s=t.length-2;for(let i=2;i<=s;i+=2)if(t[i]>e){s=i-2;break}let i=this.curves[s>>1];switch(i){case 0:let i=t[s],a=t[s+1];return a+(e-i)/(t[s+2]-i)*(t[s+2+1]-a);case 1:return t[s+1]}return this.getBezierValue(e,s,1,i-2)}}class T extends S{constructor(e,t,s,i){super(e,t,[s,i])}getFrameEntries(){return 3}setFrame(e,t,s,i){e*=3,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i}}class P extends C{boneIndex=0;constructor(e,t,s){super(e,t,"0|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.rotation=o.data.rotation);case b.first:o.rotation+=(o.data.rotation-o.rotation)*a}return}let l=this.getCurveValue(s);switch(n){case b.setup:o.rotation=o.data.rotation+l*a;break;case b.first:case b.replace:l+=o.data.rotation-o.rotation;case b.add:o.rotation+=l*a}}}class A extends T{boneIndex=0;constructor(e,t,s){super(e,t,"1|"+s,"2|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(n){case b.setup:return o.x=o.data.x,void(o.y=o.data.y);case b.first:o.x+=(o.data.x-o.x)*a,o.y+=(o.data.y-o.y)*a}return}let h=0,c=0,d=k.search(l,s,3),u=this.curves[d/3];switch(u){case 0:let e=l[d];h=l[d+1],c=l[d+2];let t=(s-e)/(l[d+3]-e);h+=(l[d+3+1]-h)*t,c+=(l[d+3+2]-c)*t;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,u-2),c=this.getBezierValue(s,d,2,u+18-2)}switch(n){case b.setup:o.x=o.data.x+h*a,o.y=o.data.y+c*a;break;case b.first:case b.replace:o.x+=(o.data.x+h-o.x)*a,o.y+=(o.data.y+c-o.y)*a;break;case b.add:o.x+=h*a,o.y+=c*a}}}class I extends C{boneIndex=0;constructor(e,t,s){super(e,t,"1|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.x=o.data.x);case b.first:o.x+=(o.data.x-o.x)*a}return}let l=this.getCurveValue(s);switch(n){case b.setup:o.x=o.data.x+l*a;break;case b.first:case b.replace:o.x+=(o.data.x+l-o.x)*a;break;case b.add:o.x+=l*a}}}class M extends C{boneIndex=0;constructor(e,t,s){super(e,t,"2|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.y=o.data.y);case b.first:o.y+=(o.data.y-o.y)*a}return}let l=this.getCurveValue(s);switch(n){case b.setup:o.y=o.data.y+l*a;break;case b.first:case b.replace:o.y+=(o.data.y+l-o.y)*a;break;case b.add:o.y+=l*a}}}class R extends T{boneIndex=0;constructor(e,t,s){super(e,t,"3|"+s,"4|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;let l,h,d=this.frames;if(s<d[0]){switch(n){case b.setup:return o.scaleX=o.data.scaleX,void(o.scaleY=o.data.scaleY);case b.first:o.scaleX+=(o.data.scaleX-o.scaleX)*a,o.scaleY+=(o.data.scaleY-o.scaleY)*a}return}let u=k.search(d,s,3),g=this.curves[u/3];switch(g){case 0:let e=d[u];l=d[u+1],h=d[u+2];let t=(s-e)/(d[u+3]-e);l+=(d[u+3+1]-l)*t,h+=(d[u+3+2]-h)*t;break;case 1:l=d[u+1],h=d[u+2];break;default:l=this.getBezierValue(s,u,1,g-2),h=this.getBezierValue(s,u,2,g+18-2)}if(l*=o.data.scaleX,h*=o.data.scaleY,1==a)n==b.add?(o.scaleX+=l-o.data.scaleX,o.scaleY+=h-o.data.scaleY):(o.scaleX=l,o.scaleY=h);else{let e=0,t=0;if(r==v.mixOut)switch(n){case b.setup:e=o.data.scaleX,t=o.data.scaleY,o.scaleX=e+(Math.abs(l)*c.signum(e)-e)*a,o.scaleY=t+(Math.abs(h)*c.signum(t)-t)*a;break;case b.first:case b.replace:e=o.scaleX,t=o.scaleY,o.scaleX=e+(Math.abs(l)*c.signum(e)-e)*a,o.scaleY=t+(Math.abs(h)*c.signum(t)-t)*a;break;case b.add:o.scaleX+=(l-o.data.scaleX)*a,o.scaleY+=(h-o.data.scaleY)*a}else switch(n){case b.setup:e=Math.abs(o.data.scaleX)*c.signum(l),t=Math.abs(o.data.scaleY)*c.signum(h),o.scaleX=e+(l-e)*a,o.scaleY=t+(h-t)*a;break;case b.first:case b.replace:e=Math.abs(o.scaleX)*c.signum(l),t=Math.abs(o.scaleY)*c.signum(h),o.scaleX=e+(l-e)*a,o.scaleY=t+(h-t)*a;break;case b.add:o.scaleX+=(l-o.data.scaleX)*a,o.scaleY+=(h-o.data.scaleY)*a}}}}class F extends C{boneIndex=0;constructor(e,t,s){super(e,t,"3|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.scaleX=o.data.scaleX);case b.first:o.scaleX+=(o.data.scaleX-o.scaleX)*a}return}let l=this.getCurveValue(s)*o.data.scaleX;if(1==a)n==b.add?o.scaleX+=l-o.data.scaleX:o.scaleX=l;else{let e=0;if(r==v.mixOut)switch(n){case b.setup:e=o.data.scaleX,o.scaleX=e+(Math.abs(l)*c.signum(e)-e)*a;break;case b.first:case b.replace:e=o.scaleX,o.scaleX=e+(Math.abs(l)*c.signum(e)-e)*a;break;case b.add:o.scaleX+=(l-o.data.scaleX)*a}else switch(n){case b.setup:e=Math.abs(o.data.scaleX)*c.signum(l),o.scaleX=e+(l-e)*a;break;case b.first:case b.replace:e=Math.abs(o.scaleX)*c.signum(l),o.scaleX=e+(l-e)*a;break;case b.add:o.scaleX+=(l-o.data.scaleX)*a}}}}class E extends C{boneIndex=0;constructor(e,t,s){super(e,t,"4|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.scaleY=o.data.scaleY);case b.first:o.scaleY+=(o.data.scaleY-o.scaleY)*a}return}let l=this.getCurveValue(s)*o.data.scaleY;if(1==a)n==b.add?o.scaleY+=l-o.data.scaleY:o.scaleY=l;else{let e=0;if(r==v.mixOut)switch(n){case b.setup:e=o.data.scaleY,o.scaleY=e+(Math.abs(l)*c.signum(e)-e)*a;break;case b.first:case b.replace:e=o.scaleY,o.scaleY=e+(Math.abs(l)*c.signum(e)-e)*a;break;case b.add:o.scaleY+=(l-o.data.scaleY)*a}else switch(n){case b.setup:e=Math.abs(o.data.scaleY)*c.signum(l),o.scaleY=e+(l-e)*a;break;case b.first:case b.replace:e=Math.abs(o.scaleY)*c.signum(l),o.scaleY=e+(l-e)*a;break;case b.add:o.scaleY+=(l-o.data.scaleY)*a}}}}class B extends T{boneIndex=0;constructor(e,t,s){super(e,t,"5|"+s,"6|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(n){case b.setup:return o.shearX=o.data.shearX,void(o.shearY=o.data.shearY);case b.first:o.shearX+=(o.data.shearX-o.shearX)*a,o.shearY+=(o.data.shearY-o.shearY)*a}return}let h=0,c=0,d=k.search(l,s,3),u=this.curves[d/3];switch(u){case 0:let e=l[d];h=l[d+1],c=l[d+2];let t=(s-e)/(l[d+3]-e);h+=(l[d+3+1]-h)*t,c+=(l[d+3+2]-c)*t;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,u-2),c=this.getBezierValue(s,d,2,u+18-2)}switch(n){case b.setup:o.shearX=o.data.shearX+h*a,o.shearY=o.data.shearY+c*a;break;case b.first:case b.replace:o.shearX+=(o.data.shearX+h-o.shearX)*a,o.shearY+=(o.data.shearY+c-o.shearY)*a;break;case b.add:o.shearX+=h*a,o.shearY+=c*a}}}class L extends C{boneIndex=0;constructor(e,t,s){super(e,t,"5|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.shearX=o.data.shearX);case b.first:o.shearX+=(o.data.shearX-o.shearX)*a}return}let l=this.getCurveValue(s);switch(n){case b.setup:o.shearX=o.data.shearX+l*a;break;case b.first:case b.replace:o.shearX+=(o.data.shearX+l-o.shearX)*a;break;case b.add:o.shearX+=l*a}}}class Y extends C{boneIndex=0;constructor(e,t,s){super(e,t,"6|"+s),this.boneIndex=s}apply(e,t,s,i,a,n,r){let o=e.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.shearY=o.data.shearY);case b.first:o.shearY+=(o.data.shearY-o.shearY)*a}return}let l=this.getCurveValue(s);switch(n){case b.setup:o.shearY=o.data.shearY+l*a;break;case b.first:case b.replace:o.shearY+=(o.data.shearY+l-o.shearY)*a;break;case b.add:o.shearY+=l*a}}}class O extends S{slotIndex=0;constructor(e,t,s){super(e,t,["7|"+s,"8|"+s]),this.slotIndex=s}getFrameEntries(){return 5}setFrame(e,t,s,i,a,n){e*=5,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=a,this.frames[e+4]=n}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(s<l[0]){let e=o.data.color;switch(n){case b.setup:return void h.setFromColor(e);case b.first:h.add((e.r-h.r)*a,(e.g-h.g)*a,(e.b-h.b)*a,(e.a-h.a)*a)}return}let c=0,d=0,u=0,g=0,m=k.search(l,s,5),p=this.curves[m/5];switch(p){case 0:let e=l[m];c=l[m+1],d=l[m+2],u=l[m+3],g=l[m+4];let t=(s-e)/(l[m+5]-e);c+=(l[m+5+1]-c)*t,d+=(l[m+5+2]-d)*t,u+=(l[m+5+3]-u)*t,g+=(l[m+5+4]-g)*t;break;case 1:c=l[m+1],d=l[m+2],u=l[m+3],g=l[m+4];break;default:c=this.getBezierValue(s,m,1,p-2),d=this.getBezierValue(s,m,2,p+18-2),u=this.getBezierValue(s,m,3,p+36-2),g=this.getBezierValue(s,m,4,p+54-2)}1==a?h.set(c,d,u,g):(n==b.setup&&h.setFromColor(o.data.color),h.add((c-h.r)*a,(d-h.g)*a,(u-h.b)*a,(g-h.a)*a))}}class X extends S{slotIndex=0;constructor(e,t,s){super(e,t,["7|"+s]),this.slotIndex=s}getFrameEntries(){return 4}setFrame(e,t,s,i,a){e<<=2,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=a}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(s<l[0]){let e=o.data.color;switch(n){case b.setup:return h.r=e.r,h.g=e.g,void(h.b=e.b);case b.first:h.r+=(e.r-h.r)*a,h.g+=(e.g-h.g)*a,h.b+=(e.b-h.b)*a}return}let c=0,d=0,u=0,g=k.search(l,s,4),m=this.curves[g>>2];switch(m){case 0:let e=l[g];c=l[g+1],d=l[g+2],u=l[g+3];let t=(s-e)/(l[g+4]-e);c+=(l[g+4+1]-c)*t,d+=(l[g+4+2]-d)*t,u+=(l[g+4+3]-u)*t;break;case 1:c=l[g+1],d=l[g+2],u=l[g+3];break;default:c=this.getBezierValue(s,g,1,m-2),d=this.getBezierValue(s,g,2,m+18-2),u=this.getBezierValue(s,g,3,m+36-2)}if(1==a)h.r=c,h.g=d,h.b=u;else{if(n==b.setup){let e=o.data.color;h.r=e.r,h.g=e.g,h.b=e.b}h.r+=(c-h.r)*a,h.g+=(d-h.g)*a,h.b+=(u-h.b)*a}}}class D extends C{slotIndex=0;constructor(e,t,s){super(e,t,"8|"+s),this.slotIndex=s}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];if(!o.bone.active)return;let l=o.color;if(s<this.frames[0]){let e=o.data.color;switch(n){case b.setup:return void(l.a=e.a);case b.first:l.a+=(e.a-l.a)*a}return}let h=this.getCurveValue(s);1==a?l.a=h:(n==b.setup&&(l.a=o.data.color.a),l.a+=(h-l.a)*a)}}class _ extends S{slotIndex=0;constructor(e,t,s){super(e,t,["7|"+s,"8|"+s,"9|"+s]),this.slotIndex=s}getFrameEntries(){return 8}setFrame(e,t,s,i,a,n,r,o,l){e<<=3,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=a,this.frames[e+4]=n,this.frames[e+5]=r,this.frames[e+6]=o,this.frames[e+7]=l}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(s<l[0]){let e=o.data.color,t=o.data.darkColor;switch(n){case b.setup:return h.setFromColor(e),c.r=t.r,c.g=t.g,void(c.b=t.b);case b.first:h.add((e.r-h.r)*a,(e.g-h.g)*a,(e.b-h.b)*a,(e.a-h.a)*a),c.r+=(t.r-c.r)*a,c.g+=(t.g-c.g)*a,c.b+=(t.b-c.b)*a}return}let d=0,u=0,g=0,m=0,p=0,f=0,y=0,w=k.search(l,s,8),x=this.curves[w>>3];switch(x){case 0:let e=l[w];d=l[w+1],u=l[w+2],g=l[w+3],m=l[w+4],p=l[w+5],f=l[w+6],y=l[w+7];let t=(s-e)/(l[w+8]-e);d+=(l[w+8+1]-d)*t,u+=(l[w+8+2]-u)*t,g+=(l[w+8+3]-g)*t,m+=(l[w+8+4]-m)*t,p+=(l[w+8+5]-p)*t,f+=(l[w+8+6]-f)*t,y+=(l[w+8+7]-y)*t;break;case 1:d=l[w+1],u=l[w+2],g=l[w+3],m=l[w+4],p=l[w+5],f=l[w+6],y=l[w+7];break;default:d=this.getBezierValue(s,w,1,x-2),u=this.getBezierValue(s,w,2,x+18-2),g=this.getBezierValue(s,w,3,x+36-2),m=this.getBezierValue(s,w,4,x+54-2),p=this.getBezierValue(s,w,5,x+72-2),f=this.getBezierValue(s,w,6,x+90-2),y=this.getBezierValue(s,w,7,x+108-2)}if(1==a)h.set(d,u,g,m),c.r=p,c.g=f,c.b=y;else{if(n==b.setup){h.setFromColor(o.data.color);let e=o.data.darkColor;c.r=e.r,c.g=e.g,c.b=e.b}h.add((d-h.r)*a,(u-h.g)*a,(g-h.b)*a,(m-h.a)*a),c.r+=(p-c.r)*a,c.g+=(f-c.g)*a,c.b+=(y-c.b)*a}}}class V extends S{slotIndex=0;constructor(e,t,s){super(e,t,["7|"+s,"9|"+s]),this.slotIndex=s}getFrameEntries(){return 7}setFrame(e,t,s,i,a,n,r,o){e*=7,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=a,this.frames[e+4]=n,this.frames[e+5]=r,this.frames[e+6]=o}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(s<l[0]){let e=o.data.color,t=o.data.darkColor;switch(n){case b.setup:return h.r=e.r,h.g=e.g,h.b=e.b,c.r=t.r,c.g=t.g,void(c.b=t.b);case b.first:h.r+=(e.r-h.r)*a,h.g+=(e.g-h.g)*a,h.b+=(e.b-h.b)*a,c.r+=(t.r-c.r)*a,c.g+=(t.g-c.g)*a,c.b+=(t.b-c.b)*a}return}let d=0,u=0,g=0,m=0,p=0,f=0,y=k.search(l,s,7),w=this.curves[y/7];switch(w){case 0:let e=l[y];d=l[y+1],u=l[y+2],g=l[y+3],m=l[y+4],p=l[y+5],f=l[y+6];let t=(s-e)/(l[y+7]-e);d+=(l[y+7+1]-d)*t,u+=(l[y+7+2]-u)*t,g+=(l[y+7+3]-g)*t,m+=(l[y+7+4]-m)*t,p+=(l[y+7+5]-p)*t,f+=(l[y+7+6]-f)*t;break;case 1:d=l[y+1],u=l[y+2],g=l[y+3],m=l[y+4],p=l[y+5],f=l[y+6];break;default:d=this.getBezierValue(s,y,1,w-2),u=this.getBezierValue(s,y,2,w+18-2),g=this.getBezierValue(s,y,3,w+36-2),m=this.getBezierValue(s,y,4,w+54-2),p=this.getBezierValue(s,y,5,w+72-2),f=this.getBezierValue(s,y,6,w+90-2)}if(1==a)h.r=d,h.g=u,h.b=g,c.r=m,c.g=p,c.b=f;else{if(n==b.setup){let e=o.data.color,t=o.data.darkColor;h.r=e.r,h.g=e.g,h.b=e.b,c.r=t.r,c.g=t.g,c.b=t.b}h.r+=(d-h.r)*a,h.g+=(u-h.g)*a,h.b+=(g-h.b)*a,c.r+=(m-c.r)*a,c.g+=(p-c.g)*a,c.b+=(f-c.b)*a}}}class U extends k{slotIndex=0;attachmentNames;constructor(e,t){super(e,["10|"+t]),this.slotIndex=t,this.attachmentNames=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t,s){this.frames[e]=t,this.attachmentNames[e]=s}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];o.bone.active&&(r!=v.mixOut?s<this.frames[0]?n!=b.setup&&n!=b.first||this.setAttachment(e,o,o.data.attachmentName):this.setAttachment(e,o,this.attachmentNames[k.search1(this.frames,s)]):n==b.setup&&this.setAttachment(e,o,o.data.attachmentName))}setAttachment(e,t,s){t.setAttachment(s?e.getAttachment(this.slotIndex,s):null)}}class N extends S{slotIndex=0;attachment;vertices;constructor(e,t,s,i){super(e,t,["11|"+s+"|"+i.id]),this.slotIndex=s,this.attachment=i,this.vertices=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t,s){this.frames[e]=t,this.vertices[e]=s}setBezier(e,t,s,i,a,n,r,o,l,h,c){let d=this.curves,u=this.getFrameCount()+18*e;0==s&&(d[t]=2+u);let g=.03*(i-2*n+o),m=.03*l-.06*r,p=.006*(3*(n-o)-i+h),f=.018*(r-l+.33333333),y=2*g+p,w=2*m+f,x=.3*(n-i)+g+.16666667*p,b=.3*r+m+.16666667*f,v=i+x,k=b;for(let e=u+18;u<e;u+=2)d[u]=v,d[u+1]=k,x+=y,b+=w,y+=p,w+=f,v+=x,k+=b}getCurvePercent(e,t){let s=this.curves,i=s[t];switch(i){case 0:let s=this.frames[t];return(e-s)/(this.frames[t+this.getFrameEntries()]-s);case 1:return 0}if(i-=2,s[i]>e){let a=this.frames[t];return s[i+1]*(e-a)/(s[i]-a)}let a=i+18;for(i+=2;i<a;i+=2)if(s[i]>=e){let t=s[i-2],a=s[i-1];return a+(e-t)/(s[i]-t)*(s[i+1]-a)}let n=s[a-2],r=s[a-1];return r+(1-r)*(e-n)/(this.frames[t+this.getFrameEntries()]-n)}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];if(!o.bone.active)return;let l=o.getAttachment();if(!l)return;if(!(l instanceof p)||l.timelineAttachment!=this.attachment)return;let h=o.deform;0==h.length&&(n=b.setup);let c=this.vertices,u=c[0].length,g=this.frames;if(s<g[0]){switch(n){case b.setup:return void(h.length=0);case b.first:if(1==a)return void(h.length=0);h.length=u;let e=l;if(e.bones)for(a=1-a,m=0;m<u;m++)h[m]*=a;else{let t=e.vertices;for(var m=0;m<u;m++)h[m]+=(t[m]-h[m])*a}}return}if(h.length=u,s>=g[g.length-1]){let e=c[g.length-1];if(1==a)if(n==b.add){let t=l;if(t.bones)for(let t=0;t<u;t++)h[t]+=e[t];else{let s=t.vertices;for(let t=0;t<u;t++)h[t]+=e[t]-s[t]}}else d.arrayCopy(e,0,h,0,u);else switch(n){case b.setup:{let t=l;if(t.bones)for(let t=0;t<u;t++)h[t]=e[t]*a;else{let s=t.vertices;for(let t=0;t<u;t++){let i=s[t];h[t]=i+(e[t]-i)*a}}break}case b.first:case b.replace:for(let t=0;t<u;t++)h[t]+=(e[t]-h[t])*a;break;case b.add:let t=l;if(t.bones)for(let t=0;t<u;t++)h[t]+=e[t]*a;else{let s=t.vertices;for(let t=0;t<u;t++)h[t]+=(e[t]-s[t])*a}}return}let f=k.search1(g,s),y=this.getCurvePercent(s,f),w=c[f],x=c[f+1];if(1==a)if(n==b.add){let e=l;if(e.bones)for(let e=0;e<u;e++){let t=w[e];h[e]+=t+(x[e]-t)*y}else{let t=e.vertices;for(let e=0;e<u;e++){let s=w[e];h[e]+=s+(x[e]-s)*y-t[e]}}}else for(let e=0;e<u;e++){let t=w[e];h[e]=t+(x[e]-t)*y}else switch(n){case b.setup:{let e=l;if(e.bones)for(let e=0;e<u;e++){let t=w[e];h[e]=(t+(x[e]-t)*y)*a}else{let t=e.vertices;for(let e=0;e<u;e++){let s=w[e],i=t[e];h[e]=i+(s+(x[e]-s)*y-i)*a}}break}case b.first:case b.replace:for(let e=0;e<u;e++){let t=w[e];h[e]+=(t+(x[e]-t)*y-h[e])*a}break;case b.add:let e=l;if(e.bones)for(let e=0;e<u;e++){let t=w[e];h[e]+=(t+(x[e]-t)*y)*a}else{let t=e.vertices;for(let e=0;e<u;e++){let s=w[e];h[e]+=(s+(x[e]-s)*y-t[e])*a}}}}}class G extends k{static propertyIds=["12"];events;constructor(e){super(e,G.propertyIds),this.events=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t){this.frames[e]=t.time,this.events[e]=t}apply(e,t,s,i,a,n,r){if(!i)return;let o=this.frames,l=this.frames.length;if(t>s)this.apply(e,t,Number.MAX_VALUE,i,a,n,r),t=-1;else if(t>=o[l-1])return;if(s<o[0])return;let h=0;if(t<o[0])h=0;else{h=k.search1(o,t)+1;let e=o[h];for(;h>0&&o[h-1]==e;)h--}for(;h<l&&s>=o[h];h++)i.push(this.events[h])}}class W extends k{static propertyIds=["13"];drawOrders;constructor(e){super(e,W.propertyIds),this.drawOrders=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t,s){this.frames[e]=t,this.drawOrders[e]=s}apply(e,t,s,i,a,n,r){if(r==v.mixOut)return void(n==b.setup&&d.arrayCopy(e.slots,0,e.drawOrder,0,e.slots.length));if(s<this.frames[0])return void(n!=b.setup&&n!=b.first||d.arrayCopy(e.slots,0,e.drawOrder,0,e.slots.length));let o=k.search1(this.frames,s),l=this.drawOrders[o];if(l){let t=e.drawOrder,s=e.slots;for(let e=0,i=l.length;e<i;e++)t[e]=s[l[e]]}else d.arrayCopy(e.slots,0,e.drawOrder,0,e.slots.length)}}class q extends S{ikConstraintIndex=0;constructor(e,t,s){super(e,t,["14|"+s]),this.ikConstraintIndex=s}getFrameEntries(){return 6}setFrame(e,t,s,i,a,n,r){e*=6,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=a,this.frames[e+4]=n?1:0,this.frames[e+5]=r?1:0}apply(e,t,s,i,a,n,r){let o=e.ikConstraints[this.ikConstraintIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(n){case b.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case b.first:o.mix+=(o.data.mix-o.mix)*a,o.softness+=(o.data.softness-o.softness)*a,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}return}let h=0,c=0,d=k.search(l,s,6),u=this.curves[d/6];switch(u){case 0:let e=l[d];h=l[d+1],c=l[d+2];let t=(s-e)/(l[d+6]-e);h+=(l[d+6+1]-h)*t,c+=(l[d+6+2]-c)*t;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,u-2),c=this.getBezierValue(s,d,2,u+18-2)}n==b.setup?(o.mix=o.data.mix+(h-o.data.mix)*a,o.softness=o.data.softness+(c-o.data.softness)*a,r==v.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=l[d+3],o.compress=0!=l[d+4],o.stretch=0!=l[d+5])):(o.mix+=(h-o.mix)*a,o.softness+=(c-o.softness)*a,r==v.mixIn&&(o.bendDirection=l[d+3],o.compress=0!=l[d+4],o.stretch=0!=l[d+5]))}}class H extends S{transformConstraintIndex=0;constructor(e,t,s){super(e,t,["15|"+s]),this.transformConstraintIndex=s}getFrameEntries(){return 7}setFrame(e,t,s,i,a,n,r,o){let l=this.frames;l[e*=7]=t,l[e+1]=s,l[e+2]=i,l[e+3]=a,l[e+4]=n,l[e+5]=r,l[e+6]=o}apply(e,t,s,i,a,n,r){let o=e.transformConstraints[this.transformConstraintIndex];if(!o.active)return;let l,h,c,d,u,g,m=this.frames;if(s<m[0]){let e=o.data;switch(n){case b.setup:return o.mixRotate=e.mixRotate,o.mixX=e.mixX,o.mixY=e.mixY,o.mixScaleX=e.mixScaleX,o.mixScaleY=e.mixScaleY,void(o.mixShearY=e.mixShearY);case b.first:o.mixRotate+=(e.mixRotate-o.mixRotate)*a,o.mixX+=(e.mixX-o.mixX)*a,o.mixY+=(e.mixY-o.mixY)*a,o.mixScaleX+=(e.mixScaleX-o.mixScaleX)*a,o.mixScaleY+=(e.mixScaleY-o.mixScaleY)*a,o.mixShearY+=(e.mixShearY-o.mixShearY)*a}return}let p=k.search(m,s,7),f=this.curves[p/7];switch(f){case 0:let e=m[p];l=m[p+1],h=m[p+2],c=m[p+3],d=m[p+4],u=m[p+5],g=m[p+6];let t=(s-e)/(m[p+7]-e);l+=(m[p+7+1]-l)*t,h+=(m[p+7+2]-h)*t,c+=(m[p+7+3]-c)*t,d+=(m[p+7+4]-d)*t,u+=(m[p+7+5]-u)*t,g+=(m[p+7+6]-g)*t;break;case 1:l=m[p+1],h=m[p+2],c=m[p+3],d=m[p+4],u=m[p+5],g=m[p+6];break;default:l=this.getBezierValue(s,p,1,f-2),h=this.getBezierValue(s,p,2,f+18-2),c=this.getBezierValue(s,p,3,f+36-2),d=this.getBezierValue(s,p,4,f+54-2),u=this.getBezierValue(s,p,5,f+72-2),g=this.getBezierValue(s,p,6,f+90-2)}if(n==b.setup){let e=o.data;o.mixRotate=e.mixRotate+(l-e.mixRotate)*a,o.mixX=e.mixX+(h-e.mixX)*a,o.mixY=e.mixY+(c-e.mixY)*a,o.mixScaleX=e.mixScaleX+(d-e.mixScaleX)*a,o.mixScaleY=e.mixScaleY+(u-e.mixScaleY)*a,o.mixShearY=e.mixShearY+(g-e.mixShearY)*a}else o.mixRotate+=(l-o.mixRotate)*a,o.mixX+=(h-o.mixX)*a,o.mixY+=(c-o.mixY)*a,o.mixScaleX+=(d-o.mixScaleX)*a,o.mixScaleY+=(u-o.mixScaleY)*a,o.mixShearY+=(g-o.mixShearY)*a}}class z extends C{pathConstraintIndex=0;constructor(e,t,s){super(e,t,"16|"+s),this.pathConstraintIndex=s}apply(e,t,s,i,a,n,r){let o=e.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.position=o.data.position);case b.first:o.position+=(o.data.position-o.position)*a}return}let l=this.getCurveValue(s);n==b.setup?o.position=o.data.position+(l-o.data.position)*a:o.position+=(l-o.position)*a}}class j extends C{pathConstraintIndex=0;constructor(e,t,s){super(e,t,"17|"+s),this.pathConstraintIndex=s}apply(e,t,s,i,a,n,r){let o=e.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(n){case b.setup:return void(o.spacing=o.data.spacing);case b.first:o.spacing+=(o.data.spacing-o.spacing)*a}return}let l=this.getCurveValue(s);n==b.setup?o.spacing=o.data.spacing+(l-o.data.spacing)*a:o.spacing+=(l-o.spacing)*a}}class $ extends S{pathConstraintIndex=0;constructor(e,t,s){super(e,t,["18|"+s]),this.pathConstraintIndex=s}getFrameEntries(){return 4}setFrame(e,t,s,i,a){let n=this.frames;n[e<<=2]=t,n[e+1]=s,n[e+2]=i,n[e+3]=a}apply(e,t,s,i,a,n,r){let o=e.pathConstraints[this.pathConstraintIndex];if(!o.active)return;let l,h,c,d=this.frames;if(s<d[0]){switch(n){case b.setup:return o.mixRotate=o.data.mixRotate,o.mixX=o.data.mixX,void(o.mixY=o.data.mixY);case b.first:o.mixRotate+=(o.data.mixRotate-o.mixRotate)*a,o.mixX+=(o.data.mixX-o.mixX)*a,o.mixY+=(o.data.mixY-o.mixY)*a}return}let u=k.search(d,s,4),g=this.curves[u>>2];switch(g){case 0:let e=d[u];l=d[u+1],h=d[u+2],c=d[u+3];let t=(s-e)/(d[u+4]-e);l+=(d[u+4+1]-l)*t,h+=(d[u+4+2]-h)*t,c+=(d[u+4+3]-c)*t;break;case 1:l=d[u+1],h=d[u+2],c=d[u+3];break;default:l=this.getBezierValue(s,u,1,g-2),h=this.getBezierValue(s,u,2,g+18-2),c=this.getBezierValue(s,u,3,g+36-2)}if(n==b.setup){let e=o.data;o.mixRotate=e.mixRotate+(l-e.mixRotate)*a,o.mixX=e.mixX+(h-e.mixX)*a,o.mixY=e.mixY+(c-e.mixY)*a}else o.mixRotate+=(l-o.mixRotate)*a,o.mixX+=(h-o.mixX)*a,o.mixY+=(c-o.mixY)*a}}class J extends k{static ENTRIES=3;static MODE=1;static DELAY=2;slotIndex;attachment;constructor(e,t,s){super(e,["19|"+t+"|"+s.sequence.id]),this.slotIndex=t,this.attachment=s}getFrameEntries(){return J.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(e,t,s,i,a){let n=this.frames;n[e*=J.ENTRIES]=t,n[e+J.MODE]=s|i<<4,n[e+J.DELAY]=a}apply(e,t,s,i,a,n,r){let o=e.slots[this.slotIndex];if(!o.bone.active)return;let l=o.attachment,h=this.attachment;if(!(l==h||l instanceof p&&l.timelineAttachment==h))return;let c=this.frames;if(s<c[0])return void(n!=b.setup&&n!=b.first||(o.sequenceIndex=-1));let d=k.search(c,s,J.ENTRIES),u=c[d],g=c[d+J.MODE],m=c[d+J.DELAY];if(!this.attachment.sequence)return;let f=g>>4,x=this.attachment.sequence.regions.length,v=w[15&g];if(v!=y.hold)switch(f+=(s-u)/m+1e-5|0,v){case y.once:f=Math.min(x-1,f);break;case y.loop:f%=x;break;case y.pingpong:{let e=(x<<1)-2;f=0==e?0:f%e,f>=x&&(f=e-f);break}case y.onceReverse:f=Math.max(x-1-f,0);break;case y.loopReverse:f=x-1-f%x;break;case y.pingpongReverse:{let e=(x<<1)-2;f=0==e?0:(f+x-1)%e,f>=x&&(f=e-f)}}o.sequenceIndex=f}}class Q{static _emptyAnimation=new x("<empty>",[],0);static emptyAnimation(){return Q._emptyAnimation}data;tracks=new Array;timeScale=1;unkeyedState=0;events=new Array;listeners=new Array;queue=new Z(this);propertyIDs=new l;animationsChanged=!1;trackEntryPool=new u(()=>new K);constructor(e){this.data=e}update(e){e*=this.timeScale;let t=this.tracks;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(!i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let a=e*i.timeScale;if(i.delay>0){if(i.delay-=a,i.delay>0)continue;a=-i.delay,i.delay=0}let n=i.next;if(n){let t=i.trackLast-n.delay;if(t>=0){for(n.delay=0,n.trackTime+=0==i.timeScale?0:(t/i.timeScale+e)*n.timeScale,i.trackTime+=a,this.setCurrent(s,n,!0);n.mixingFrom;)n.mixTime+=e,n=n.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&!i.mixingFrom){t[s]=null,this.queue.end(i),this.clearNext(i);continue}if(i.mixingFrom&&this.updateMixingFrom(i,e)){let e=i.mixingFrom;for(i.mixingFrom=null,e&&(e.mixingTo=null);e;)this.queue.end(e),e=e.mixingFrom}i.trackTime+=a}this.queue.drain()}updateMixingFrom(e,t){let s=e.mixingFrom;if(!s)return!0;let i=this.updateMixingFrom(s,t);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,e.mixTime>0&&e.mixTime>=e.mixDuration?(0!=s.totalAlpha&&0!=e.mixDuration||(e.mixingFrom=s.mixingFrom,s.mixingFrom&&(s.mixingFrom.mixingTo=e),e.interruptAlpha=s.interruptAlpha,this.queue.end(s)),i):(s.trackTime+=t*s.timeScale,e.mixTime+=t,!1)}apply(e){if(!e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let t=this.events,s=this.tracks,i=!1;for(let n=0,r=s.length;n<r;n++){let r=s[n];if(!r||r.delay>0)continue;i=!0;let o=0==n?b.first:r.mixBlend,l=r.alpha;r.mixingFrom?l*=this.applyMixingFrom(r,e,o):r.trackTime>=r.trackEnd&&!r.next&&(l=0);let h=r.animationLast,c=r.getAnimationTime(),u=c,g=t;r.reverse&&(u=r.animation.duration-u,g=null);let m=r.animation.timelines,p=m.length;if(0==n&&1==l||o==b.add)for(let t=0;t<p;t++){d.webkit602BugfixHelper(l,o);var a=m[t];a instanceof U?this.applyAttachmentTimeline(a,e,u,o,!0):a.apply(e,h,u,g,l,o,v.mixIn)}else{let t=r.timelineMode,s=r.shortestRotation,i=!s&&r.timelinesRotation.length!=p<<1;i&&(r.timelinesRotation.length=p<<1);for(let a=0;a<p;a++){let n=m[a],c=t[a]==te?o:b.setup;!s&&n instanceof P?this.applyRotateTimeline(n,e,u,l,c,r.timelinesRotation,a<<1,i):n instanceof U?this.applyAttachmentTimeline(n,e,u,o,!0):(d.webkit602BugfixHelper(l,o),n.apply(e,h,u,g,l,c,v.mixIn))}}this.queueEvents(r,c),t.length=0,r.nextAnimationLast=c,r.nextTrackLast=r.trackTime}for(var n=this.unkeyedState+re,r=e.slots,o=0,l=e.slots.length;o<l;o++){var h=r[o];if(h.attachmentState==n){var c=h.data.attachmentName;h.setAttachment(c?e.getAttachment(h.data.index,c):null)}}return this.unkeyedState+=2,this.queue.drain(),i}applyMixingFrom(e,t,s){let i=e.mixingFrom;i.mixingFrom&&this.applyMixingFrom(i,t,s);let a=0;0==e.mixDuration?(a=1,s==b.first&&(s=b.setup)):(a=e.mixTime/e.mixDuration,a>1&&(a=1),s!=b.first&&(s=i.mixBlend));let n=a<i.attachmentThreshold,r=a<i.drawOrderThreshold,o=i.animation.timelines,l=o.length,h=i.alpha*e.interruptAlpha,c=h*(1-a),u=i.animationLast,g=i.getAnimationTime(),m=g,p=null;if(i.reverse?m=i.animation.duration-m:a<i.eventThreshold&&(p=this.events),s==b.add)for(let e=0;e<l;e++)o[e].apply(t,u,m,p,c,s,v.mixOut);else{let e=i.timelineMode,a=i.timelineHoldMix,g=i.shortestRotation,f=!g&&i.timelinesRotation.length!=l<<1;f&&(i.timelinesRotation.length=l<<1),i.totalAlpha=0;for(let y=0;y<l;y++){let l,w=o[y],x=v.mixOut,k=0;switch(e[y]){case te:if(!r&&w instanceof W)continue;l=s,k=c;break;case se:l=b.setup,k=c;break;case ie:l=s,k=h;break;case ae:l=b.setup,k=h;break;default:l=b.setup;let e=a[y];k=h*Math.max(0,1-e.mixTime/e.mixDuration)}i.totalAlpha+=k,!g&&w instanceof P?this.applyRotateTimeline(w,t,m,k,l,i.timelinesRotation,y<<1,f):w instanceof U?this.applyAttachmentTimeline(w,t,m,l,n):(d.webkit602BugfixHelper(k,s),r&&w instanceof W&&l==b.setup&&(x=v.mixIn),w.apply(t,u,m,p,k,l,x))}}return e.mixDuration>0&&this.queueEvents(i,g),this.events.length=0,i.nextAnimationLast=g,i.nextTrackLast=i.trackTime,a}applyAttachmentTimeline(e,t,s,i,a){var n=t.slots[e.slotIndex];n.bone.active&&(s<e.frames[0]?i!=b.setup&&i!=b.first||this.setAttachment(t,n,n.data.attachmentName,a):this.setAttachment(t,n,e.attachmentNames[k.search1(e.frames,s)],a),n.attachmentState<=this.unkeyedState&&(n.attachmentState=this.unkeyedState+re))}setAttachment(e,t,s,i){t.setAttachment(s?e.getAttachment(t.data.index,s):null),i&&(t.attachmentState=this.unkeyedState+oe)}applyRotateTimeline(e,t,s,i,a,n,r,o){if(o&&(n[r]=0),1==i)return void e.apply(t,0,s,null,1,a,v.mixIn);let l=t.bones[e.boneIndex];if(!l.active)return;let h=0,d=0;if(s<e.frames[0])switch(a){case b.setup:l.rotation=l.data.rotation;default:return;case b.first:h=l.rotation,d=l.data.rotation}else h=a==b.setup?l.data.rotation:l.rotation,d=l.data.rotation+e.getCurveValue(s);let u=0,g=d-h;if(g-=360*(16384-(16384.499999999996-g/360|0)),0==g)u=n[r];else{let e=0,t=0;o?(e=0,t=g):(e=n[r],t=n[r+1]);let s=g>0,i=e>=0;c.signum(t)!=c.signum(g)&&Math.abs(t)<=90&&(Math.abs(e)>180&&(e+=360*c.signum(e)),i=s),u=g+e-e%360,i!=s&&(u+=360*c.signum(e)),n[r]=u}n[r+1]=g,l.rotation=h+u*i}queueEvents(e,t){let s=e.animationStart,i=e.animationEnd,a=i-s,n=e.trackLast%a,r=this.events,o=0,l=r.length;for(;o<l;o++){let t=r[o];if(t.time<n)break;t.time>i||this.queue.event(e,t)}let h=!1;for(h=e.loop?0==a||n>e.trackTime%a:t>=i&&e.animationLast<i,h&&this.queue.complete(e);o<l;o++){let t=r[o];t.time<s||this.queue.event(e,t)}}clearTracks(){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,t=this.tracks.length;e<t;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=e,this.queue.drain()}clearTrack(e){if(e>=this.tracks.length)return;let t=this.tracks[e];if(!t)return;this.queue.end(t),this.clearNext(t);let s=t;for(;;){let e=s.mixingFrom;if(!e)break;this.queue.end(e),s.mixingFrom=null,s.mixingTo=null,s=e}this.tracks[t.trackIndex]=null,this.queue.drain()}setCurrent(e,t,s){let i=this.expandToIndex(e);this.tracks[e]=t,t.previous=null,i&&(s&&this.queue.interrupt(i),t.mixingFrom=i,i.mixingTo=t,t.mixTime=0,i.mixingFrom&&i.mixDuration>0&&(t.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(t)}setAnimation(e,t,s=!1){let i=this.data.skeletonData.findAnimation(t);if(!i)throw new Error("Animation not found: "+t);return this.setAnimationWith(e,i,s)}setAnimationWith(e,t,s=!1){if(!t)throw new Error("animation cannot be null.");let i=!0,a=this.expandToIndex(e);a&&(-1==a.nextTrackLast?(this.tracks[e]=a.mixingFrom,this.queue.interrupt(a),this.queue.end(a),this.clearNext(a),a=a.mixingFrom,i=!1):this.clearNext(a));let n=this.trackEntry(e,t,s,a);return this.setCurrent(e,n,i),this.queue.drain(),n}addAnimation(e,t,s=!1,i=0){let a=this.data.skeletonData.findAnimation(t);if(!a)throw new Error("Animation not found: "+t);return this.addAnimationWith(e,a,s,i)}addAnimationWith(e,t,s=!1,i=0){if(!t)throw new Error("animation cannot be null.");let a=this.expandToIndex(e);if(a)for(;a.next;)a=a.next;let n=this.trackEntry(e,t,s,a);return a?(a.next=n,n.previous=a,i<=0&&(i+=a.getTrackComplete()-n.mixDuration)):(this.setCurrent(e,n,!0),this.queue.drain()),n.delay=i,n}setEmptyAnimation(e,t=0){let s=this.setAnimationWith(e,Q.emptyAnimation(),!1);return s.mixDuration=t,s.trackEnd=t,s}addEmptyAnimation(e,t=0,s=0){let i=this.addAnimationWith(e,Q.emptyAnimation(),!1,s);return s<=0&&(i.delay+=i.mixDuration-t),i.mixDuration=t,i.trackEnd=t,i}setEmptyAnimations(e=0){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,s=this.tracks.length;t<s;t++){let s=this.tracks[t];s&&this.setEmptyAnimation(s.trackIndex,e)}this.queue.drainDisabled=t,this.queue.drain()}expandToIndex(e){return e<this.tracks.length?this.tracks[e]:(d.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)}trackEntry(e,t,s,i){let a=this.trackEntryPool.obtain();return a.reset(),a.trackIndex=e,a.animation=t,a.loop=s,a.holdPrevious=!1,a.reverse=!1,a.shortestRotation=!1,a.eventThreshold=0,a.attachmentThreshold=0,a.drawOrderThreshold=0,a.animationStart=0,a.animationEnd=t.duration,a.animationLast=-1,a.nextAnimationLast=-1,a.delay=0,a.trackTime=0,a.trackLast=-1,a.nextTrackLast=-1,a.trackEnd=Number.MAX_VALUE,a.timeScale=1,a.alpha=1,a.mixTime=0,a.mixDuration=i?this.data.getMix(i.animation,t):0,a.interruptAlpha=1,a.totalAlpha=0,a.mixBlend=b.replace,a}clearNext(e){let t=e.next;for(;t;)this.queue.dispose(t),t=t.next;e.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();let e=this.tracks;for(let t=0,s=e.length;t<s;t++){let s=e[t];if(s){for(;s.mixingFrom;)s=s.mixingFrom;do{s.mixingTo&&s.mixBlend==b.add||this.computeHold(s),s=s.mixingTo}while(s)}}}computeHold(e){let t=e.mixingTo,s=e.animation.timelines,i=e.animation.timelines.length,a=e.timelineMode;a.length=i;let n=e.timelineHoldMix;n.length=0;let r=this.propertyIDs;if(t&&t.holdPrevious)for(let e=0;e<i;e++)a[e]=r.addAll(s[e].getPropertyIds())?ae:ie;else e:for(let o=0;o<i;o++){let i=s[o],l=i.getPropertyIds();if(r.addAll(l))if(!t||i instanceof U||i instanceof W||i instanceof G||!t.animation.hasTimeline(l))a[o]=se;else{for(let s=t.mixingTo;s;s=s.mixingTo)if(!s.animation.hasTimeline(l)){if(e.mixDuration>0){a[o]=ne,n[o]=s;continue e}break}a[o]=ae}else a[o]=te}}getCurrent(e){return e>=this.tracks.length?null:this.tracks[e]}addListener(e){if(!e)throw new Error("listener cannot be null.");this.listeners.push(e)}removeListener(e){let t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}}class K{animation=null;previous=null;next=null;mixingFrom=null;mixingTo=null;listener=null;trackIndex=0;loop=!1;holdPrevious=!1;reverse=!1;shortestRotation=!1;eventThreshold=0;attachmentThreshold=0;drawOrderThreshold=0;animationStart=0;animationEnd=0;animationLast=0;nextAnimationLast=0;delay=0;trackTime=0;trackLast=0;nextTrackLast=0;trackEnd=0;timeScale=0;alpha=0;mixTime=0;mixDuration=0;interruptAlpha=0;totalAlpha=0;mixBlend=b.replace;timelineMode=new Array;timelineHoldMix=new Array;timelinesRotation=new Array;reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let e=this.animationEnd-this.animationStart;return 0==e?this.animationStart:this.trackTime%e+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(e){this.animationLast=e,this.nextAnimationLast=e}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){let e=this.animationEnd-this.animationStart;if(0!=e){if(this.loop)return e*(1+(this.trackTime/e|0));if(this.trackTime<e)return e}return this.trackTime}}class Z{objects=[];drainDisabled=!1;animState;constructor(e){this.animState=e}start(e){this.objects.push(ee.start),this.objects.push(e),this.animState.animationsChanged=!0}interrupt(e){this.objects.push(ee.interrupt),this.objects.push(e)}end(e){this.objects.push(ee.end),this.objects.push(e),this.animState.animationsChanged=!0}dispose(e){this.objects.push(ee.dispose),this.objects.push(e)}complete(e){this.objects.push(ee.complete),this.objects.push(e)}event(e,t){this.objects.push(ee.event),this.objects.push(e),this.objects.push(t)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let e=this.objects,t=this.animState.listeners;for(let s=0;s<e.length;s+=2){let i=e[s],a=e[s+1];switch(i){case ee.start:a.listener&&a.listener.start&&a.listener.start(a);for(let e=0;e<t.length;e++){let s=t[e];s.start&&s.start(a)}break;case ee.interrupt:a.listener&&a.listener.interrupt&&a.listener.interrupt(a);for(let e=0;e<t.length;e++){let s=t[e];s.interrupt&&s.interrupt(a)}break;case ee.end:a.listener&&a.listener.end&&a.listener.end(a);for(let e=0;e<t.length;e++){let s=t[e];s.end&&s.end(a)}case ee.dispose:a.listener&&a.listener.dispose&&a.listener.dispose(a);for(let e=0;e<t.length;e++){let s=t[e];s.dispose&&s.dispose(a)}this.animState.trackEntryPool.free(a);break;case ee.complete:a.listener&&a.listener.complete&&a.listener.complete(a);for(let e=0;e<t.length;e++){let s=t[e];s.complete&&s.complete(a)}break;case ee.event:let i=e[2+s++];a.listener&&a.listener.event&&a.listener.event(a,i);for(let e=0;e<t.length;e++){let s=t[e];s.event&&s.event(a,i)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var ee;!function(e){e[e.start=0]="start",e[e.interrupt=1]="interrupt",e[e.end=2]="end",e[e.dispose=3]="dispose",e[e.complete=4]="complete",e[e.event=5]="event"}(ee||(ee={}));const te=0,se=1,ie=2,ae=3,ne=4,re=1,oe=2;class le{skeletonData;animationToMixTime={};defaultMix=0;constructor(e){if(!e)throw new Error("skeletonData cannot be null.");this.skeletonData=e}setMix(e,t,s){let i=this.skeletonData.findAnimation(e);if(!i)throw new Error("Animation not found: "+e);let a=this.skeletonData.findAnimation(t);if(!a)throw new Error("Animation not found: "+t);this.setMixWith(i,a,s)}setMixWith(e,t,s){if(!e)throw new Error("from cannot be null.");if(!t)throw new Error("to cannot be null.");let i=e.name+"."+t.name;this.animationToMixTime[i]=s}getMix(e,t){let s=e.name+"."+t.name,i=this.animationToMixTime[s];return void 0===i?this.defaultMix:i}}class he extends p{color=new h(1,1,1,1);constructor(e){super(e)}copy(){let e=new he(this.name);return this.copyTo(e),e.color.setFromColor(this.color),e}}class ce extends p{endSlot=null;color=new h(.2275,.2275,.8078,1);constructor(e){super(e)}copy(){let e=new ce(this.name);return this.copyTo(e),e.endSlot=this.endSlot,e.color.setFromColor(this.color),e}}class de{_image;constructor(e){this._image=e}getImage(){return this._image}}var ue,ge,me,pe,fe,ye,we,xe,be;!function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.MipMap=9987]="MipMap",e[e.MipMapNearestNearest=9984]="MipMapNearestNearest",e[e.MipMapLinearNearest=9985]="MipMapLinearNearest",e[e.MipMapNearestLinear=9986]="MipMapNearestLinear",e[e.MipMapLinearLinear=9987]="MipMapLinearLinear"}(ue||(ue={})),function(e){e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.ClampToEdge=33071]="ClampToEdge",e[e.Repeat=10497]="Repeat"}(ge||(ge={}));class ve{texture;u=0;v=0;u2=0;v2=0;width=0;height=0;degrees=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0}class ke{pages=new Array;regions=new Array;constructor(e){let t=new Se(e),s=new Array(4),i={size:e=>{e.width=parseInt(s[1]),e.height=parseInt(s[2])},format:()=>{},filter:e=>{e.minFilter=d.enumValue(ue,s[1]),e.magFilter=d.enumValue(ue,s[2])},repeat:e=>{-1!=s[1].indexOf("x")&&(e.uWrap=ge.Repeat),-1!=s[1].indexOf("y")&&(e.vWrap=ge.Repeat)},pma:e=>{e.pma="true"==s[1]}};var a={xy:e=>{e.x=parseInt(s[1]),e.y=parseInt(s[2])},size:e=>{e.width=parseInt(s[1]),e.height=parseInt(s[2])},bounds:e=>{e.x=parseInt(s[1]),e.y=parseInt(s[2]),e.width=parseInt(s[3]),e.height=parseInt(s[4])},offset:e=>{e.offsetX=parseInt(s[1]),e.offsetY=parseInt(s[2])},orig:e=>{e.originalWidth=parseInt(s[1]),e.originalHeight=parseInt(s[2])},offsets:e=>{e.offsetX=parseInt(s[1]),e.offsetY=parseInt(s[2]),e.originalWidth=parseInt(s[3]),e.originalHeight=parseInt(s[4])},rotate:e=>{let t=s[1];"true"==t?e.degrees=90:"false"!=t&&(e.degrees=parseInt(t))},index:e=>{e.index=parseInt(s[1])}};let n=t.readLine();for(;n&&0==n.trim().length;)n=t.readLine();for(;n&&0!=n.trim().length&&0!=t.readEntry(s,n);)n=t.readLine();let r=null,o=null,l=null;for(;null!==n;)if(0==n.trim().length)r=null,n=t.readLine();else if(r){let e=new Te(r,n);for(;;){let i=t.readEntry(s,n=t.readLine());if(0==i)break;let r=a[s[0]];if(r)r(e);else{o||(o=[]),l||(l=[]),o.push(s[0]);let e=[];for(let t=0;t<i;t++)e.push(parseInt(s[t+1]));l.push(e)}}0==e.originalWidth&&0==e.originalHeight&&(e.originalWidth=e.width,e.originalHeight=e.height),o&&o.length>0&&l&&l.length>0&&(e.names=o,e.values=l,o=null,l=null),e.u=e.x/r.width,e.v=e.y/r.height,90==e.degrees?(e.u2=(e.x+e.height)/r.width,e.v2=(e.y+e.width)/r.height):(e.u2=(e.x+e.width)/r.width,e.v2=(e.y+e.height)/r.height),this.regions.push(e)}else{for(r=new Ce(n.trim());0!=t.readEntry(s,n=t.readLine());){let e=i[s[0]];e&&e(r)}this.pages.push(r)}}findRegion(e){for(let t=0;t<this.regions.length;t++)if(this.regions[t].name==e)return this.regions[t];return null}setTextures(e,t=""){for(let s of this.pages)s.setTexture(e.get(t+s.name))}dispose(){for(let e=0;e<this.pages.length;e++)this.pages[e].texture?.dispose()}}class Se{lines;index=0;constructor(e){this.lines=e.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(e,t){if(!t)return 0;if(0==(t=t.trim()).length)return 0;let s=t.indexOf(":");if(-1==s)return 0;e[0]=t.substr(0,s).trim();for(let i=1,a=s+1;;i++){let s=t.indexOf(",",a);if(-1==s)return e[i]=t.substr(a).trim(),i;if(e[i]=t.substr(a,s-a).trim(),a=s+1,4==i)return 4}}}class Ce{name;minFilter=ue.Nearest;magFilter=ue.Nearest;uWrap=ge.ClampToEdge;vWrap=ge.ClampToEdge;texture=null;width=0;height=0;pma=!1;regions=new Array;constructor(e){this.name=e}setTexture(e){this.texture=e,e.setFilters(this.minFilter,this.magFilter),e.setWraps(this.uWrap,this.vWrap);for(let t of this.regions)t.texture=e}}class Te extends ve{page;name;x=0;y=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0;index=0;degrees=0;names=null;values=null;constructor(e,t){super(),this.page=e,this.name=t,e.regions.push(this)}}class Pe extends p{region=null;path;regionUVs=[];uvs=[];triangles=[];color=new h(1,1,1,1);width=0;height=0;hullLength=0;edges=[];parentMesh=null;sequence=null;tempColor=new h(0,0,0,0);constructor(e,t){super(e),this.path=t}updateRegion(){if(!this.region)throw new Error("Region not set.");let e=this.regionUVs;this.uvs&&this.uvs.length==e.length||(this.uvs=d.newFloatArray(e.length));let t=this.uvs,s=this.uvs.length,i=this.region.u,a=this.region.v,n=0,r=0;if(this.region instanceof Te){let o=this.region,l=o.page.texture.getImage(),h=l.width,c=l.height;switch(o.degrees){case 90:i-=(o.originalHeight-o.offsetY-o.height)/h,a-=(o.originalWidth-o.offsetX-o.width)/c,n=o.originalHeight/h,r=o.originalWidth/c;for(let o=0;o<s;o+=2)t[o]=i+e[o+1]*n,t[o+1]=a+(1-e[o])*r;return;case 180:i-=(o.originalWidth-o.offsetX-o.width)/h,a-=o.offsetY/c,n=o.originalWidth/h,r=o.originalHeight/c;for(let o=0;o<s;o+=2)t[o]=i+(1-e[o])*n,t[o+1]=a+(1-e[o+1])*r;return;case 270:i-=o.offsetY/h,a-=o.offsetX/c,n=o.originalHeight/h,r=o.originalWidth/c;for(let o=0;o<s;o+=2)t[o]=i+(1-e[o+1])*n,t[o+1]=a+e[o]*r;return}i-=o.offsetX/h,a-=(o.originalHeight-o.offsetY-o.height)/c,n=o.originalWidth/h,r=o.originalHeight/c}else this.region?(n=this.region.u2-i,r=this.region.v2-a):(i=a=0,n=r=1);for(let o=0;o<s;o+=2)t[o]=i+e[o]*n,t[o+1]=a+e[o+1]*r}getParentMesh(){return this.parentMesh}setParentMesh(e){this.parentMesh=e,e&&(this.bones=e.bones,this.vertices=e.vertices,this.worldVerticesLength=e.worldVerticesLength,this.regionUVs=e.regionUVs,this.triangles=e.triangles,this.hullLength=e.hullLength,this.worldVerticesLength=e.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();let e=new Pe(this.name,this.path);return e.region=this.region,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),d.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),d.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),d.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,e.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(e.edges=new Array(this.edges.length),d.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e}computeWorldVertices(e,t,s,i,a,n){null!=this.sequence&&this.sequence.apply(e,this),super.computeWorldVertices(e,t,s,i,a,n)}newLinkedMesh(){let e=new Pe(this.name,this.path);return e.region=this.region,e.color.setFromColor(this.color),e.timelineAttachment=this.timelineAttachment,e.setParentMesh(this.parentMesh?this.parentMesh:this),null!=e.region&&e.updateRegion(),e}}class Ae extends p{lengths=[];closed=!1;constantSpeed=!1;color=new h(1,1,1,1);constructor(e){super(e)}copy(){let e=new Ae(this.name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),d.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e}}class Ie extends p{x=0;y=0;rotation=0;color=new h(.38,.94,0,1);constructor(e){super(e)}computeWorldPosition(e,t){return t.x=this.x*e.a+this.y*e.b+e.worldX,t.y=this.x*e.c+this.y*e.d+e.worldY,t}computeWorldRotation(e){let t=c.cosDeg(this.rotation),s=c.sinDeg(this.rotation),i=t*e.a+s*e.b,a=t*e.c+s*e.d;return Math.atan2(a,i)*c.radDeg}copy(){let e=new Ie(this.name);return e.x=this.x,e.y=this.y,e.rotation=this.rotation,e.color.setFromColor(this.color),e}}class Me extends m{x=0;y=0;scaleX=1;scaleY=1;rotation=0;width=0;height=0;color=new h(1,1,1,1);path;region=null;sequence=null;offset=d.newFloatArray(8);uvs=d.newFloatArray(8);tempColor=new h(1,1,1,1);constructor(e,t){super(e),this.path=t}updateRegion(){if(!this.region)throw new Error("Region not set.");let e=this.region,t=this.uvs;if(null==e)return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=1,t[5]=1,t[6]=1,void(t[7]=0);let s=this.width/this.region.originalWidth*this.scaleX,i=this.height/this.region.originalHeight*this.scaleY,a=-this.width/2*this.scaleX+this.region.offsetX*s,n=-this.height/2*this.scaleY+this.region.offsetY*i,r=a+this.region.width*s,o=n+this.region.height*i,l=this.rotation*Math.PI/180,h=Math.cos(l),c=Math.sin(l),d=this.x,u=this.y,g=a*h+d,m=a*c,p=n*h+u,f=n*c,y=r*h+d,w=r*c,x=o*h+u,b=o*c,v=this.offset;v[0]=g-f,v[1]=p+m,v[2]=g-b,v[3]=x+m,v[4]=y-b,v[5]=x+w,v[6]=y-f,v[7]=p+w,90==e.degrees?(t[0]=e.u2,t[1]=e.v2,t[2]=e.u,t[3]=e.v2,t[4]=e.u,t[5]=e.v,t[6]=e.u2,t[7]=e.v):(t[0]=e.u,t[1]=e.v2,t[2]=e.u,t[3]=e.v,t[4]=e.u2,t[5]=e.v,t[6]=e.u2,t[7]=e.v2)}computeWorldVertices(e,t,s,i){null!=this.sequence&&this.sequence.apply(e,this);let a=e.bone,n=this.offset,r=a.worldX,o=a.worldY,l=a.a,h=a.b,c=a.c,d=a.d,u=0,g=0;u=n[0],g=n[1],t[s]=u*l+g*h+r,t[s+1]=u*c+g*d+o,s+=i,u=n[2],g=n[3],t[s]=u*l+g*h+r,t[s+1]=u*c+g*d+o,s+=i,u=n[4],g=n[5],t[s]=u*l+g*h+r,t[s+1]=u*c+g*d+o,s+=i,u=n[6],g=n[7],t[s]=u*l+g*h+r,t[s+1]=u*c+g*d+o}copy(){let e=new Me(this.name,this.path);return e.region=this.region,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,d.arrayCopy(this.uvs,0,e.uvs,0,8),d.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e.sequence=null!=this.sequence?this.sequence.copy():null,e}static X1=0;static Y1=1;static C1R=2;static C1G=3;static C1B=4;static C1A=5;static U1=6;static V1=7;static X2=8;static Y2=9;static C2R=10;static C2G=11;static C2B=12;static C2A=13;static U2=14;static V2=15;static X3=16;static Y3=17;static C3R=18;static C3G=19;static C3B=20;static C3A=21;static U3=22;static V3=23;static X4=24;static Y4=25;static C4R=26;static C4G=27;static C4B=28;static C4A=29;static U4=30;static V4=31}class Re{atlas;constructor(e){this.atlas=e}loadSequence(e,t,s){let i=s.regions;for(let a=0,n=i.length;a<n;a++){let n=s.getPath(t,a),r=this.atlas.findRegion(n);if(null==r)throw new Error("Region not found in atlas: "+n+" (sequence: "+e+")");i[a]=r}}newRegionAttachment(e,t,s,i){let a=new Me(t,s);if(null!=i)this.loadSequence(t,s,i);else{let e=this.atlas.findRegion(s);if(!e)throw new Error("Region not found in atlas: "+s+" (region attachment: "+t+")");a.region=e}return a}newMeshAttachment(e,t,s,i){let a=new Pe(t,s);if(null!=i)this.loadSequence(t,s,i);else{let e=this.atlas.findRegion(s);if(!e)throw new Error("Region not found in atlas: "+s+" (mesh attachment: "+t+")");a.region=e}return a}newBoundingBoxAttachment(e,t){return new he(t)}newPathAttachment(e,t){return new Ae(t)}newPointAttachment(e,t){return new Ie(t)}newClippingAttachment(e,t){return new ce(t)}}class Fe{index=0;name;parent=null;length=0;x=0;y=0;rotation=0;scaleX=1;scaleY=1;shearX=0;shearY=0;transformMode=me.Normal;skinRequired=!1;color=new h;constructor(e,t,s){if(e<0)throw new Error("index must be >= 0.");if(!t)throw new Error("name cannot be null.");this.index=e,this.name=t,this.parent=s}}!function(e){e[e.Normal=0]="Normal",e[e.OnlyTranslation=1]="OnlyTranslation",e[e.NoRotationOrReflection=2]="NoRotationOrReflection",e[e.NoScale=3]="NoScale",e[e.NoScaleOrReflection=4]="NoScaleOrReflection"}(me||(me={}));class Ee{data;skeleton;parent=null;children=new Array;x=0;y=0;rotation=0;scaleX=0;scaleY=0;shearX=0;shearY=0;ax=0;ay=0;arotation=0;ascaleX=0;ascaleY=0;ashearX=0;ashearY=0;a=0;b=0;c=0;d=0;worldY=0;worldX=0;sorted=!1;active=!1;constructor(e,t,s){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.skeleton=t,this.parent=s,this.setToSetupPose()}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(e,t,s,i,a,n,r){this.ax=e,this.ay=t,this.arotation=s,this.ascaleX=i,this.ascaleY=a,this.ashearX=n,this.ashearY=r;let o=this.parent;if(!o){let o=this.skeleton,l=s+90+r,h=o.scaleX,d=o.scaleY;return this.a=c.cosDeg(s+n)*i*h,this.b=c.cosDeg(l)*a*h,this.c=c.sinDeg(s+n)*i*d,this.d=c.sinDeg(l)*a*d,this.worldX=e*h+o.x,void(this.worldY=t*d+o.y)}let l=o.a,h=o.b,d=o.c,u=o.d;switch(this.worldX=l*e+h*t+o.worldX,this.worldY=d*e+u*t+o.worldY,this.data.transformMode){case me.Normal:{let e=s+90+r,t=c.cosDeg(s+n)*i,o=c.cosDeg(e)*a,g=c.sinDeg(s+n)*i,m=c.sinDeg(e)*a;return this.a=l*t+h*g,this.b=l*o+h*m,this.c=d*t+u*g,void(this.d=d*o+u*m)}case me.OnlyTranslation:{let e=s+90+r;this.a=c.cosDeg(s+n)*i,this.b=c.cosDeg(e)*a,this.c=c.sinDeg(s+n)*i,this.d=c.sinDeg(e)*a;break}case me.NoRotationOrReflection:{let e=l*l+d*d,t=0;e>1e-4?(e=Math.abs(l*u-h*d)/e,l/=this.skeleton.scaleX,d/=this.skeleton.scaleY,h=d*e,u=l*e,t=Math.atan2(d,l)*c.radDeg):(l=0,d=0,t=90-Math.atan2(u,h)*c.radDeg);let o=s+n-t,g=s+r-t+90,m=c.cosDeg(o)*i,p=c.cosDeg(g)*a,f=c.sinDeg(o)*i,y=c.sinDeg(g)*a;this.a=l*m-h*f,this.b=l*p-h*y,this.c=d*m+u*f,this.d=d*p+u*y;break}case me.NoScale:case me.NoScaleOrReflection:{let e=c.cosDeg(s),t=c.sinDeg(s),o=(l*e+h*t)/this.skeleton.scaleX,g=(d*e+u*t)/this.skeleton.scaleY,m=Math.sqrt(o*o+g*g);m>1e-5&&(m=1/m),o*=m,g*=m,m=Math.sqrt(o*o+g*g),this.data.transformMode==me.NoScale&&l*u-h*d<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(m=-m);let p=Math.PI/2+Math.atan2(g,o),f=Math.cos(p)*m,y=Math.sin(p)*m,w=c.cosDeg(n)*i,x=c.cosDeg(90+r)*a,b=c.sinDeg(n)*i,v=c.sinDeg(90+r)*a;this.a=o*w+f*b,this.b=o*x+f*v,this.c=g*w+y*b,this.d=g*x+y*v;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.shearX=e.shearX,this.shearY=e.shearY}getWorldRotationX(){return Math.atan2(this.c,this.a)*c.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*c.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}updateAppliedTransform(){let e=this.parent;if(!e)return this.ax=this.worldX-this.skeleton.x,this.ay=this.worldY-this.skeleton.y,this.arotation=Math.atan2(this.c,this.a)*c.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*c.radDeg);let t=e.a,s=e.b,i=e.c,a=e.d,n=1/(t*a-s*i),r=this.worldX-e.worldX,o=this.worldY-e.worldY;this.ax=r*a*n-o*s*n,this.ay=o*t*n-r*i*n;let l=n*a,h=n*t,d=n*s,u=n*i,g=l*this.a-d*this.c,m=l*this.b-d*this.d,p=h*this.c-u*this.a,f=h*this.d-u*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(g*g+p*p),this.ascaleX>1e-4){let e=g*f-m*p;this.ascaleY=e/this.ascaleX,this.ashearY=Math.atan2(g*m+p*f,e)*c.radDeg,this.arotation=Math.atan2(p,g)*c.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(m*m+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,m)*c.radDeg}worldToLocal(e){let t=1/(this.a*this.d-this.b*this.c),s=e.x-this.worldX,i=e.y-this.worldY;return e.x=s*this.d*t-i*this.b*t,e.y=i*this.a*t-s*this.c*t,e}localToWorld(e){let t=e.x,s=e.y;return e.x=t*this.a+s*this.b+this.worldX,e.y=t*this.c+s*this.d+this.worldY,e}worldToLocalRotation(e){let t=c.sinDeg(e),s=c.cosDeg(e);return Math.atan2(this.a*t-this.c*s,this.d*s-this.b*t)*c.radDeg+this.rotation-this.shearX}localToWorldRotation(e){e-=this.rotation-this.shearX;let t=c.sinDeg(e),s=c.cosDeg(e);return Math.atan2(s*this.c+t*this.d,s*this.a+t*this.b)*c.radDeg}rotateWorld(e){let t=this.a,s=this.b,i=this.c,a=this.d,n=c.cosDeg(e),r=c.sinDeg(e);this.a=n*t-r*i,this.b=n*s-r*a,this.c=r*t+n*i,this.d=r*s+n*a}}class Be{data;bones;target;bendDirection=0;compress=!1;stretch=!1;mix=1;softness=0;active=!1;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.mix=e.mix,this.softness=e.softness,this.bendDirection=e.bendDirection,this.compress=e.compress,this.stretch=e.stretch,this.bones=new Array;for(let s=0;s<e.bones.length;s++){let i=t.findBone(e.bones[s].name);if(!i)throw new Error(`Couldn't find bone ${e.bones[s].name}`);this.bones.push(i)}let s=t.findBone(e.target.name);if(!s)throw new Error(`Couldn't find bone ${e.target.name}`);this.target=s}isActive(){return this.active}update(){if(0==this.mix)return;let e=this.target,t=this.bones;switch(t.length){case 1:this.apply1(t[0],e.worldX,e.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(t[0],t[1],e.worldX,e.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(e,t,s,i,a,n,r){let o=e.parent;if(!o)throw new Error("IK bone must have parent.");let l=o.a,h=o.b,d=o.c,u=o.d,g=-e.ashearX-e.arotation,m=0,p=0;switch(e.data.transformMode){case me.OnlyTranslation:m=(t-e.worldX)*c.signum(e.skeleton.scaleX),p=(s-e.worldY)*c.signum(e.skeleton.scaleY);break;case me.NoRotationOrReflection:let i=Math.abs(l*u-h*d)/Math.max(1e-4,l*l+d*d),a=l/e.skeleton.scaleX,n=d/e.skeleton.scaleY;h=-n*i*e.skeleton.scaleX,u=a*i*e.skeleton.scaleY,g+=Math.atan2(n,a)*c.radDeg;default:let r=t-o.worldX,f=s-o.worldY,y=l*u-h*d;Math.abs(y)<=1e-4?(m=0,p=0):(m=(r*u-f*h)/y-e.ax,p=(f*l-r*d)/y-e.ay)}g+=Math.atan2(p,m)*c.radDeg,e.ascaleX<0&&(g+=180),g>180?g-=360:g<-180&&(g+=360);let f=e.ascaleX,y=e.ascaleY;if(i||a){switch(e.data.transformMode){case me.NoScale:case me.NoScaleOrReflection:m=t-e.worldX,p=s-e.worldY}let o=e.data.length*f,l=Math.sqrt(m*m+p*p);if(i&&l<o||a&&l>o&&o>1e-4){let e=(l/o-1)*r+1;f*=e,n&&(y*=e)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+g*r,f,y,e.ashearX,e.ashearY)}apply2(e,t,s,i,a,n,r,o,l){let h=e.ax,d=e.ay,u=e.ascaleX,g=e.ascaleY,m=u,p=g,f=t.ascaleX,y=0,w=0,x=0;u<0?(u=-u,y=180,x=-1):(y=0,x=1),g<0&&(g=-g,x=-x),f<0?(f=-f,w=180):w=0;let b=t.ax,v=0,k=0,S=0,C=e.a,T=e.b,P=e.c,A=e.d,I=Math.abs(u-g)<=1e-4;!I||n?(v=0,k=C*b+e.worldX,S=P*b+e.worldY):(v=t.ay,k=C*b+T*v+e.worldX,S=P*b+A*v+e.worldY);let M=e.parent;if(!M)throw new Error("IK parent must itself have a parent.");C=M.a,T=M.b,P=M.c,A=M.d;let R=C*A-T*P,F=k-M.worldX,E=S-M.worldY;R=Math.abs(R)<=1e-4?0:1/R;let B,L,Y=(F*A-E*T)*R-h,O=(E*C-F*P)*R-d,X=Math.sqrt(Y*Y+O*O),D=t.data.length*f;if(X<1e-4)return this.apply1(e,s,i,!1,n,!1,l),void t.updateWorldTransformWith(b,v,0,t.ascaleX,t.ascaleY,t.ashearX,t.ashearY);F=s-M.worldX,E=i-M.worldY;let _=(F*A-E*T)*R-h,V=(E*C-F*P)*R-d,U=_*_+V*V;if(0!=o){o*=u*(f+1)*.5;let e=Math.sqrt(U),t=e-X-D*u+o;if(t>0){let s=Math.min(1,t/(2*o))-1;s=(t-o*(1-s*s))/e,_-=s*_,V-=s*V,U=_*_+V*V}}e:if(I){D*=u;let e=(U-X*X-D*D)/(2*X*D);e<-1?(e=-1,L=Math.PI*a):e>1?(e=1,L=0,n&&(C=(Math.sqrt(U)/(X+D)-1)*l+1,m*=C,r&&(p*=C))):L=Math.acos(e)*a,C=X+D*e,T=D*Math.sin(L),B=Math.atan2(V*C-_*T,_*C+V*T)}else{C=u*D,T=g*D;let e=C*C,t=T*T,s=Math.atan2(V,_);P=t*X*X+e*U-e*t;let i=-2*t*X,n=t-e;if(A=i*i-4*n*P,A>=0){let e=Math.sqrt(A);i<0&&(e=-e),e=.5*-(i+e);let t=e/n,r=P/e,o=Math.abs(t)<Math.abs(r)?t:r;if(o*o<=U){E=Math.sqrt(U-o*o)*a,B=s-Math.atan2(E,o),L=Math.atan2(E/g,(o-X)/u);break e}}let r=c.PI,o=X-C,l=o*o,h=0,d=0,m=X+C,p=m*m,f=0;P=-C*X/(e-t),P>=-1&&P<=1&&(P=Math.acos(P),F=C*Math.cos(P)+X,E=T*Math.sin(P),A=F*F+E*E,A<l&&(r=P,l=A,o=F,h=E),A>p&&(d=P,p=A,m=F,f=E)),U<=.5*(l+p)?(B=s-Math.atan2(h*a,o),L=r*a):(B=s-Math.atan2(f*a,m),L=d*a)}let N=Math.atan2(v,b)*x,G=e.arotation;B=(B-N)*c.radDeg+y-G,B>180?B-=360:B<-180&&(B+=360),e.updateWorldTransformWith(h,d,G+B*l,m,p,0,0),G=t.arotation,L=((L+N)*c.radDeg-t.ashearX)*x+w-G,L>180?L-=360:L<-180&&(L+=360),t.updateWorldTransformWith(b,v,G+L*l,t.ascaleX,t.ascaleY,t.ashearX,t.ashearY)}}class Le{name;order;skinRequired;constructor(e,t,s){this.name=e,this.order=t,this.skinRequired=s}}class Ye extends Le{bones=new Array;_target=null;set target(e){this._target=e}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}bendDirection=1;compress=!1;stretch=!1;uniform=!1;mix=1;softness=0;constructor(e){super(e,0,!1)}}class Oe extends Le{bones=new Array;_target=null;set target(e){this._target=e}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}positionMode=pe.Fixed;spacingMode=fe.Fixed;rotateMode=ye.Chain;offsetRotation=0;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;constructor(e){super(e,0,!1)}}!function(e){e[e.Fixed=0]="Fixed",e[e.Percent=1]="Percent"}(pe||(pe={})),function(e){e[e.Length=0]="Length",e[e.Fixed=1]="Fixed",e[e.Percent=2]="Percent",e[e.Proportional=3]="Proportional"}(fe||(fe={})),function(e){e[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale"}(ye||(ye={}));class Xe{static NONE=-1;static BEFORE=-2;static AFTER=-3;static epsilon=1e-5;data;bones;target;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;spaces=new Array;positions=new Array;world=new Array;curves=new Array;lengths=new Array;segments=new Array;active=!1;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.bones=new Array;for(let s=0,i=e.bones.length;s<i;s++){let i=t.findBone(e.bones[s].name);if(!i)throw new Error(`Couldn't find bone ${e.bones[s].name}.`);this.bones.push(i)}let s=t.findSlot(e.target.name);if(!s)throw new Error(`Couldn't find target bone ${e.target.name}`);this.target=s,this.position=e.position,this.spacing=e.spacing,this.mixRotate=e.mixRotate,this.mixX=e.mixX,this.mixY=e.mixY}isActive(){return this.active}update(){let e=this.target.getAttachment();if(!(e instanceof Ae))return;let t=this.mixRotate,s=this.mixX,i=this.mixY;if(0==t&&0==s&&0==i)return;let a=this.data,n=a.rotateMode==ye.Tangent,r=a.rotateMode==ye.ChainScale,o=this.bones,l=o.length,h=n?l:l+1,u=d.setArraySize(this.spaces,h),g=r?this.lengths=d.setArraySize(this.lengths,l):[],m=this.spacing;switch(a.spacingMode){case fe.Percent:if(r)for(let e=0,t=h-1;e<t;e++){let t=o[e],s=t.data.length;if(s<Xe.epsilon)g[e]=0;else{let i=s*t.a,a=s*t.c;g[e]=Math.sqrt(i*i+a*a)}}d.arrayFill(u,1,h,m);break;case fe.Proportional:let e=0;for(let t=0,s=h-1;t<s;){let s=o[t],i=s.data.length;if(i<Xe.epsilon)r&&(g[t]=0),u[++t]=m;else{let a=i*s.a,n=i*s.c,o=Math.sqrt(a*a+n*n);r&&(g[t]=o),u[++t]=o,e+=o}}if(e>0){e=h/e*m;for(let t=1;t<h;t++)u[t]*=e}break;default:let t=a.spacingMode==fe.Length;for(let e=0,s=h-1;e<s;){let s=o[e],i=s.data.length;if(i<Xe.epsilon)r&&(g[e]=0),u[++e]=m;else{let a=i*s.a,n=i*s.c,o=Math.sqrt(a*a+n*n);r&&(g[e]=o),u[++e]=(t?i+m:m)*o/i}}}let p=this.computeWorldPositions(e,h,n),f=p[0],y=p[1],w=a.offsetRotation,x=!1;if(0==w)x=a.rotateMode==ye.Chain;else{x=!1;let e=this.target.bone;w*=e.a*e.d-e.b*e.c>0?c.degRad:-c.degRad}for(let e=0,a=3;e<l;e++,a+=3){let l=o[e];l.worldX+=(f-l.worldX)*s,l.worldY+=(y-l.worldY)*i;let h=p[a],d=p[a+1],m=h-f,b=d-y;if(r){let s=g[e];if(0!=s){let e=(Math.sqrt(m*m+b*b)/s-1)*t+1;l.a*=e,l.c*=e}}if(f=h,y=d,t>0){let s=l.a,i=l.b,r=l.c,o=l.d,h=0,d=0,g=0;if(h=n?p[a-1]:0==u[e+1]?p[a+2]:Math.atan2(b,m),h-=Math.atan2(r,s),x){d=Math.cos(h),g=Math.sin(h);let e=l.data.length;f+=(e*(d*s-g*r)-m)*t,y+=(e*(g*s+d*r)-b)*t}else h+=w;h>c.PI?h-=c.PI2:h<-c.PI&&(h+=c.PI2),h*=t,d=Math.cos(h),g=Math.sin(h),l.a=d*s-g*r,l.b=d*i-g*o,l.c=g*s+d*r,l.d=g*i+d*o}l.updateAppliedTransform()}}computeWorldPositions(e,t,s){let i=this.target,a=this.position,n=this.spaces,r=d.setArraySize(this.positions,3*t+2),o=this.world,l=e.closed,h=e.worldVerticesLength,c=h/6,u=Xe.NONE;if(!e.constantSpeed){let g=e.lengths;c-=l?1:2;let m,p=g[c];switch(this.data.positionMode==pe.Percent&&(a*=p),this.data.spacingMode){case fe.Percent:m=p;break;case fe.Proportional:m=p/t;break;default:m=1}o=d.setArraySize(this.world,8);for(let d=0,f=0,y=0;d<t;d++,f+=3){let t=n[d]*m;a+=t;let w=a;if(l)w%=p,w<0&&(w+=p),y=0;else{if(w<0){u!=Xe.BEFORE&&(u=Xe.BEFORE,e.computeWorldVertices(i,2,4,o,0,2)),this.addBeforePosition(w,o,0,r,f);continue}if(w>p){u!=Xe.AFTER&&(u=Xe.AFTER,e.computeWorldVertices(i,h-6,4,o,0,2)),this.addAfterPosition(w-p,o,0,r,f);continue}}for(;;y++){let e=g[y];if(!(w>e)){if(0==y)w/=e;else{let t=g[y-1];w=(w-t)/(e-t)}break}}y!=u&&(u=y,l&&y==c?(e.computeWorldVertices(i,h-4,4,o,0,2),e.computeWorldVertices(i,0,4,o,4,2)):e.computeWorldVertices(i,6*y+2,8,o,0,2)),this.addCurvePosition(w,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],r,f,s||d>0&&0==t)}return r}l?(h+=2,o=d.setArraySize(this.world,h),e.computeWorldVertices(i,2,h-4,o,0,2),e.computeWorldVertices(i,0,2,o,h-4,2),o[h-2]=o[0],o[h-1]=o[1]):(c--,h-=4,o=d.setArraySize(this.world,h),e.computeWorldVertices(i,2,h,o,0,2));let g,m=d.setArraySize(this.curves,c),p=0,f=o[0],y=o[1],w=0,x=0,b=0,v=0,k=0,S=0,C=0,T=0,P=0,A=0,I=0,M=0,R=0,F=0;for(let e=0,t=2;e<c;e++,t+=6)w=o[t],x=o[t+1],b=o[t+2],v=o[t+3],k=o[t+4],S=o[t+5],C=.1875*(f-2*w+b),T=.1875*(y-2*x+v),P=.09375*(3*(w-b)-f+k),A=.09375*(3*(x-v)-y+S),I=2*C+P,M=2*T+A,R=.75*(w-f)+C+.16666667*P,F=.75*(x-y)+T+.16666667*A,p+=Math.sqrt(R*R+F*F),R+=I,F+=M,I+=P,M+=A,p+=Math.sqrt(R*R+F*F),R+=I,F+=M,p+=Math.sqrt(R*R+F*F),R+=I+P,F+=M+A,p+=Math.sqrt(R*R+F*F),m[e]=p,f=k,y=S;switch(this.data.positionMode==pe.Percent&&(a*=p),this.data.spacingMode){case fe.Percent:g=p;break;case fe.Proportional:g=p/t;break;default:g=1}let E=this.segments,B=0;for(let e=0,i=0,c=0,d=0;e<t;e++,i+=3){let t=n[e]*g;a+=t;let L=a;if(l)L%=p,L<0&&(L+=p),c=0;else{if(L<0){this.addBeforePosition(L,o,0,r,i);continue}if(L>p){this.addAfterPosition(L-p,o,h-4,r,i);continue}}for(;;c++){let e=m[c];if(!(L>e)){if(0==c)L/=e;else{let t=m[c-1];L=(L-t)/(e-t)}break}}if(c!=u){u=c;let e=6*c;for(f=o[e],y=o[e+1],w=o[e+2],x=o[e+3],b=o[e+4],v=o[e+5],k=o[e+6],S=o[e+7],C=.03*(f-2*w+b),T=.03*(y-2*x+v),P=.006*(3*(w-b)-f+k),A=.006*(3*(x-v)-y+S),I=2*C+P,M=2*T+A,R=.3*(w-f)+C+.16666667*P,F=.3*(x-y)+T+.16666667*A,B=Math.sqrt(R*R+F*F),E[0]=B,e=1;e<8;e++)R+=I,F+=M,I+=P,M+=A,B+=Math.sqrt(R*R+F*F),E[e]=B;R+=I,F+=M,B+=Math.sqrt(R*R+F*F),E[8]=B,R+=I+P,F+=M+A,B+=Math.sqrt(R*R+F*F),E[9]=B,d=0}for(L*=B;;d++){let e=E[d];if(!(L>e)){if(0==d)L/=e;else{let t=E[d-1];L=d+(L-t)/(e-t)}break}}this.addCurvePosition(.1*L,f,y,w,x,b,v,k,S,r,i,s||e>0&&0==t)}return r}addBeforePosition(e,t,s,i,a){let n=t[s],r=t[s+1],o=t[s+2]-n,l=t[s+3]-r,h=Math.atan2(l,o);i[a]=n+e*Math.cos(h),i[a+1]=r+e*Math.sin(h),i[a+2]=h}addAfterPosition(e,t,s,i,a){let n=t[s+2],r=t[s+3],o=n-t[s],l=r-t[s+1],h=Math.atan2(l,o);i[a]=n+e*Math.cos(h),i[a+1]=r+e*Math.sin(h),i[a+2]=h}addCurvePosition(e,t,s,i,a,n,r,o,l,h,c,d){if(0==e||isNaN(e))return h[c]=t,h[c+1]=s,void(h[c+2]=Math.atan2(a-s,i-t));let u=e*e,g=u*e,m=1-e,p=m*m,f=p*m,y=m*e,w=3*y,x=m*w,b=w*e,v=t*f+i*x+n*b+o*g,k=s*f+a*x+r*b+l*g;h[c]=v,h[c+1]=k,d&&(h[c+2]=e<.001?Math.atan2(a-s,i-t):Math.atan2(k-(s*p+a*y*2+r*u),v-(t*p+i*y*2+n*u)))}}class De{data;bone;color;darkColor=null;attachment=null;attachmentState=0;sequenceIndex=-1;deform=new Array;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("bone cannot be null.");this.data=e,this.bone=t,this.color=new h,this.darkColor=e.darkColor?new h:null,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(e){this.attachment!=e&&(e instanceof p&&this.attachment instanceof p&&e.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=e,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class _e{data;bones;target;mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;temp=new g;active=!1;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.mixRotate=e.mixRotate,this.mixX=e.mixX,this.mixY=e.mixY,this.mixScaleX=e.mixScaleX,this.mixScaleY=e.mixScaleY,this.mixShearY=e.mixShearY,this.bones=new Array;for(let s=0;s<e.bones.length;s++){let i=t.findBone(e.bones[s].name);if(!i)throw new Error(`Couldn't find bone ${e.bones[s].name}.`);this.bones.push(i)}let s=t.findBone(e.target.name);if(!s)throw new Error(`Couldn't find target bone ${e.target.name}.`);this.target=s}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleY&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,a=this.mixScaleY,n=this.mixShearY,r=0!=t||0!=s,o=this.target,l=o.a,h=o.b,d=o.c,u=o.d,g=l*u-h*d>0?c.degRad:-c.degRad,m=this.data.offsetRotation*g,p=this.data.offsetShearY*g,f=this.bones;for(let g=0,y=f.length;g<y;g++){let y=f[g];if(0!=e){let t=y.a,s=y.b,i=y.c,a=y.d,n=Math.atan2(d,l)-Math.atan2(i,t)+m;n>c.PI?n-=c.PI2:n<-c.PI&&(n+=c.PI2),n*=e;let r=Math.cos(n),o=Math.sin(n);y.a=r*t-o*i,y.b=r*s-o*a,y.c=o*t+r*i,y.d=o*s+r*a}if(r){let e=this.temp;o.localToWorld(e.set(this.data.offsetX,this.data.offsetY)),y.worldX+=(e.x-y.worldX)*t,y.worldY+=(e.y-y.worldY)*s}if(0!=i){let e=Math.sqrt(y.a*y.a+y.c*y.c);0!=e&&(e=(e+(Math.sqrt(l*l+d*d)-e+this.data.offsetScaleX)*i)/e),y.a*=e,y.c*=e}if(0!=a){let e=Math.sqrt(y.b*y.b+y.d*y.d);0!=e&&(e=(e+(Math.sqrt(h*h+u*u)-e+this.data.offsetScaleY)*a)/e),y.b*=e,y.d*=e}if(n>0){let e=y.b,t=y.d,s=Math.atan2(t,e),i=Math.atan2(u,h)-Math.atan2(d,l)-(s-Math.atan2(y.c,y.a));i>c.PI?i-=c.PI2:i<-c.PI&&(i+=c.PI2),i=s+(i+p)*n;let a=Math.sqrt(e*e+t*t);y.b=Math.cos(i)*a,y.d=Math.sin(i)*a}y.updateAppliedTransform()}}applyRelativeWorld(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,a=this.mixScaleY,n=this.mixShearY,r=0!=t||0!=s,o=this.target,l=o.a,h=o.b,d=o.c,u=o.d,g=l*u-h*d>0?c.degRad:-c.degRad,m=this.data.offsetRotation*g,p=this.data.offsetShearY*g,f=this.bones;for(let g=0,y=f.length;g<y;g++){let y=f[g];if(0!=e){let t=y.a,s=y.b,i=y.c,a=y.d,n=Math.atan2(d,l)+m;n>c.PI?n-=c.PI2:n<-c.PI&&(n+=c.PI2),n*=e;let r=Math.cos(n),o=Math.sin(n);y.a=r*t-o*i,y.b=r*s-o*a,y.c=o*t+r*i,y.d=o*s+r*a}if(r){let e=this.temp;o.localToWorld(e.set(this.data.offsetX,this.data.offsetY)),y.worldX+=e.x*t,y.worldY+=e.y*s}if(0!=i){let e=(Math.sqrt(l*l+d*d)-1+this.data.offsetScaleX)*i+1;y.a*=e,y.c*=e}if(0!=a){let e=(Math.sqrt(h*h+u*u)-1+this.data.offsetScaleY)*a+1;y.b*=e,y.d*=e}if(n>0){let e=Math.atan2(u,h)-Math.atan2(d,l);e>c.PI?e-=c.PI2:e<-c.PI&&(e+=c.PI2);let t=y.b,s=y.d;e=Math.atan2(s,t)+(e-c.PI/2+p)*n;let i=Math.sqrt(t*t+s*s);y.b=Math.cos(e)*i,y.d=Math.sin(e)*i}y.updateAppliedTransform()}}applyAbsoluteLocal(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,a=this.mixScaleY,n=this.mixShearY,r=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation;if(0!=e){let t=r.arotation-c+this.data.offsetRotation;t-=360*(16384-(16384.499999999996-t/360|0)),c+=t*e}let d=h.ax,u=h.ay;d+=(r.ax-d+this.data.offsetX)*t,u+=(r.ay-u+this.data.offsetY)*s;let g=h.ascaleX,m=h.ascaleY;0!=i&&0!=g&&(g=(g+(r.ascaleX-g+this.data.offsetScaleX)*i)/g),0!=a&&0!=m&&(m=(m+(r.ascaleY-m+this.data.offsetScaleY)*a)/m);let p=h.ashearY;if(0!=n){let e=r.ashearY-p+this.data.offsetShearY;e-=360*(16384-(16384.499999999996-e/360|0)),p+=e*n}h.updateWorldTransformWith(d,u,c,g,m,h.ashearX,p)}}applyRelativeLocal(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,a=this.mixScaleY,n=this.mixShearY,r=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation+(r.arotation+this.data.offsetRotation)*e,d=h.ax+(r.ax+this.data.offsetX)*t,u=h.ay+(r.ay+this.data.offsetY)*s,g=h.ascaleX*((r.ascaleX-1+this.data.offsetScaleX)*i+1),m=h.ascaleY*((r.ascaleY-1+this.data.offsetScaleY)*a+1),p=h.ashearY+(r.ashearY+this.data.offsetShearY)*n;h.updateWorldTransformWith(d,u,c,g,m,h.ashearX,p)}}}class Ve{static yDown=!1;data;bones;slots;drawOrder;ikConstraints;transformConstraints;pathConstraints;_updateCache=new Array;skin=null;color;scaleX=1;_scaleY=1;get scaleY(){return Ve.yDown?-this._scaleY:this._scaleY}set scaleY(e){this._scaleY=e}x=0;y=0;constructor(e){if(!e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(let t=0;t<e.bones.length;t++){let s,i=e.bones[t];if(i.parent){let e=this.bones[i.parent.index];s=new Ee(i,this,e),e.children.push(s)}else s=new Ee(i,this,null);this.bones.push(s)}this.slots=new Array,this.drawOrder=new Array;for(let t=0;t<e.slots.length;t++){let s=e.slots[t],i=this.bones[s.boneData.index],a=new De(s,i);this.slots.push(a),this.drawOrder.push(a)}this.ikConstraints=new Array;for(let t=0;t<e.ikConstraints.length;t++){let s=e.ikConstraints[t];this.ikConstraints.push(new Be(s,this))}this.transformConstraints=new Array;for(let t=0;t<e.transformConstraints.length;t++){let s=e.transformConstraints[t];this.transformConstraints.push(new _e(s,this))}this.pathConstraints=new Array;for(let t=0;t<e.pathConstraints.length;t++){let s=e.pathConstraints[t];this.pathConstraints.push(new Xe(s,this))}this.color=new h(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;let e=this.bones;for(let t=0,s=e.length;t<s;t++){let s=e[t];s.sorted=s.data.skinRequired,s.active=!s.sorted}if(this.skin){let e=this.skin.bones;for(let t=0,s=this.skin.bones.length;t<s;t++){let s=this.bones[e[t].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(s)}}let t=this.ikConstraints,s=this.transformConstraints,i=this.pathConstraints,a=t.length,n=s.length,r=i.length,o=a+n+r;e:for(let e=0;e<o;e++){for(let s=0;s<a;s++){let i=t[s];if(i.data.order==e){this.sortIkConstraint(i);continue e}}for(let t=0;t<n;t++){let i=s[t];if(i.data.order==e){this.sortTransformConstraint(i);continue e}}for(let t=0;t<r;t++){let s=i[t];if(s.data.order==e){this.sortPathConstraint(s);continue e}}}for(let t=0,s=e.length;t<s;t++)this.sortBone(e[t])}sortIkConstraint(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||this.skin&&d.contains(this.skin.constraints,e.data,!0)),!e.active)return;let t=e.target;this.sortBone(t);let s=e.bones,i=s[0];if(this.sortBone(i),1==s.length)this._updateCache.push(e),this.sortReset(i.children);else{let t=s[s.length-1];this.sortBone(t),this._updateCache.push(e),this.sortReset(i.children),t.sorted=!0}}sortPathConstraint(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||this.skin&&d.contains(this.skin.constraints,e.data,!0)),!e.active)return;let t=e.target,s=t.data.index,i=t.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,s,i),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,i);for(let e=0,t=this.data.skins.length;e<t;e++)this.sortPathConstraintAttachment(this.data.skins[e],s,i);let a=t.getAttachment();a instanceof Ae&&this.sortPathConstraintAttachmentWith(a,i);let n=e.bones,r=n.length;for(let e=0;e<r;e++)this.sortBone(n[e]);this._updateCache.push(e);for(let e=0;e<r;e++)this.sortReset(n[e].children);for(let e=0;e<r;e++)n[e].sorted=!0}sortTransformConstraint(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||this.skin&&d.contains(this.skin.constraints,e.data,!0)),!e.active)return;this.sortBone(e.target);let t=e.bones,s=t.length;if(e.data.local)for(let e=0;e<s;e++){let s=t[e];this.sortBone(s.parent),this.sortBone(s)}else for(let e=0;e<s;e++)this.sortBone(t[e]);this._updateCache.push(e);for(let e=0;e<s;e++)this.sortReset(t[e].children);for(let e=0;e<s;e++)t[e].sorted=!0}sortPathConstraintAttachment(e,t,s){let i=e.attachments[t];if(i)for(let e in i)this.sortPathConstraintAttachmentWith(i[e],s)}sortPathConstraintAttachmentWith(e,t){if(!(e instanceof Ae))return;let s=e.bones;if(s){let e=this.bones;for(let t=0,i=s.length;t<i;){let i=s[t++];for(i+=t;t<i;)this.sortBone(e[s[t++]])}}else this.sortBone(t)}sortBone(e){if(!e)return;if(e.sorted)return;let t=e.parent;t&&this.sortBone(t),e.sorted=!0,this._updateCache.push(e)}sortReset(e){for(let t=0,s=e.length;t<s;t++){let s=e[t];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){let e=this.bones;for(let t=0,s=e.length;t<s;t++){let s=e[t];s.ax=s.x,s.ay=s.y,s.arotation=s.rotation,s.ascaleX=s.scaleX,s.ascaleY=s.scaleY,s.ashearX=s.shearX,s.ashearY=s.shearY}let t=this._updateCache;for(let e=0,s=t.length;e<s;e++)t[e].update()}updateWorldTransformWith(e){let t=this.getRootBone();if(!t)throw new Error("Root bone must not be null.");let s=e.a,i=e.b,a=e.c,n=e.d;t.worldX=s*this.x+i*this.y+e.worldX,t.worldY=a*this.x+n*this.y+e.worldY;let r=t.rotation+90+t.shearY,o=c.cosDeg(t.rotation+t.shearX)*t.scaleX,l=c.cosDeg(r)*t.scaleY,h=c.sinDeg(t.rotation+t.shearX)*t.scaleX,d=c.sinDeg(r)*t.scaleY;t.a=(s*o+i*h)*this.scaleX,t.b=(s*l+i*d)*this.scaleX,t.c=(a*o+n*h)*this.scaleY,t.d=(a*l+n*d)*this.scaleY;let u=this._updateCache;for(let e=0,s=u.length;e<s;e++){let s=u[e];s!=t&&s.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){let e=this.bones;for(let t=0,s=e.length;t<s;t++)e[t].setToSetupPose();let t=this.ikConstraints;for(let e=0,s=t.length;e<s;e++){let s=t[e];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}let s=this.transformConstraints;for(let e=0,t=s.length;e<t;e++){let t=s[e],i=t.data;t.mixRotate=i.mixRotate,t.mixX=i.mixX,t.mixY=i.mixY,t.mixScaleX=i.mixScaleX,t.mixScaleY=i.mixScaleY,t.mixShearY=i.mixShearY}let i=this.pathConstraints;for(let e=0,t=i.length;e<t;e++){let t=i[e],s=t.data;t.position=s.position,t.spacing=s.spacing,t.mixRotate=s.mixRotate,t.mixX=s.mixX,t.mixY=s.mixY}}setSlotsToSetupPose(){let e=this.slots;d.arrayCopy(e,0,this.drawOrder,0,e.length);for(let t=0,s=e.length;t<s;t++)e[t].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(e){if(!e)throw new Error("boneName cannot be null.");let t=this.bones;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.data.name==e)return i}return null}findSlot(e){if(!e)throw new Error("slotName cannot be null.");let t=this.slots;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.data.name==e)return i}return null}setSkinByName(e){let t=this.data.findSkin(e);if(!t)throw new Error("Skin not found: "+e);this.setSkin(t)}setSkin(e){if(e!=this.skin){if(e)if(this.skin)e.attachAll(this,this.skin);else{let t=this.slots;for(let s=0,i=t.length;s<i;s++){let i=t[s],a=i.data.attachmentName;if(a){let t=e.getAttachment(s,a);t&&i.setAttachment(t)}}}this.skin=e,this.updateCache()}}getAttachmentByName(e,t){let s=this.data.findSlot(e);if(!s)throw new Error(`Can't find slot with name ${e}`);return this.getAttachment(s.index,t)}getAttachment(e,t){if(!t)throw new Error("attachmentName cannot be null.");if(this.skin){let s=this.skin.getAttachment(e,t);if(s)return s}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null}setAttachment(e,t){if(!e)throw new Error("slotName cannot be null.");let s=this.slots;for(let i=0,a=s.length;i<a;i++){let a=s[i];if(a.data.name==e){let s=null;if(t&&(s=this.getAttachment(i,t),!s))throw new Error("Attachment not found: "+t+", for slot: "+e);return void a.setAttachment(s)}}throw new Error("Slot not found: "+e)}findIkConstraint(e){if(!e)throw new Error("constraintName cannot be null.");let t=this.ikConstraints;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.data.name==e)return i}return null}findTransformConstraint(e){if(!e)throw new Error("constraintName cannot be null.");let t=this.transformConstraints;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.data.name==e)return i}return null}findPathConstraint(e){if(!e)throw new Error("constraintName cannot be null.");let t=this.pathConstraints;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.data.name==e)return i}return null}getBoundsRect(){let e=new g,t=new g;return this.getBounds(e,t),{x:e.x,y:e.y,width:t.x,height:t.y}}getBounds(e,t,s=new Array(2)){if(!e)throw new Error("offset cannot be null.");if(!t)throw new Error("size cannot be null.");let i=this.drawOrder,a=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let e=0,t=i.length;e<t;e++){let t=i[e];if(!t.bone.active)continue;let l=0,h=null,c=t.getAttachment();if(c instanceof Me)l=8,h=d.setArraySize(s,l,0),c.computeWorldVertices(t,h,0,2);else if(c instanceof Pe){let e=c;l=e.worldVerticesLength,h=d.setArraySize(s,l,0),e.computeWorldVertices(t,0,l,h,0,2)}if(h)for(let e=0,t=h.length;e<t;e+=2){let t=h[e],s=h[e+1];a=Math.min(a,t),n=Math.min(n,s),r=Math.max(r,t),o=Math.max(o,s)}}e.set(a,n),t.set(r-a,o-n)}}class Ue{data;intValue=0;floatValue=0;stringValue=null;time=0;volume=0;balance=0;constructor(e,t){if(!t)throw new Error("data cannot be null.");this.time=e,this.data=t}}class Ne{name;intValue=0;floatValue=0;stringValue=null;audioPath=null;volume=0;balance=0;constructor(e){this.name=e}}class Ge{name=null;bones=new Array;slots=new Array;skins=new Array;defaultSkin=null;events=new Array;animations=new Array;ikConstraints=new Array;transformConstraints=new Array;pathConstraints=new Array;x=0;y=0;width=0;height=0;version=null;hash=null;fps=0;imagesPath=null;audioPath=null;findBone(e){if(!e)throw new Error("boneName cannot be null.");let t=this.bones;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}findSlot(e){if(!e)throw new Error("slotName cannot be null.");let t=this.slots;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}findSkin(e){if(!e)throw new Error("skinName cannot be null.");let t=this.skins;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}findEvent(e){if(!e)throw new Error("eventDataName cannot be null.");let t=this.events;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}findAnimation(e){if(!e)throw new Error("animationName cannot be null.");let t=this.animations;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}findIkConstraint(e){if(!e)throw new Error("constraintName cannot be null.");let t=this.ikConstraints;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}findTransformConstraint(e){if(!e)throw new Error("constraintName cannot be null.");let t=this.transformConstraints;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}findPathConstraint(e){if(!e)throw new Error("constraintName cannot be null.");let t=this.pathConstraints;for(let s=0,i=t.length;s<i;s++){let i=t[s];if(i.name==e)return i}return null}}class We{slotIndex;name;attachment;constructor(e=0,t,s){this.slotIndex=e,this.name=t,this.attachment=s}}class qe{name;attachments=new Array;bones=Array();constraints=new Array;constructor(e){if(!e)throw new Error("name cannot be null.");this.name=e}setAttachment(e,t,s){if(!s)throw new Error("attachment cannot be null.");let i=this.attachments;e>=i.length&&(i.length=e+1),i[e]||(i[e]={}),i[e][t]=s}addSkin(e){for(let t=0;t<e.bones.length;t++){let s=e.bones[t],i=!1;for(let e=0;e<this.bones.length;e++)if(this.bones[e]==s){i=!0;break}i||this.bones.push(s)}for(let t=0;t<e.constraints.length;t++){let s=e.constraints[t],i=!1;for(let e=0;e<this.constraints.length;e++)if(this.constraints[e]==s){i=!0;break}i||this.constraints.push(s)}let t=e.getAttachments();for(let e=0;e<t.length;e++){var s=t[e];this.setAttachment(s.slotIndex,s.name,s.attachment)}}copySkin(e){for(let t=0;t<e.bones.length;t++){let s=e.bones[t],i=!1;for(let e=0;e<this.bones.length;e++)if(this.bones[e]==s){i=!0;break}i||this.bones.push(s)}for(let t=0;t<e.constraints.length;t++){let s=e.constraints[t],i=!1;for(let e=0;e<this.constraints.length;e++)if(this.constraints[e]==s){i=!0;break}i||this.constraints.push(s)}let t=e.getAttachments();for(let e=0;e<t.length;e++){var s=t[e];s.attachment&&(s.attachment instanceof Pe?(s.attachment=s.attachment.newLinkedMesh(),this.setAttachment(s.slotIndex,s.name,s.attachment)):(s.attachment=s.attachment.copy(),this.setAttachment(s.slotIndex,s.name,s.attachment)))}}getAttachment(e,t){let s=this.attachments[e];return s?s[t]:null}removeAttachment(e,t){let s=this.attachments[e];s&&delete s[t]}getAttachments(){let e=new Array;for(var t=0;t<this.attachments.length;t++){let s=this.attachments[t];if(s)for(let i in s){let a=s[i];a&&e.push(new We(t,i,a))}}return e}getAttachmentsForSlot(e,t){let s=this.attachments[e];if(s)for(let i in s){let a=s[i];a&&t.push(new We(e,i,a))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(e,t){let s=0;for(let i=0;i<e.slots.length;i++){let a=e.slots[i],n=a.getAttachment();if(n&&s<t.attachments.length){let e=t.attachments[s];for(let t in e)if(n==e[t]){let e=this.getAttachment(s,t);e&&a.setAttachment(e);break}}s++}}}class He{index=0;name;boneData;color=new h(1,1,1,1);darkColor=null;attachmentName=null;blendMode=we.Normal;constructor(e,t,s){if(e<0)throw new Error("index must be >= 0.");if(!t)throw new Error("name cannot be null.");if(!s)throw new Error("boneData cannot be null.");this.index=e,this.name=t,this.boneData=s}}(be=we||(we={}))[be.Normal=0]="Normal",be[be.Additive=1]="Additive",be[be.Multiply=2]="Multiply",be[be.Screen=3]="Screen";class ze extends Le{bones=new Array;_target=null;set target(e){this._target=e}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;offsetRotation=0;offsetX=0;offsetY=0;offsetScaleX=0;offsetScaleY=0;offsetShearY=0;relative=!1;local=!1;constructor(e){super(e,0,!1)}}class je{scale=1;attachmentLoader;linkedMeshes=new Array;constructor(e){this.attachmentLoader=e}readSkeletonData(e){let t=this.scale,s=new Ge;s.name="";let i=new $e(e),a=i.readInt32(),n=i.readInt32();s.hash=0==n&&0==a?null:n.toString(16)+a.toString(16),s.version=i.readString(),s.x=i.readFloat(),s.y=i.readFloat(),s.width=i.readFloat(),s.height=i.readFloat();let r=i.readBoolean();r&&(s.fps=i.readFloat(),s.imagesPath=i.readString(),s.audioPath=i.readString());let o=0;o=i.readInt(!0);for(let e=0;e<o;e++){let e=i.readString();if(!e)throw new Error("String in string table must not be null.");i.strings.push(e)}o=i.readInt(!0);for(let e=0;e<o;e++){let a=i.readString();if(!a)throw new Error("Bone name must not be null.");let n=0==e?null:s.bones[i.readInt(!0)],o=new Fe(e,a,n);o.rotation=i.readFloat(),o.x=i.readFloat()*t,o.y=i.readFloat()*t,o.scaleX=i.readFloat(),o.scaleY=i.readFloat(),o.shearX=i.readFloat(),o.shearY=i.readFloat(),o.length=i.readFloat()*t,o.transformMode=i.readInt(!0),o.skinRequired=i.readBoolean(),r&&h.rgba8888ToColor(o.color,i.readInt32()),s.bones.push(o)}o=i.readInt(!0);for(let e=0;e<o;e++){let t=i.readString();if(!t)throw new Error("Slot name must not be null.");let a=s.bones[i.readInt(!0)],n=new He(e,t,a);h.rgba8888ToColor(n.color,i.readInt32());let r=i.readInt32();-1!=r&&h.rgb888ToColor(n.darkColor=new h,r),n.attachmentName=i.readStringRef(),n.blendMode=i.readInt(!0),s.slots.push(n)}o=i.readInt(!0);for(let e,a=0;a<o;a++){let a=i.readString();if(!a)throw new Error("IK constraint data name must not be null.");let n=new Ye(a);n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),e=i.readInt(!0);for(let t=0;t<e;t++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.bones[i.readInt(!0)],n.mix=i.readFloat(),n.softness=i.readFloat()*t,n.bendDirection=i.readByte(),n.compress=i.readBoolean(),n.stretch=i.readBoolean(),n.uniform=i.readBoolean(),s.ikConstraints.push(n)}o=i.readInt(!0);for(let e,a=0;a<o;a++){let a=i.readString();if(!a)throw new Error("Transform constraint data name must not be null.");let n=new ze(a);n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),e=i.readInt(!0);for(let t=0;t<e;t++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.bones[i.readInt(!0)],n.local=i.readBoolean(),n.relative=i.readBoolean(),n.offsetRotation=i.readFloat(),n.offsetX=i.readFloat()*t,n.offsetY=i.readFloat()*t,n.offsetScaleX=i.readFloat(),n.offsetScaleY=i.readFloat(),n.offsetShearY=i.readFloat(),n.mixRotate=i.readFloat(),n.mixX=i.readFloat(),n.mixY=i.readFloat(),n.mixScaleX=i.readFloat(),n.mixScaleY=i.readFloat(),n.mixShearY=i.readFloat(),s.transformConstraints.push(n)}o=i.readInt(!0);for(let e,a=0;a<o;a++){let a=i.readString();if(!a)throw new Error("Path constraint data name must not be null.");let n=new Oe(a);n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),e=i.readInt(!0);for(let t=0;t<e;t++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.slots[i.readInt(!0)],n.positionMode=i.readInt(!0),n.spacingMode=i.readInt(!0),n.rotateMode=i.readInt(!0),n.offsetRotation=i.readFloat(),n.position=i.readFloat(),n.positionMode==pe.Fixed&&(n.position*=t),n.spacing=i.readFloat(),n.spacingMode!=fe.Length&&n.spacingMode!=fe.Fixed||(n.spacing*=t),n.mixRotate=i.readFloat(),n.mixX=i.readFloat(),n.mixY=i.readFloat(),s.pathConstraints.push(n)}let l=this.readSkin(i,s,!0,r);l&&(s.defaultSkin=l,s.skins.push(l));{let e=s.skins.length;for(d.setArraySize(s.skins,o=e+i.readInt(!0));e<o;e++){let t=this.readSkin(i,s,!1,r);if(!t)throw new Error("readSkin() should not have returned null.");s.skins[e]=t}}o=this.linkedMeshes.length;for(let e=0;e<o;e++){let t=this.linkedMeshes[e],i=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!i)throw new Error("Not skin found for linked mesh.");if(!t.parent)throw new Error("Linked mesh parent must not be null");let a=i.getAttachment(t.slotIndex,t.parent);if(!a)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?a:t.mesh,t.mesh.setParentMesh(a),null!=t.mesh.region&&t.mesh.updateRegion()}this.linkedMeshes.length=0,o=i.readInt(!0);for(let e=0;e<o;e++){let e=i.readStringRef();if(!e)throw new Error;let t=new Ne(e);t.intValue=i.readInt(!1),t.floatValue=i.readFloat(),t.stringValue=i.readString(),t.audioPath=i.readString(),t.audioPath&&(t.volume=i.readFloat(),t.balance=i.readFloat()),s.events.push(t)}o=i.readInt(!0);for(let e=0;e<o;e++){let e=i.readString();if(!e)throw new Error("Animatio name must not be null.");s.animations.push(this.readAnimation(i,e,s))}return s}readSkin(e,t,s,i){let a=null,n=0;if(s){if(n=e.readInt(!0),0==n)return null;a=new qe("default")}else{let s=e.readStringRef();if(!s)throw new Error("Skin name must not be null.");a=new qe(s),a.bones.length=e.readInt(!0);for(let s=0,i=a.bones.length;s<i;s++)a.bones[s]=t.bones[e.readInt(!0)];for(let s=0,i=e.readInt(!0);s<i;s++)a.constraints.push(t.ikConstraints[e.readInt(!0)]);for(let s=0,i=e.readInt(!0);s<i;s++)a.constraints.push(t.transformConstraints[e.readInt(!0)]);for(let s=0,i=e.readInt(!0);s<i;s++)a.constraints.push(t.pathConstraints[e.readInt(!0)]);n=e.readInt(!0)}for(let s=0;s<n;s++){let s=e.readInt(!0);for(let n=0,r=e.readInt(!0);n<r;n++){let n=e.readStringRef();if(!n)throw new Error("Attachment name must not be null");let r=this.readAttachment(e,t,a,s,n,i);r&&a.setAttachment(s,n,r)}}return a}readAttachment(e,t,s,i,a,n){let r=this.scale,o=e.readStringRef();switch(o||(o=a),e.readByte()){case xe.Region:{let t=e.readStringRef(),i=e.readFloat(),a=e.readFloat(),n=e.readFloat(),l=e.readFloat(),c=e.readFloat(),d=e.readFloat(),u=e.readFloat(),g=e.readInt32(),m=this.readSequence(e);t||(t=o);let p=this.attachmentLoader.newRegionAttachment(s,o,t,m);return p?(p.path=t,p.x=a*r,p.y=n*r,p.scaleX=l,p.scaleY=c,p.rotation=i,p.width=d*r,p.height=u*r,h.rgba8888ToColor(p.color,g),p.sequence=m,null==m&&p.updateRegion(),p):null}case xe.BoundingBox:{let t=e.readInt(!0),i=this.readVertices(e,t),a=n?e.readInt32():0,r=this.attachmentLoader.newBoundingBoxAttachment(s,o);return r?(r.worldVerticesLength=t<<1,r.vertices=i.vertices,r.bones=i.bones,n&&h.rgba8888ToColor(r.color,a),r):null}case xe.Mesh:{let t=e.readStringRef(),i=e.readInt32(),a=e.readInt(!0),l=this.readFloatArray(e,a<<1,1),c=this.readShortArray(e),d=this.readVertices(e,a),u=e.readInt(!0),g=this.readSequence(e),m=[],p=0,f=0;n&&(m=this.readShortArray(e),p=e.readFloat(),f=e.readFloat()),t||(t=o);let y=this.attachmentLoader.newMeshAttachment(s,o,t,g);return y?(y.path=t,h.rgba8888ToColor(y.color,i),y.bones=d.bones,y.vertices=d.vertices,y.worldVerticesLength=a<<1,y.triangles=c,y.regionUVs=l,null==g&&y.updateRegion(),y.hullLength=u<<1,y.sequence=g,n&&(y.edges=m,y.width=p*r,y.height=f*r),y):null}case xe.LinkedMesh:{let t=e.readStringRef(),a=e.readInt32(),l=e.readStringRef(),c=e.readStringRef(),d=e.readBoolean(),u=this.readSequence(e),g=0,m=0;n&&(g=e.readFloat(),m=e.readFloat()),t||(t=o);let p=this.attachmentLoader.newMeshAttachment(s,o,t,u);return p?(p.path=t,h.rgba8888ToColor(p.color,a),p.sequence=u,n&&(p.width=g*r,p.height=m*r),this.linkedMeshes.push(new Je(p,l,i,c,d)),p):null}case xe.Path:{let t=e.readBoolean(),i=e.readBoolean(),a=e.readInt(!0),l=this.readVertices(e,a),c=d.newArray(a/3,0);for(let t=0,s=c.length;t<s;t++)c[t]=e.readFloat()*r;let u=n?e.readInt32():0,g=this.attachmentLoader.newPathAttachment(s,o);return g?(g.closed=t,g.constantSpeed=i,g.worldVerticesLength=a<<1,g.vertices=l.vertices,g.bones=l.bones,g.lengths=c,n&&h.rgba8888ToColor(g.color,u),g):null}case xe.Point:{let t=e.readFloat(),i=e.readFloat(),a=e.readFloat(),l=n?e.readInt32():0,c=this.attachmentLoader.newPointAttachment(s,o);return c?(c.x=i*r,c.y=a*r,c.rotation=t,n&&h.rgba8888ToColor(c.color,l),c):null}case xe.Clipping:{let i=e.readInt(!0),a=e.readInt(!0),r=this.readVertices(e,a),l=n?e.readInt32():0,c=this.attachmentLoader.newClippingAttachment(s,o);return c?(c.endSlot=t.slots[i],c.worldVerticesLength=a<<1,c.vertices=r.vertices,c.bones=r.bones,n&&h.rgba8888ToColor(c.color,l),c):null}}return null}readSequence(e){if(!e.readBoolean())return null;let t=new f(e.readInt(!0));return t.start=e.readInt(!0),t.digits=e.readInt(!0),t.setupIndex=e.readInt(!0),t}readVertices(e,t){let s=this.scale,i=t<<1,a=new Qe;if(!e.readBoolean())return a.vertices=this.readFloatArray(e,i,s),a;let n=new Array,r=new Array;for(let i=0;i<t;i++){let t=e.readInt(!0);r.push(t);for(let i=0;i<t;i++)r.push(e.readInt(!0)),n.push(e.readFloat()*s),n.push(e.readFloat()*s),n.push(e.readFloat())}return a.vertices=d.toFloatArray(n),a.bones=r,a}readFloatArray(e,t,s){let i=new Array(t);if(1==s)for(let s=0;s<t;s++)i[s]=e.readFloat();else for(let a=0;a<t;a++)i[a]=e.readFloat()*s;return i}readShortArray(e){let t=e.readInt(!0),s=new Array(t);for(let i=0;i<t;i++)s[i]=e.readShort();return s}readAnimation(e,t,s){e.readInt(!0);let i=new Array,a=this.scale;new h,new h;for(let t=0,s=e.readInt(!0);t<s;t++){let t=e.readInt(!0);for(let s=0,a=e.readInt(!0);s<a;s++){let s=e.readByte(),a=e.readInt(!0),n=a-1;switch(s){case dt:{let s=new U(a,t);for(let t=0;t<a;t++)s.setFrame(t,e.readFloat(),e.readStringRef());i.push(s);break}case ut:{let s=e.readInt(!0),r=new O(a,s,t),o=e.readFloat(),l=e.readUnsignedByte()/255,h=e.readUnsignedByte()/255,c=e.readUnsignedByte()/255,d=e.readUnsignedByte()/255;for(let t=0,s=0;r.setFrame(t,o,l,h,c,d),t!=n;t++){let i=e.readFloat(),a=e.readUnsignedByte()/255,n=e.readUnsignedByte()/255,u=e.readUnsignedByte()/255,g=e.readUnsignedByte()/255;switch(e.readByte()){case kt:r.setStepped(t);break;case St:et(e,r,s++,t,0,o,i,l,a,1),et(e,r,s++,t,1,o,i,h,n,1),et(e,r,s++,t,2,o,i,c,u,1),et(e,r,s++,t,3,o,i,d,g,1)}o=i,l=a,h=n,c=u,d=g}i.push(r);break}case gt:{let s=e.readInt(!0),r=new X(a,s,t),o=e.readFloat(),l=e.readUnsignedByte()/255,h=e.readUnsignedByte()/255,c=e.readUnsignedByte()/255;for(let t=0,s=0;r.setFrame(t,o,l,h,c),t!=n;t++){let i=e.readFloat(),a=e.readUnsignedByte()/255,n=e.readUnsignedByte()/255,d=e.readUnsignedByte()/255;switch(e.readByte()){case kt:r.setStepped(t);break;case St:et(e,r,s++,t,0,o,i,l,a,1),et(e,r,s++,t,1,o,i,h,n,1),et(e,r,s++,t,2,o,i,c,d,1)}o=i,l=a,h=n,c=d}i.push(r);break}case mt:{let s=e.readInt(!0),r=new _(a,s,t),o=e.readFloat(),l=e.readUnsignedByte()/255,h=e.readUnsignedByte()/255,c=e.readUnsignedByte()/255,d=e.readUnsignedByte()/255,u=e.readUnsignedByte()/255,g=e.readUnsignedByte()/255,m=e.readUnsignedByte()/255;for(let t=0,s=0;r.setFrame(t,o,l,h,c,d,u,g,m),t!=n;t++){let i=e.readFloat(),a=e.readUnsignedByte()/255,n=e.readUnsignedByte()/255,p=e.readUnsignedByte()/255,f=e.readUnsignedByte()/255,y=e.readUnsignedByte()/255,w=e.readUnsignedByte()/255,x=e.readUnsignedByte()/255;switch(e.readByte()){case kt:r.setStepped(t);break;case St:et(e,r,s++,t,0,o,i,l,a,1),et(e,r,s++,t,1,o,i,h,n,1),et(e,r,s++,t,2,o,i,c,p,1),et(e,r,s++,t,3,o,i,d,f,1),et(e,r,s++,t,4,o,i,u,y,1),et(e,r,s++,t,5,o,i,g,w,1),et(e,r,s++,t,6,o,i,m,x,1)}o=i,l=a,h=n,c=p,d=f,u=y,g=w,m=x}i.push(r);break}case pt:{let s=e.readInt(!0),r=new V(a,s,t),o=e.readFloat(),l=e.readUnsignedByte()/255,h=e.readUnsignedByte()/255,c=e.readUnsignedByte()/255,d=e.readUnsignedByte()/255,u=e.readUnsignedByte()/255,g=e.readUnsignedByte()/255;for(let t=0,s=0;r.setFrame(t,o,l,h,c,d,u,g),t!=n;t++){let i=e.readFloat(),a=e.readUnsignedByte()/255,n=e.readUnsignedByte()/255,m=e.readUnsignedByte()/255,p=e.readUnsignedByte()/255,f=e.readUnsignedByte()/255,y=e.readUnsignedByte()/255;switch(e.readByte()){case kt:r.setStepped(t);break;case St:et(e,r,s++,t,0,o,i,l,a,1),et(e,r,s++,t,1,o,i,h,n,1),et(e,r,s++,t,2,o,i,c,m,1),et(e,r,s++,t,3,o,i,d,p,1),et(e,r,s++,t,4,o,i,u,f,1),et(e,r,s++,t,5,o,i,g,y,1)}o=i,l=a,h=n,c=m,d=p,u=f,g=y}i.push(r);break}case ft:{let s=new D(a,e.readInt(!0),t),r=e.readFloat(),o=e.readUnsignedByte()/255;for(let t=0,i=0;s.setFrame(t,r,o),t!=n;t++){let a=e.readFloat(),n=e.readUnsignedByte()/255;switch(e.readByte()){case kt:s.setStepped(t);break;case St:et(e,s,i++,t,0,r,a,o,n,1)}r=a,o=n}i.push(s)}}}}for(let t=0,s=e.readInt(!0);t<s;t++){let t=e.readInt(!0);for(let s=0,n=e.readInt(!0);s<n;s++){let s=e.readByte(),n=e.readInt(!0),r=e.readInt(!0);switch(s){case tt:i.push(Ke(e,new P(n,r,t),1));break;case st:i.push(Ze(e,new A(n,r,t),a));break;case it:i.push(Ke(e,new I(n,r,t),a));break;case at:i.push(Ke(e,new M(n,r,t),a));break;case nt:i.push(Ze(e,new R(n,r,t),1));break;case rt:i.push(Ke(e,new F(n,r,t),1));break;case ot:i.push(Ke(e,new E(n,r,t),1));break;case lt:i.push(Ze(e,new B(n,r,t),1));break;case ht:i.push(Ke(e,new L(n,r,t),1));break;case ct:i.push(Ke(e,new Y(n,r,t),1))}}}for(let t=0,s=e.readInt(!0);t<s;t++){let t=e.readInt(!0),s=e.readInt(!0),n=s-1,r=new q(s,e.readInt(!0),t),o=e.readFloat(),l=e.readFloat(),h=e.readFloat()*a;for(let t=0,s=0;r.setFrame(t,o,l,h,e.readByte(),e.readBoolean(),e.readBoolean()),t!=n;t++){let i=e.readFloat(),n=e.readFloat(),c=e.readFloat()*a;switch(e.readByte()){case kt:r.setStepped(t);break;case St:et(e,r,s++,t,0,o,i,l,n,1),et(e,r,s++,t,1,o,i,h,c,a)}o=i,l=n,h=c}i.push(r)}for(let t=0,s=e.readInt(!0);t<s;t++){let t=e.readInt(!0),s=e.readInt(!0),a=s-1,n=new H(s,e.readInt(!0),t),r=e.readFloat(),o=e.readFloat(),l=e.readFloat(),h=e.readFloat(),c=e.readFloat(),d=e.readFloat(),u=e.readFloat();for(let t=0,s=0;n.setFrame(t,r,o,l,h,c,d,u),t!=a;t++){let i=e.readFloat(),a=e.readFloat(),g=e.readFloat(),m=e.readFloat(),p=e.readFloat(),f=e.readFloat(),y=e.readFloat();switch(e.readByte()){case kt:n.setStepped(t);break;case St:et(e,n,s++,t,0,r,i,o,a,1),et(e,n,s++,t,1,r,i,l,g,1),et(e,n,s++,t,2,r,i,h,m,1),et(e,n,s++,t,3,r,i,c,p,1),et(e,n,s++,t,4,r,i,d,f,1),et(e,n,s++,t,5,r,i,u,y,1)}r=i,o=a,l=g,h=m,c=p,d=f,u=y}i.push(n)}for(let t=0,n=e.readInt(!0);t<n;t++){let t=e.readInt(!0),n=s.pathConstraints[t];for(let s=0,r=e.readInt(!0);s<r;s++)switch(e.readByte()){case xt:i.push(Ke(e,new z(e.readInt(!0),e.readInt(!0),t),n.positionMode==pe.Fixed?a:1));break;case bt:i.push(Ke(e,new j(e.readInt(!0),e.readInt(!0),t),n.spacingMode==fe.Length||n.spacingMode==fe.Fixed?a:1));break;case vt:let s=new $(e.readInt(!0),e.readInt(!0),t),r=e.readFloat(),o=e.readFloat(),l=e.readFloat(),h=e.readFloat();for(let t=0,i=0,a=s.getFrameCount()-1;s.setFrame(t,r,o,l,h),t!=a;t++){let a=e.readFloat(),n=e.readFloat(),c=e.readFloat(),d=e.readFloat();switch(e.readByte()){case kt:s.setStepped(t);break;case St:et(e,s,i++,t,0,r,a,o,n,1),et(e,s,i++,t,1,r,a,l,c,1),et(e,s,i++,t,2,r,a,h,d,1)}r=a,o=n,l=c,h=d}i.push(s)}}for(let t=0,n=e.readInt(!0);t<n;t++){let t=s.skins[e.readInt(!0)];for(let s=0,n=e.readInt(!0);s<n;s++){let s=e.readInt(!0);for(let n=0,r=e.readInt(!0);n<r;n++){let n=e.readStringRef();if(!n)throw new Error("attachmentName must not be null.");let r=t.getAttachment(s,n),o=e.readByte(),l=e.readInt(!0),h=l-1;switch(o){case yt:{let t=r,n=t.bones,o=t.vertices,c=n?o.length/3*2:o.length,u=e.readInt(!0),g=new N(l,u,s,t),m=e.readFloat();for(let t=0,s=0;;t++){let i,r=e.readInt(!0);if(0==r)i=n?d.newFloatArray(c):o;else{i=d.newFloatArray(c);let t=e.readInt(!0);if(r+=t,1==a)for(let s=t;s<r;s++)i[s]=e.readFloat();else for(let s=t;s<r;s++)i[s]=e.readFloat()*a;if(!n)for(let e=0,t=i.length;e<t;e++)i[e]+=o[e]}if(g.setFrame(t,m,i),t==h)break;let l=e.readFloat();switch(e.readByte()){case kt:g.setStepped(t);break;case St:et(e,g,s++,t,0,m,l,0,1,1)}m=l}i.push(g);break}case wt:{let t=new J(l,s,r);for(let s=0;s<l;s++){let i=e.readFloat(),a=e.readInt32();t.setFrame(s,i,w[15&a],a>>4,e.readFloat())}i.push(t);break}}}}}let n=e.readInt(!0);if(n>0){let t=new W(n),a=s.slots.length;for(let s=0;s<n;s++){let i=e.readFloat(),n=e.readInt(!0),r=d.newArray(a,0);for(let e=a-1;e>=0;e--)r[e]=-1;let o=d.newArray(a-n,0),l=0,h=0;for(let t=0;t<n;t++){let t=e.readInt(!0);for(;l!=t;)o[h++]=l++;r[l+e.readInt(!0)]=l++}for(;l<a;)o[h++]=l++;for(let e=a-1;e>=0;e--)-1==r[e]&&(r[e]=o[--h]);t.setFrame(s,i,r)}i.push(t)}let r=e.readInt(!0);if(r>0){let t=new G(r);for(let i=0;i<r;i++){let a=e.readFloat(),n=s.events[e.readInt(!0)],r=new Ue(a,n);r.intValue=e.readInt(!1),r.floatValue=e.readFloat(),r.stringValue=e.readBoolean()?e.readString():n.stringValue,r.data.audioPath&&(r.volume=e.readFloat(),r.balance=e.readFloat()),t.setFrame(i,r)}i.push(t)}let o=0;for(let e=0,t=i.length;e<t;e++)o=Math.max(o,i[e].getDuration());return new x(t,i,o)}}class $e{strings;index;buffer;constructor(e,t=new Array,s=0,i=new DataView(e.buffer)){this.strings=t,this.index=s,this.buffer=i}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){let e=this.buffer.getInt16(this.index);return this.index+=2,e}readInt32(){let e=this.buffer.getInt32(this.index);return this.index+=4,e}readInt(e){let t=this.readByte(),s=127&t;return 128&t&&(t=this.readByte(),s|=(127&t)<<7,128&t&&(t=this.readByte(),s|=(127&t)<<14,128&t&&(t=this.readByte(),s|=(127&t)<<21,128&t&&(t=this.readByte(),s|=(127&t)<<28)))),e?s:s>>>1^-(1&s)}readStringRef(){let e=this.readInt(!0);return 0==e?null:this.strings[e-1]}readString(){let e=this.readInt(!0);switch(e){case 0:return null;case 1:return""}e--;let t="";for(let s=0;s<e;){let e=this.readUnsignedByte();switch(e>>4){case 12:case 13:t+=String.fromCharCode((31&e)<<6|63&this.readByte()),s+=2;break;case 14:t+=String.fromCharCode((15&e)<<12|(63&this.readByte())<<6|63&this.readByte()),s+=3;break;default:t+=String.fromCharCode(e),s++}}return t}readFloat(){let e=this.buffer.getFloat32(this.index);return this.index+=4,e}readBoolean(){return 0!=this.readByte()}}class Je{parent;skin;slotIndex;mesh;inheritTimeline;constructor(e,t,s,i,a){this.mesh=e,this.skin=t,this.slotIndex=s,this.parent=i,this.inheritTimeline=a}}class Qe{bones;vertices;constructor(e=null,t=null){this.bones=e,this.vertices=t}}function Ke(e,t,s){let i=e.readFloat(),a=e.readFloat()*s;for(let n=0,r=0,o=t.getFrameCount()-1;t.setFrame(n,i,a),n!=o;n++){let o=e.readFloat(),l=e.readFloat()*s;switch(e.readByte()){case kt:t.setStepped(n);break;case St:et(e,t,r++,n,0,i,o,a,l,s)}i=o,a=l}return t}function Ze(e,t,s){let i=e.readFloat(),a=e.readFloat()*s,n=e.readFloat()*s;for(let r=0,o=0,l=t.getFrameCount()-1;t.setFrame(r,i,a,n),r!=l;r++){let l=e.readFloat(),h=e.readFloat()*s,c=e.readFloat()*s;switch(e.readByte()){case kt:t.setStepped(r);break;case St:et(e,t,o++,r,0,i,l,a,h,s),et(e,t,o++,r,1,i,l,n,c,s)}i=l,a=h,n=c}return t}function et(e,t,s,i,a,n,r,o,l,h){t.setBezier(s,i,a,n,o,e.readFloat(),e.readFloat()*h,e.readFloat(),e.readFloat()*h,r,l)}!function(e){e[e.Region=0]="Region",e[e.BoundingBox=1]="BoundingBox",e[e.Mesh=2]="Mesh",e[e.LinkedMesh=3]="LinkedMesh",e[e.Path=4]="Path",e[e.Point=5]="Point",e[e.Clipping=6]="Clipping"}(xe||(xe={}));const tt=0,st=1,it=2,at=3,nt=4,rt=5,ot=6,lt=7,ht=8,ct=9,dt=0,ut=1,gt=2,mt=3,pt=4,ft=5,yt=0,wt=1,xt=0,bt=1,vt=2,kt=1,St=2;class Ct{minX=0;minY=0;maxX=0;maxY=0;boundingBoxes=new Array;polygons=new Array;polygonPool=new u(()=>d.newFloatArray(16));update(e,t){if(!e)throw new Error("skeleton cannot be null.");let s=this.boundingBoxes,i=this.polygons,a=this.polygonPool,n=e.slots,r=n.length;s.length=0,a.freeAll(i),i.length=0;for(let e=0;e<r;e++){let t=n[e];if(!t.bone.active)continue;let r=t.getAttachment();if(r instanceof he){let e=r;s.push(e);let n=a.obtain();n.length!=e.worldVerticesLength&&(n=d.newFloatArray(e.worldVerticesLength)),i.push(n),e.computeWorldVertices(t,0,e.worldVerticesLength,n,0,2)}}t?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.polygons;for(let n=0,r=a.length;n<r;n++){let r=a[n],o=r;for(let a=0,n=r.length;a<n;a+=2){let n=o[a],r=o[a+1];e=Math.min(e,n),t=Math.min(t,r),s=Math.max(s,n),i=Math.max(i,r)}}this.minX=e,this.minY=t,this.maxX=s,this.maxY=i}aabbContainsPoint(e,t){return e>=this.minX&&e<=this.maxX&&t>=this.minY&&t<=this.maxY}aabbIntersectsSegment(e,t,s,i){let a=this.minX,n=this.minY,r=this.maxX,o=this.maxY;if(e<=a&&s<=a||t<=n&&i<=n||e>=r&&s>=r||t>=o&&i>=o)return!1;let l=(i-t)/(s-e),h=l*(a-e)+t;if(h>n&&h<o)return!0;if(h=l*(r-e)+t,h>n&&h<o)return!0;let c=(n-t)/l+e;return c>a&&c<r||(c=(o-t)/l+e,c>a&&c<r)}aabbIntersectsSkeleton(e){return this.minX<e.maxX&&this.maxX>e.minX&&this.minY<e.maxY&&this.maxY>e.minY}containsPoint(e,t){let s=this.polygons;for(let i=0,a=s.length;i<a;i++)if(this.containsPointPolygon(s[i],e,t))return this.boundingBoxes[i];return null}containsPointPolygon(e,t,s){let i=e,a=e.length,n=a-2,r=!1;for(let e=0;e<a;e+=2){let a=i[e+1],o=i[n+1];if(a<s&&o>=s||o<s&&a>=s){let l=i[e];l+(s-a)/(o-a)*(i[n]-l)<t&&(r=!r)}n=e}return r}intersectsSegment(e,t,s,i){let a=this.polygons;for(let n=0,r=a.length;n<r;n++)if(this.intersectsSegmentPolygon(a[n],e,t,s,i))return this.boundingBoxes[n];return null}intersectsSegmentPolygon(e,t,s,i,a){let n=e,r=e.length,o=t-i,l=s-a,h=t*a-s*i,c=n[r-2],d=n[r-1];for(let e=0;e<r;e+=2){let r=n[e],u=n[e+1],g=c*u-d*r,m=c-r,p=d-u,f=o*p-l*m,y=(h*m-o*g)/f;if((y>=c&&y<=r||y>=r&&y<=c)&&(y>=t&&y<=i||y>=i&&y<=t)){let e=(h*p-l*g)/f;if((e>=d&&e<=u||e>=u&&e<=d)&&(e>=s&&e<=a||e>=a&&e<=s))return!0}c=r,d=u}return!1}getPolygon(e){if(!e)throw new Error("boundingBox cannot be null.");let t=this.boundingBoxes.indexOf(e);return-1==t?null:this.polygons[t]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}class Tt{convexPolygons=new Array;convexPolygonsIndices=new Array;indicesArray=new Array;isConcaveArray=new Array;triangles=new Array;polygonPool=new u(()=>new Array);polygonIndicesPool=new u(()=>new Array);triangulate(e){let t=e,s=e.length>>1,i=this.indicesArray;i.length=0;for(let e=0;e<s;e++)i[e]=e;let a=this.isConcaveArray;a.length=0;for(let e=0,n=s;e<n;++e)a[e]=Tt.isConcave(e,s,t,i);let n=this.triangles;for(n.length=0;s>3;){let e=s-1,r=0,o=1;for(;;){e:if(!a[r]){let n=i[e]<<1,l=i[r]<<1,h=i[o]<<1,c=t[n],d=t[n+1],u=t[l],g=t[l+1],m=t[h],p=t[h+1];for(let n=(o+1)%s;n!=e;n=(n+1)%s){if(!a[n])continue;let e=i[n]<<1,s=t[e],r=t[e+1];if(Tt.positiveArea(m,p,c,d,s,r)&&Tt.positiveArea(c,d,u,g,s,r)&&Tt.positiveArea(u,g,m,p,s,r))break e}break}if(0==o){do{if(!a[r])break;r--}while(r>0);break}e=r,r=o,o=(o+1)%s}n.push(i[(s+r-1)%s]),n.push(i[r]),n.push(i[(r+1)%s]),i.splice(r,1),a.splice(r,1),s--;let l=(s+r-1)%s,h=r==s?0:r;a[l]=Tt.isConcave(l,s,t,i),a[h]=Tt.isConcave(h,s,t,i)}return 3==s&&(n.push(i[2]),n.push(i[0]),n.push(i[1])),n}decompose(e,t){let s=e,i=this.convexPolygons;this.polygonPool.freeAll(i),i.length=0;let a=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(a),a.length=0;let n=this.polygonIndicesPool.obtain();n.length=0;let r=this.polygonPool.obtain();r.length=0;let o=-1,l=0;for(let e=0,h=t.length;e<h;e+=3){let h=t[e]<<1,c=t[e+1]<<1,d=t[e+2]<<1,u=s[h],g=s[h+1],m=s[c],p=s[c+1],f=s[d],y=s[d+1],w=!1;if(o==h){let e=r.length-4,t=Tt.winding(r[e],r[e+1],r[e+2],r[e+3],f,y),s=Tt.winding(f,y,r[0],r[1],r[2],r[3]);t==l&&s==l&&(r.push(f),r.push(y),n.push(d),w=!0)}w||(r.length>0?(i.push(r),a.push(n)):(this.polygonPool.free(r),this.polygonIndicesPool.free(n)),r=this.polygonPool.obtain(),r.length=0,r.push(u),r.push(g),r.push(m),r.push(p),r.push(f),r.push(y),n=this.polygonIndicesPool.obtain(),n.length=0,n.push(h),n.push(c),n.push(d),l=Tt.winding(u,g,m,p,f,y),o=h)}r.length>0&&(i.push(r),a.push(n));for(let e=0,t=i.length;e<t;e++){if(n=a[e],0==n.length)continue;let s=n[0],o=n[n.length-1];r=i[e];let l=r.length-4,h=r[l],c=r[l+1],d=r[l+2],u=r[l+3],g=r[0],m=r[1],p=r[2],f=r[3],y=Tt.winding(h,c,d,u,g,m);for(let l=0;l<t;l++){if(l==e)continue;let t=a[l];if(3!=t.length)continue;let w=t[0],x=t[1],b=t[2],v=i[l],k=v[v.length-2],S=v[v.length-1];if(w!=s||x!=o)continue;let C=Tt.winding(h,c,d,u,k,S),T=Tt.winding(k,S,g,m,p,f);C==y&&T==y&&(v.length=0,t.length=0,r.push(k),r.push(S),n.push(b),h=d,c=u,d=k,u=S,l=0)}}for(let e=i.length-1;e>=0;e--)r=i[e],0==r.length&&(i.splice(e,1),this.polygonPool.free(r),n=a[e],a.splice(e,1),this.polygonIndicesPool.free(n));return i}static isConcave(e,t,s,i){let a=i[(t+e-1)%t]<<1,n=i[e]<<1,r=i[(e+1)%t]<<1;return!this.positiveArea(s[a],s[a+1],s[n],s[n+1],s[r],s[r+1])}static positiveArea(e,t,s,i,a,n){return e*(n-i)+s*(t-n)+a*(i-t)>=0}static winding(e,t,s,i,a,n){let r=s-e,o=i-t;return a*o-n*r+r*t-e*o>=0?1:-1}}class Pt{triangulator=new Tt;clippingPolygon=new Array;clipOutput=new Array;clippedVertices=new Array;clippedTriangles=new Array;scratch=new Array;clipAttachment=null;clippingPolygons=null;clipStart(e,t){if(this.clipAttachment)return 0;this.clipAttachment=t;let s=t.worldVerticesLength,i=d.setArraySize(this.clippingPolygon,s);t.computeWorldVertices(e,0,s,i,0,2);let a=this.clippingPolygon;Pt.makeClockwise(a);let n=this.clippingPolygons=this.triangulator.decompose(a,this.triangulator.triangulate(a));for(let e=0,t=n.length;e<t;e++){let t=n[e];Pt.makeClockwise(t),t.push(t[0]),t.push(t[1])}return n.length}clipEndWithSlot(e){this.clipAttachment&&this.clipAttachment.endSlot==e.data&&this.clipEnd()}clipEnd(){this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return null!=this.clipAttachment}clipTriangles(e,t,s,i,a,n,r,o){let l=this.clipOutput,h=this.clippedVertices,c=this.clippedTriangles,u=this.clippingPolygons,g=u.length,m=o?12:8,p=0;h.length=0,c.length=0;e:for(let t=0;t<i;t+=3){let i=s[t]<<1,f=e[i],y=e[i+1],w=a[i],x=a[i+1];i=s[t+1]<<1;let b=e[i],v=e[i+1],k=a[i],S=a[i+1];i=s[t+2]<<1;let C=e[i],T=e[i+1],P=a[i],A=a[i+1];for(let e=0;e<g;e++){let t=h.length;if(!this.clip(f,y,b,v,C,T,u[e],l)){let e=d.setArraySize(h,t+3*m);e[t]=f,e[t+1]=y,e[t+2]=n.r,e[t+3]=n.g,e[t+4]=n.b,e[t+5]=n.a,o?(e[t+6]=w,e[t+7]=x,e[t+8]=r.r,e[t+9]=r.g,e[t+10]=r.b,e[t+11]=r.a,e[t+12]=b,e[t+13]=v,e[t+14]=n.r,e[t+15]=n.g,e[t+16]=n.b,e[t+17]=n.a,e[t+18]=k,e[t+19]=S,e[t+20]=r.r,e[t+21]=r.g,e[t+22]=r.b,e[t+23]=r.a,e[t+24]=C,e[t+25]=T,e[t+26]=n.r,e[t+27]=n.g,e[t+28]=n.b,e[t+29]=n.a,e[t+30]=P,e[t+31]=A,e[t+32]=r.r,e[t+33]=r.g,e[t+34]=r.b,e[t+35]=r.a):(e[t+6]=w,e[t+7]=x,e[t+8]=b,e[t+9]=v,e[t+10]=n.r,e[t+11]=n.g,e[t+12]=n.b,e[t+13]=n.a,e[t+14]=k,e[t+15]=S,e[t+16]=C,e[t+17]=T,e[t+18]=n.r,e[t+19]=n.g,e[t+20]=n.b,e[t+21]=n.a,e[t+22]=P,e[t+23]=A),t=c.length;let s=d.setArraySize(c,t+3);s[t]=p,s[t+1]=p+1,s[t+2]=p+2,p+=3;continue e}{let e=l.length;if(0==e)continue;let s=v-T,i=C-b,a=f-C,u=T-y,g=1/(s*a+i*(y-T)),I=e>>1,M=this.clipOutput,R=d.setArraySize(h,t+I*m);for(let l=0;l<e;l+=2){let e=M[l],h=M[l+1];R[t]=e,R[t+1]=h,R[t+2]=n.r,R[t+3]=n.g,R[t+4]=n.b,R[t+5]=n.a;let c=e-C,d=h-T,p=(s*c+i*d)*g,f=(u*c+a*d)*g,y=1-p-f;R[t+6]=w*p+k*f+P*y,R[t+7]=x*p+S*f+A*y,o&&(R[t+8]=r.r,R[t+9]=r.g,R[t+10]=r.b,R[t+11]=r.a),t+=m}t=c.length;let F=d.setArraySize(c,t+3*(I-2));I--;for(let e=1;e<I;e++)F[t]=p,F[t+1]=p+e,F[t+2]=p+e+1,t+=3;p+=I+1}}}}clip(e,t,s,i,a,n,r,o){let l,h=o,c=!1;r.length%4>=2?(l=o,o=this.scratch):l=this.scratch,l.length=0,l.push(e),l.push(t),l.push(s),l.push(i),l.push(a),l.push(n),l.push(e),l.push(t),o.length=0;let d=r,u=r.length-4;for(let e=0;;e+=2){let t=d[e],s=d[e+1],i=d[e+2],a=d[e+3],n=t-i,r=s-a,g=l,m=l.length-2,p=o.length;for(let e=0;e<m;e+=2){let l=g[e],h=g[e+1],d=g[e+2],u=g[e+3],m=n*(u-a)-r*(d-i)>0;if(n*(h-a)-r*(l-i)>0){if(m){o.push(d),o.push(u);continue}let e=u-h,n=d-l,r=e*(i-t)-n*(a-s);if(Math.abs(r)>1e-6){let c=(n*(s-h)-e*(t-l))/r;o.push(t+(i-t)*c),o.push(s+(a-s)*c)}else o.push(t),o.push(s)}else if(m){let e=u-h,n=d-l,r=e*(i-t)-n*(a-s);if(Math.abs(r)>1e-6){let c=(n*(s-h)-e*(t-l))/r;o.push(t+(i-t)*c),o.push(s+(a-s)*c)}else o.push(t),o.push(s);o.push(d),o.push(u)}c=!0}if(p==o.length)return h.length=0,!0;if(o.push(o[0]),o.push(o[1]),e==u)break;let f=o;(o=l).length=0,l=f}if(h!=o){h.length=0;for(let e=0,t=o.length-2;e<t;e++)h[e]=o[e]}else h.length=h.length-2;return c}static makeClockwise(e){let t=e,s=e.length,i=t[s-2]*t[1]-t[0]*t[s-1],a=0,n=0,r=0,o=0;for(let e=0,l=s-3;e<l;e+=2)a=t[e],n=t[e+1],r=t[e+2],o=t[e+3],i+=a*o-r*n;if(!(i<0))for(let e=0,i=s-2,a=s>>1;e<a;e+=2){let s=t[e],a=t[e+1],n=i-e;t[e]=t[n],t[e+1]=t[n+1],t[n]=s,t[n+1]=a}}}class At{attachmentLoader;scale=1;linkedMeshes=new Array;constructor(e){this.attachmentLoader=e}readSkeletonData(e){let t=this.scale,s=new Ge,i="string"==typeof e?JSON.parse(e):e,a=i.skeleton;if(a&&(s.hash=a.hash,s.version=a.spine,s.x=a.x,s.y=a.y,s.width=a.width,s.height=a.height,s.fps=a.fps,s.imagesPath=a.images),i.bones)for(let e=0;e<i.bones.length;e++){let a=i.bones[e],n=null,r=Et(a,"parent",null);r&&(n=s.findBone(r));let o=new Fe(s.bones.length,a.name,n);o.length=Et(a,"length",0)*t,o.x=Et(a,"x",0)*t,o.y=Et(a,"y",0)*t,o.rotation=Et(a,"rotation",0),o.scaleX=Et(a,"scaleX",1),o.scaleY=Et(a,"scaleY",1),o.shearX=Et(a,"shearX",0),o.shearY=Et(a,"shearY",0),o.transformMode=d.enumValue(me,Et(a,"transform","Normal")),o.skinRequired=Et(a,"skin",!1);let l=Et(a,"color",null);l&&o.color.setFromString(l),s.bones.push(o)}if(i.slots)for(let e=0;e<i.slots.length;e++){let t=i.slots[e],a=s.findBone(t.bone);if(!a)throw new Error(`Couldn't find bone ${t.bone} for slot ${t.name}`);let n=new He(s.slots.length,t.name,a),r=Et(t,"color",null);r&&n.color.setFromString(r);let o=Et(t,"dark",null);o&&(n.darkColor=h.fromString(o)),n.attachmentName=Et(t,"attachment",null),n.blendMode=d.enumValue(we,Et(t,"blend","normal")),s.slots.push(n)}if(i.ik)for(let e=0;e<i.ik.length;e++){let a=i.ik[e],n=new Ye(a.name);n.order=Et(a,"order",0),n.skinRequired=Et(a,"skin",!1);for(let e=0;e<a.bones.length;e++){let t=s.findBone(a.bones[e]);if(!t)throw new Error(`Couldn't find bone ${a.bones[e]} for IK constraint ${a.name}.`);n.bones.push(t)}let r=s.findBone(a.target);if(!r)throw new Error(`Couldn't find target bone ${a.target} for IK constraint ${a.name}.`);n.target=r,n.mix=Et(a,"mix",1),n.softness=Et(a,"softness",0)*t,n.bendDirection=Et(a,"bendPositive",!0)?1:-1,n.compress=Et(a,"compress",!1),n.stretch=Et(a,"stretch",!1),n.uniform=Et(a,"uniform",!1),s.ikConstraints.push(n)}if(i.transform)for(let e=0;e<i.transform.length;e++){let a=i.transform[e],n=new ze(a.name);n.order=Et(a,"order",0),n.skinRequired=Et(a,"skin",!1);for(let e=0;e<a.bones.length;e++){let t=a.bones[e],i=s.findBone(t);if(!i)throw new Error(`Couldn't find bone ${t} for transform constraint ${a.name}.`);n.bones.push(i)}let r=a.target,o=s.findBone(r);if(!o)throw new Error(`Couldn't find target bone ${r} for transform constraint ${a.name}.`);n.target=o,n.local=Et(a,"local",!1),n.relative=Et(a,"relative",!1),n.offsetRotation=Et(a,"rotation",0),n.offsetX=Et(a,"x",0)*t,n.offsetY=Et(a,"y",0)*t,n.offsetScaleX=Et(a,"scaleX",0),n.offsetScaleY=Et(a,"scaleY",0),n.offsetShearY=Et(a,"shearY",0),n.mixRotate=Et(a,"mixRotate",1),n.mixX=Et(a,"mixX",1),n.mixY=Et(a,"mixY",n.mixX),n.mixScaleX=Et(a,"mixScaleX",1),n.mixScaleY=Et(a,"mixScaleY",n.mixScaleX),n.mixShearY=Et(a,"mixShearY",1),s.transformConstraints.push(n)}if(i.path)for(let e=0;e<i.path.length;e++){let a=i.path[e],n=new Oe(a.name);n.order=Et(a,"order",0),n.skinRequired=Et(a,"skin",!1);for(let e=0;e<a.bones.length;e++){let t=a.bones[e],i=s.findBone(t);if(!i)throw new Error(`Couldn't find bone ${t} for path constraint ${a.name}.`);n.bones.push(i)}let r=a.target,o=s.findSlot(r);if(!o)throw new Error(`Couldn't find target slot ${r} for path constraint ${a.name}.`);n.target=o,n.positionMode=d.enumValue(pe,Et(a,"positionMode","Percent")),n.spacingMode=d.enumValue(fe,Et(a,"spacingMode","Length")),n.rotateMode=d.enumValue(ye,Et(a,"rotateMode","Tangent")),n.offsetRotation=Et(a,"rotation",0),n.position=Et(a,"position",0),n.positionMode==pe.Fixed&&(n.position*=t),n.spacing=Et(a,"spacing",0),n.spacingMode!=fe.Length&&n.spacingMode!=fe.Fixed||(n.spacing*=t),n.mixRotate=Et(a,"mixRotate",1),n.mixX=Et(a,"mixX",1),n.mixY=Et(a,"mixY",n.mixX),s.pathConstraints.push(n)}if(i.skins)for(let e=0;e<i.skins.length;e++){let t=i.skins[e],a=new qe(t.name);if(t.bones)for(let e=0;e<t.bones.length;e++){let i=t.bones[e],n=s.findBone(i);if(!n)throw new Error(`Couldn't find bone ${i} for skin ${t.name}.`);a.bones.push(n)}if(t.ik)for(let e=0;e<t.ik.length;e++){let i=t.ik[e],n=s.findIkConstraint(i);if(!n)throw new Error(`Couldn't find IK constraint ${i} for skin ${t.name}.`);a.constraints.push(n)}if(t.transform)for(let e=0;e<t.transform.length;e++){let i=t.transform[e],n=s.findTransformConstraint(i);if(!n)throw new Error(`Couldn't find transform constraint ${i} for skin ${t.name}.`);a.constraints.push(n)}if(t.path)for(let e=0;e<t.path.length;e++){let i=t.path[e],n=s.findPathConstraint(i);if(!n)throw new Error(`Couldn't find path constraint ${i} for skin ${t.name}.`);a.constraints.push(n)}for(let e in t.attachments){let i=s.findSlot(e);if(!i)throw new Error(`Couldn't find slot ${e} for skin ${t.name}.`);let n=t.attachments[e];for(let e in n){let t=this.readAttachment(n[e],a,i.index,e,s);t&&a.setAttachment(i.index,e,t)}}s.skins.push(a),"default"==a.name&&(s.defaultSkin=a)}for(let e=0,t=this.linkedMeshes.length;e<t;e++){let t=this.linkedMeshes[e],i=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!i)throw new Error(`Skin not found: ${t.skin}`);let a=i.getAttachment(t.slotIndex,t.parent);if(!a)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?a:t.mesh,t.mesh.setParentMesh(a),null!=t.mesh.region&&t.mesh.updateRegion()}if(this.linkedMeshes.length=0,i.events)for(let e in i.events){let t=i.events[e],a=new Ne(e);a.intValue=Et(t,"int",0),a.floatValue=Et(t,"float",0),a.stringValue=Et(t,"string",""),a.audioPath=Et(t,"audio",null),a.audioPath&&(a.volume=Et(t,"volume",1),a.balance=Et(t,"balance",0)),s.events.push(a)}if(i.animations)for(let e in i.animations){let t=i.animations[e];this.readAnimation(t,e,s)}return s}readAttachment(e,t,s,i,a){let n=this.scale;switch(i=Et(e,"name",i),Et(e,"type","region")){case"region":{let s=Et(e,"path",i),a=this.readSequence(Et(e,"sequence",null)),r=this.attachmentLoader.newRegionAttachment(t,i,s,a);if(!r)return null;r.path=s,r.x=Et(e,"x",0)*n,r.y=Et(e,"y",0)*n,r.scaleX=Et(e,"scaleX",1),r.scaleY=Et(e,"scaleY",1),r.rotation=Et(e,"rotation",0),r.width=e.width*n,r.height=e.height*n,r.sequence=a;let o=Et(e,"color",null);return o&&r.color.setFromString(o),null!=r.region&&r.updateRegion(),r}case"boundingbox":{let s=this.attachmentLoader.newBoundingBoxAttachment(t,i);if(!s)return null;this.readVertices(e,s,e.vertexCount<<1);let a=Et(e,"color",null);return a&&s.color.setFromString(a),s}case"mesh":case"linkedmesh":{let a=Et(e,"path",i),r=this.readSequence(Et(e,"sequence",null)),o=this.attachmentLoader.newMeshAttachment(t,i,a,r);if(!o)return null;o.path=a;let l=Et(e,"color",null);l&&o.color.setFromString(l),o.width=Et(e,"width",0)*n,o.height=Et(e,"height",0)*n,o.sequence=r;let h=Et(e,"parent",null);if(h)return this.linkedMeshes.push(new It(o,Et(e,"skin",null),s,h,Et(e,"timelines",!0))),o;let c=e.uvs;return this.readVertices(e,o,c.length),o.triangles=e.triangles,o.regionUVs=c,null!=o.region&&o.updateRegion(),o.edges=Et(e,"edges",null),o.hullLength=2*Et(e,"hull",0),o}case"path":{let s=this.attachmentLoader.newPathAttachment(t,i);if(!s)return null;s.closed=Et(e,"closed",!1),s.constantSpeed=Et(e,"constantSpeed",!0);let a=e.vertexCount;this.readVertices(e,s,a<<1);let r=d.newArray(a/3,0);for(let t=0;t<e.lengths.length;t++)r[t]=e.lengths[t]*n;s.lengths=r;let o=Et(e,"color",null);return o&&s.color.setFromString(o),s}case"point":{let s=this.attachmentLoader.newPointAttachment(t,i);if(!s)return null;s.x=Et(e,"x",0)*n,s.y=Et(e,"y",0)*n,s.rotation=Et(e,"rotation",0);let a=Et(e,"color",null);return a&&s.color.setFromString(a),s}case"clipping":{let s=this.attachmentLoader.newClippingAttachment(t,i);if(!s)return null;let n=Et(e,"end",null);n&&(s.endSlot=a.findSlot(n));let r=e.vertexCount;this.readVertices(e,s,r<<1);let o=Et(e,"color",null);return o&&s.color.setFromString(o),s}}return null}readSequence(e){if(null==e)return null;let t=new f(Et(e,"count",0));return t.start=Et(e,"start",1),t.digits=Et(e,"digits",0),t.setupIndex=Et(e,"setup",0),t}readVertices(e,t,s){let i=this.scale;t.worldVerticesLength=s;let a=e.vertices;if(s==a.length){let e=d.toFloatArray(a);if(1!=i)for(let t=0,s=a.length;t<s;t++)e[t]*=i;return void(t.vertices=e)}let n=new Array,r=new Array;for(let e=0,t=a.length;e<t;){let t=a[e++];r.push(t);for(let s=e+4*t;e<s;e+=4)r.push(a[e]),n.push(a[e+1]*i),n.push(a[e+2]*i),n.push(a[e+3])}t.bones=r,t.vertices=d.toFloatArray(n)}readAnimation(e,t,s){let i=this.scale,a=new Array;if(e.slots)for(let t in e.slots){let i=e.slots[t],n=s.findSlot(t);if(!n)throw new Error("Slot not found: "+t);let r=n.index;for(let e in i){let t=i[e];if(!t)continue;let s=t.length;if("attachment"==e){let e=new U(s,r);for(let i=0;i<s;i++){let s=t[i];e.setFrame(i,Et(s,"time",0),Et(s,"name",null))}a.push(e)}else if("rgba"==e){let e=new O(s,s<<2,r),i=t[0],n=Et(i,"time",0),o=h.fromString(i.color);for(let s=0,a=0;;s++){e.setFrame(s,n,o.r,o.g,o.b,o.a);let r=t[s+1];if(!r){e.shrink(a);break}let l=Et(r,"time",0),c=h.fromString(r.color),d=i.curve;d&&(a=Ft(d,e,a,s,0,n,l,o.r,c.r,1),a=Ft(d,e,a,s,1,n,l,o.g,c.g,1),a=Ft(d,e,a,s,2,n,l,o.b,c.b,1),a=Ft(d,e,a,s,3,n,l,o.a,c.a,1)),n=l,o=c,i=r}a.push(e)}else if("rgb"==e){let e=new X(s,3*s,r),i=t[0],n=Et(i,"time",0),o=h.fromString(i.color);for(let s=0,a=0;;s++){e.setFrame(s,n,o.r,o.g,o.b);let r=t[s+1];if(!r){e.shrink(a);break}let l=Et(r,"time",0),c=h.fromString(r.color),d=i.curve;d&&(a=Ft(d,e,a,s,0,n,l,o.r,c.r,1),a=Ft(d,e,a,s,1,n,l,o.g,c.g,1),a=Ft(d,e,a,s,2,n,l,o.b,c.b,1)),n=l,o=c,i=r}a.push(e)}else if("alpha"==e)a.push(Mt(t,new D(s,s,r),0,1));else if("rgba2"==e){let e=new _(s,7*s,r),i=t[0],n=Et(i,"time",0),o=h.fromString(i.light),l=h.fromString(i.dark);for(let s=0,a=0;;s++){e.setFrame(s,n,o.r,o.g,o.b,o.a,l.r,l.g,l.b);let r=t[s+1];if(!r){e.shrink(a);break}let c=Et(r,"time",0),d=h.fromString(r.light),u=h.fromString(r.dark),g=i.curve;g&&(a=Ft(g,e,a,s,0,n,c,o.r,d.r,1),a=Ft(g,e,a,s,1,n,c,o.g,d.g,1),a=Ft(g,e,a,s,2,n,c,o.b,d.b,1),a=Ft(g,e,a,s,3,n,c,o.a,d.a,1),a=Ft(g,e,a,s,4,n,c,l.r,u.r,1),a=Ft(g,e,a,s,5,n,c,l.g,u.g,1),a=Ft(g,e,a,s,6,n,c,l.b,u.b,1)),n=c,o=d,l=u,i=r}a.push(e)}else if("rgb2"==e){let e=new V(s,6*s,r),i=t[0],n=Et(i,"time",0),o=h.fromString(i.light),l=h.fromString(i.dark);for(let s=0,a=0;;s++){e.setFrame(s,n,o.r,o.g,o.b,l.r,l.g,l.b);let r=t[s+1];if(!r){e.shrink(a);break}let c=Et(r,"time",0),d=h.fromString(r.light),u=h.fromString(r.dark),g=i.curve;g&&(a=Ft(g,e,a,s,0,n,c,o.r,d.r,1),a=Ft(g,e,a,s,1,n,c,o.g,d.g,1),a=Ft(g,e,a,s,2,n,c,o.b,d.b,1),a=Ft(g,e,a,s,3,n,c,l.r,u.r,1),a=Ft(g,e,a,s,4,n,c,l.g,u.g,1),a=Ft(g,e,a,s,5,n,c,l.b,u.b,1)),n=c,o=d,l=u,i=r}a.push(e)}}}if(e.bones)for(let t in e.bones){let n=e.bones[t],r=s.findBone(t);if(!r)throw new Error("Bone not found: "+t);let o=r.index;for(let e in n){let t=n[e],s=t.length;if(0!=s)if("rotate"===e)a.push(Mt(t,new P(s,s,o),0,1));else if("translate"===e){let e=new A(s,s<<1,o);a.push(Rt(t,e,"x","y",0,i))}else if("translatex"===e){let e=new I(s,s,o);a.push(Mt(t,e,0,i))}else if("translatey"===e){let e=new M(s,s,o);a.push(Mt(t,e,0,i))}else if("scale"===e){let e=new R(s,s<<1,o);a.push(Rt(t,e,"x","y",1,1))}else if("scalex"===e){let e=new F(s,s,o);a.push(Mt(t,e,1,1))}else if("scaley"===e){let e=new E(s,s,o);a.push(Mt(t,e,1,1))}else if("shear"===e){let e=new B(s,s<<1,o);a.push(Rt(t,e,"x","y",0,1))}else if("shearx"===e){let e=new L(s,s,o);a.push(Mt(t,e,0,1))}else if("sheary"===e){let e=new Y(s,s,o);a.push(Mt(t,e,0,1))}}}if(e.ik)for(let t in e.ik){let n=e.ik[t],r=n[0];if(!r)continue;let o=s.findIkConstraint(t);if(!o)throw new Error("IK Constraint not found: "+t);let l=s.ikConstraints.indexOf(o),h=new q(n.length,n.length<<1,l),c=Et(r,"time",0),d=Et(r,"mix",1),u=Et(r,"softness",0)*i;for(let e=0,t=0;;e++){h.setFrame(e,c,d,u,Et(r,"bendPositive",!0)?1:-1,Et(r,"compress",!1),Et(r,"stretch",!1));let s=n[e+1];if(!s){h.shrink(t);break}let a=Et(s,"time",0),o=Et(s,"mix",1),l=Et(s,"softness",0)*i,g=r.curve;g&&(t=Ft(g,h,t,e,0,c,a,d,o,1),t=Ft(g,h,t,e,1,c,a,u,l,i)),c=a,d=o,u=l,r=s}a.push(h)}if(e.transform)for(let t in e.transform){let i=e.transform[t],n=i[0];if(!n)continue;let r=s.findTransformConstraint(t);if(!r)throw new Error("Transform constraint not found: "+t);let o=s.transformConstraints.indexOf(r),l=new H(i.length,6*i.length,o),h=Et(n,"time",0),c=Et(n,"mixRotate",1),d=Et(n,"mixX",1),u=Et(n,"mixY",d),g=Et(n,"mixScaleX",1),m=Et(n,"mixScaleY",g),p=Et(n,"mixShearY",1);for(let e=0,t=0;;e++){l.setFrame(e,h,c,d,u,g,m,p);let s=i[e+1];if(!s){l.shrink(t);break}let a=Et(s,"time",0),r=Et(s,"mixRotate",1),o=Et(s,"mixX",1),f=Et(s,"mixY",o),y=Et(s,"mixScaleX",1),w=Et(s,"mixScaleY",y),x=Et(s,"mixShearY",1),b=n.curve;b&&(t=Ft(b,l,t,e,0,h,a,c,r,1),t=Ft(b,l,t,e,1,h,a,d,o,1),t=Ft(b,l,t,e,2,h,a,u,f,1),t=Ft(b,l,t,e,3,h,a,g,y,1),t=Ft(b,l,t,e,4,h,a,m,w,1),t=Ft(b,l,t,e,5,h,a,p,x,1)),h=a,c=r,d=o,u=f,g=y,m=w,g=y,n=s}a.push(l)}if(e.path)for(let t in e.path){let n=e.path[t],r=s.findPathConstraint(t);if(!r)throw new Error("Path constraint not found: "+t);let o=s.pathConstraints.indexOf(r);for(let e in n){let t=n[e],s=t[0];if(!s)continue;let l=t.length;if("position"===e){let e=new z(l,l,o);a.push(Mt(t,e,0,r.positionMode==pe.Fixed?i:1))}else if("spacing"===e){let e=new j(l,l,o);a.push(Mt(t,e,0,r.spacingMode==fe.Length||r.spacingMode==fe.Fixed?i:1))}else if("mix"===e){let e=new $(l,3*l,o),i=Et(s,"time",0),n=Et(s,"mixRotate",1),r=Et(s,"mixX",1),h=Et(s,"mixY",r);for(let a=0,o=0;;a++){e.setFrame(a,i,n,r,h);let l=t[a+1];if(!l){e.shrink(o);break}let c=Et(l,"time",0),d=Et(l,"mixRotate",1),u=Et(l,"mixX",1),g=Et(l,"mixY",u),m=s.curve;m&&(o=Ft(m,e,o,a,0,i,c,n,d,1),o=Ft(m,e,o,a,1,i,c,r,u,1),o=Ft(m,e,o,a,2,i,c,h,g,1)),i=c,n=d,r=u,h=g,s=l}a.push(e)}}}if(e.attachments)for(let t in e.attachments){let n=e.attachments[t],r=s.findSkin(t);if(!r)throw new Error("Skin not found: "+t);for(let e in n){let t=n[e],o=s.findSlot(e);if(!o)throw new Error("Slot not found: "+e);let l=o.index;for(let e in t){let s=t[e],n=r.getAttachment(l,e);for(let e in s){let t=s[e],r=t[0];if(r)if("deform"==e){let e=n.bones,s=n.vertices,o=e?s.length/3*2:s.length,h=new N(t.length,t.length,l,n),c=Et(r,"time",0);for(let a=0,n=0;;a++){let l,u=Et(r,"vertices",null);if(u){l=d.newFloatArray(o);let t=Et(r,"offset",0);if(d.arrayCopy(u,0,l,t,u.length),1!=i)for(let e=t,s=e+u.length;e<s;e++)l[e]*=i;if(!e)for(let e=0;e<o;e++)l[e]+=s[e]}else l=e?d.newFloatArray(o):s;h.setFrame(a,c,l);let g=t[a+1];if(!g){h.shrink(n);break}let m=Et(g,"time",0),p=r.curve;p&&(n=Ft(p,h,n,a,0,c,m,0,1,1)),c=m,r=g}a.push(h)}else if("sequence"==e){let e=new J(t.length,l,n),s=0;for(let i=0;i<t.length;i++){let a=Et(r,"delay",s),n=Et(r,"time",0),o=y[Et(r,"mode","hold")],l=Et(r,"index",0);e.setFrame(i,n,o,l,a),s=a,r=t[i+1]}a.push(e)}}}}}if(e.drawOrder){let t=new W(e.drawOrder.length),i=s.slots.length,n=0;for(let a=0;a<e.drawOrder.length;a++,n++){let r=e.drawOrder[a],o=null,l=Et(r,"offsets",null);if(l){o=d.newArray(i,-1);let e=d.newArray(i-l.length,0),t=0,a=0;for(let i=0;i<l.length;i++){let n=l[i],r=s.findSlot(n.slot);if(!r)throw new Error("Slot not found: "+r);let h=r.index;for(;t!=h;)e[a++]=t++;o[t+n.offset]=t++}for(;t<i;)e[a++]=t++;for(let t=i-1;t>=0;t--)-1==o[t]&&(o[t]=e[--a])}t.setFrame(n,Et(r,"time",0),o)}a.push(t)}if(e.events){let t=new G(e.events.length),i=0;for(let a=0;a<e.events.length;a++,i++){let n=e.events[a],r=s.findEvent(n.name);if(!r)throw new Error("Event not found: "+n.name);let o=new Ue(d.toSinglePrecision(Et(n,"time",0)),r);o.intValue=Et(n,"int",r.intValue),o.floatValue=Et(n,"float",r.floatValue),o.stringValue=Et(n,"string",r.stringValue),o.data.audioPath&&(o.volume=Et(n,"volume",1),o.balance=Et(n,"balance",0)),t.setFrame(i,o)}a.push(t)}let n=0;for(let e=0,t=a.length;e<t;e++)n=Math.max(n,a[e].getDuration());s.animations.push(new x(t,a,n))}}class It{parent;skin;slotIndex;mesh;inheritTimeline;constructor(e,t,s,i,a){this.mesh=e,this.skin=t,this.slotIndex=s,this.parent=i,this.inheritTimeline=a}}function Mt(e,t,s,i){let a=e[0],n=Et(a,"time",0),r=Et(a,"value",s)*i,o=0;for(let l=0;;l++){t.setFrame(l,n,r);let h=e[l+1];if(!h)return t.shrink(o),t;let c=Et(h,"time",0),d=Et(h,"value",s)*i;a.curve&&(o=Ft(a.curve,t,o,l,0,n,c,r,d,i)),n=c,r=d,a=h}}function Rt(e,t,s,i,a,n){let r=e[0],o=Et(r,"time",0),l=Et(r,s,a)*n,h=Et(r,i,a)*n,c=0;for(let d=0;;d++){t.setFrame(d,o,l,h);let u=e[d+1];if(!u)return t.shrink(c),t;let g=Et(u,"time",0),m=Et(u,s,a)*n,p=Et(u,i,a)*n,f=r.curve;f&&(c=Ft(f,t,c,d,0,o,g,l,m,n),c=Ft(f,t,c,d,1,o,g,h,p,n)),o=g,l=m,h=p,r=u}}function Ft(e,t,s,i,a,n,r,o,l,h){if("stepped"==e)return t.setStepped(i),s;let c=a<<2,d=e[c],u=e[c+1]*h,g=e[c+2],m=e[c+3]*h;return t.setBezier(s,i,a,n,o,d,u,g,m,r,l),s+1}function Et(e,t,s){return void 0!==e[t]?e[t]:s}var Bt;void 0===Math.fround&&(Math.fround=(Bt=new Float32Array(1),function(e){return Bt[0]=e,Bt[0]}));class Lt{canvas;gl;restorables=new Array;constructor(e,t={alpha:"true"}){if(e instanceof WebGLRenderingContext||"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)this.gl=e,this.canvas=this.gl.canvas;else{let s=e;this.gl=s.getContext("webgl2",t)||s.getContext("webgl",t),this.canvas=s,s.addEventListener("webglcontextlost",e=>{e&&e.preventDefault()}),s.addEventListener("webglcontextrestored",e=>{for(let e=0,t=this.restorables.length;e<t;e++)this.restorables[e].restore()})}}addRestorable(e){this.restorables.push(e)}removeRestorable(e){let t=this.restorables.indexOf(e);t>-1&&this.restorables.splice(t,1)}}class Yt extends de{context;texture=null;boundUnit=0;useMipMaps=!1;static DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL=!1;constructor(e,t,s=!1){super(t),this.context=e instanceof Lt?e:new Lt(e),this.useMipMaps=s,this.restore(),this.context.addRestorable(this)}setFilters(e,t){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,Yt.validateMagFilter(t)),this.useMipMaps=Yt.usesMipMaps(e),this.useMipMaps&&s.generateMipmap(s.TEXTURE_2D)}static validateMagFilter(e){switch(e){case ue.MipMapLinearLinear:case ue.MipMapLinearNearest:case ue.MipMapNearestLinear:case ue.MipMapNearestNearest:return ue.Linear;default:return e}}static usesMipMaps(e){switch(e){case ue.MipMapLinearLinear:case ue.MipMapLinearNearest:case ue.MipMapNearestLinear:case ue.MipMapNearestNearest:return!0;default:return!1}}setWraps(e,t){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t)}update(e){let t=this.context.gl;this.texture||(this.texture=this.context.gl.createTexture()),this.bind(),Yt.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._image),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&t.generateMipmap(t.TEXTURE_2D)}restore(){this.texture=null,this.update(this.useMipMaps)}bind(e=0){let t=this.context.gl;this.boundUnit=e,t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)}unbind(){let e=this.context.gl;e.activeTexture(e.TEXTURE0+this.boundUnit),e.bindTexture(e.TEXTURE_2D,null)}dispose(){this.context.removeRestorable(this),this.context.gl.deleteTexture(this.texture)}}class Ot{x=0;y=0;z=0;constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.z=s}setFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}set(e,t,s){return this.x=e,this.y=t,this.z=s,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}scale(e){return this.x*=e,this.y*=e,this.z*=e,this}normalize(){let e=this.length();return 0==e||(e=1/e,this.x*=e,this.y*=e,this.z*=e),this}cross(e){return this.set(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}multiply(e){let t=e.values;return this.set(this.x*t[Xt]+this.y*t[Dt]+this.z*t[_t]+t[Vt],this.x*t[Ut]+this.y*t[Nt]+this.z*t[Gt]+t[Wt],this.x*t[qt]+this.y*t[Ht]+this.z*t[zt]+t[jt])}project(e){let t=e.values,s=1/(this.x*t[$t]+this.y*t[Jt]+this.z*t[Qt]+t[Kt]);return this.set((this.x*t[Xt]+this.y*t[Dt]+this.z*t[_t]+t[Vt])*s,(this.x*t[Ut]+this.y*t[Nt]+this.z*t[Gt]+t[Wt])*s,(this.x*t[qt]+this.y*t[Ht]+this.z*t[zt]+t[jt])*s)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}distance(e){let t=e.x-this.x,s=e.y-this.y,i=e.z-this.z;return Math.sqrt(t*t+s*s+i*i)}}const Xt=0,Dt=4,_t=8,Vt=12,Ut=1,Nt=5,Gt=9,Wt=13,qt=2,Ht=6,zt=10,jt=14,$t=3,Jt=7,Qt=11,Kt=15;class Zt{temp=new Float32Array(16);values=new Float32Array(16);static xAxis=new Ot;static yAxis=new Ot;static zAxis=new Ot;static tmpMatrix=new Zt;constructor(){let e=this.values;e[Xt]=1,e[Nt]=1,e[zt]=1,e[Kt]=1}set(e){return this.values.set(e),this}transpose(){let e=this.temp,t=this.values;return e[Xt]=t[Xt],e[Dt]=t[Ut],e[_t]=t[qt],e[Vt]=t[$t],e[Ut]=t[Dt],e[Nt]=t[Nt],e[Gt]=t[Ht],e[Wt]=t[Jt],e[qt]=t[_t],e[Ht]=t[Gt],e[zt]=t[zt],e[jt]=t[Qt],e[$t]=t[Vt],e[Jt]=t[Wt],e[Qt]=t[jt],e[Kt]=t[Kt],this.set(e)}identity(){let e=this.values;return e[Xt]=1,e[Dt]=0,e[_t]=0,e[Vt]=0,e[Ut]=0,e[Nt]=1,e[Gt]=0,e[Wt]=0,e[qt]=0,e[Ht]=0,e[zt]=1,e[jt]=0,e[$t]=0,e[Jt]=0,e[Qt]=0,e[Kt]=1,this}invert(){let e=this.values,t=this.temp,s=e[$t]*e[Ht]*e[Gt]*e[Vt]-e[qt]*e[Jt]*e[Gt]*e[Vt]-e[$t]*e[Nt]*e[zt]*e[Vt]+e[Ut]*e[Jt]*e[zt]*e[Vt]+e[qt]*e[Nt]*e[Qt]*e[Vt]-e[Ut]*e[Ht]*e[Qt]*e[Vt]-e[$t]*e[Ht]*e[_t]*e[Wt]+e[qt]*e[Jt]*e[_t]*e[Wt]+e[$t]*e[Dt]*e[zt]*e[Wt]-e[Xt]*e[Jt]*e[zt]*e[Wt]-e[qt]*e[Dt]*e[Qt]*e[Wt]+e[Xt]*e[Ht]*e[Qt]*e[Wt]+e[$t]*e[Nt]*e[_t]*e[jt]-e[Ut]*e[Jt]*e[_t]*e[jt]-e[$t]*e[Dt]*e[Gt]*e[jt]+e[Xt]*e[Jt]*e[Gt]*e[jt]+e[Ut]*e[Dt]*e[Qt]*e[jt]-e[Xt]*e[Nt]*e[Qt]*e[jt]-e[qt]*e[Nt]*e[_t]*e[Kt]+e[Ut]*e[Ht]*e[_t]*e[Kt]+e[qt]*e[Dt]*e[Gt]*e[Kt]-e[Xt]*e[Ht]*e[Gt]*e[Kt]-e[Ut]*e[Dt]*e[zt]*e[Kt]+e[Xt]*e[Nt]*e[zt]*e[Kt];if(0==s)throw new Error("non-invertible matrix");let i=1/s;return t[Xt]=e[Gt]*e[jt]*e[Jt]-e[Wt]*e[zt]*e[Jt]+e[Wt]*e[Ht]*e[Qt]-e[Nt]*e[jt]*e[Qt]-e[Gt]*e[Ht]*e[Kt]+e[Nt]*e[zt]*e[Kt],t[Dt]=e[Vt]*e[zt]*e[Jt]-e[_t]*e[jt]*e[Jt]-e[Vt]*e[Ht]*e[Qt]+e[Dt]*e[jt]*e[Qt]+e[_t]*e[Ht]*e[Kt]-e[Dt]*e[zt]*e[Kt],t[_t]=e[_t]*e[Wt]*e[Jt]-e[Vt]*e[Gt]*e[Jt]+e[Vt]*e[Nt]*e[Qt]-e[Dt]*e[Wt]*e[Qt]-e[_t]*e[Nt]*e[Kt]+e[Dt]*e[Gt]*e[Kt],t[Vt]=e[Vt]*e[Gt]*e[Ht]-e[_t]*e[Wt]*e[Ht]-e[Vt]*e[Nt]*e[zt]+e[Dt]*e[Wt]*e[zt]+e[_t]*e[Nt]*e[jt]-e[Dt]*e[Gt]*e[jt],t[Ut]=e[Wt]*e[zt]*e[$t]-e[Gt]*e[jt]*e[$t]-e[Wt]*e[qt]*e[Qt]+e[Ut]*e[jt]*e[Qt]+e[Gt]*e[qt]*e[Kt]-e[Ut]*e[zt]*e[Kt],t[Nt]=e[_t]*e[jt]*e[$t]-e[Vt]*e[zt]*e[$t]+e[Vt]*e[qt]*e[Qt]-e[Xt]*e[jt]*e[Qt]-e[_t]*e[qt]*e[Kt]+e[Xt]*e[zt]*e[Kt],t[Gt]=e[Vt]*e[Gt]*e[$t]-e[_t]*e[Wt]*e[$t]-e[Vt]*e[Ut]*e[Qt]+e[Xt]*e[Wt]*e[Qt]+e[_t]*e[Ut]*e[Kt]-e[Xt]*e[Gt]*e[Kt],t[Wt]=e[_t]*e[Wt]*e[qt]-e[Vt]*e[Gt]*e[qt]+e[Vt]*e[Ut]*e[zt]-e[Xt]*e[Wt]*e[zt]-e[_t]*e[Ut]*e[jt]+e[Xt]*e[Gt]*e[jt],t[qt]=e[Nt]*e[jt]*e[$t]-e[Wt]*e[Ht]*e[$t]+e[Wt]*e[qt]*e[Jt]-e[Ut]*e[jt]*e[Jt]-e[Nt]*e[qt]*e[Kt]+e[Ut]*e[Ht]*e[Kt],t[Ht]=e[Vt]*e[Ht]*e[$t]-e[Dt]*e[jt]*e[$t]-e[Vt]*e[qt]*e[Jt]+e[Xt]*e[jt]*e[Jt]+e[Dt]*e[qt]*e[Kt]-e[Xt]*e[Ht]*e[Kt],t[zt]=e[Dt]*e[Wt]*e[$t]-e[Vt]*e[Nt]*e[$t]+e[Vt]*e[Ut]*e[Jt]-e[Xt]*e[Wt]*e[Jt]-e[Dt]*e[Ut]*e[Kt]+e[Xt]*e[Nt]*e[Kt],t[jt]=e[Vt]*e[Nt]*e[qt]-e[Dt]*e[Wt]*e[qt]-e[Vt]*e[Ut]*e[Ht]+e[Xt]*e[Wt]*e[Ht]+e[Dt]*e[Ut]*e[jt]-e[Xt]*e[Nt]*e[jt],t[$t]=e[Gt]*e[Ht]*e[$t]-e[Nt]*e[zt]*e[$t]-e[Gt]*e[qt]*e[Jt]+e[Ut]*e[zt]*e[Jt]+e[Nt]*e[qt]*e[Qt]-e[Ut]*e[Ht]*e[Qt],t[Jt]=e[Dt]*e[zt]*e[$t]-e[_t]*e[Ht]*e[$t]+e[_t]*e[qt]*e[Jt]-e[Xt]*e[zt]*e[Jt]-e[Dt]*e[qt]*e[Qt]+e[Xt]*e[Ht]*e[Qt],t[Qt]=e[_t]*e[Nt]*e[$t]-e[Dt]*e[Gt]*e[$t]-e[_t]*e[Ut]*e[Jt]+e[Xt]*e[Gt]*e[Jt]+e[Dt]*e[Ut]*e[Qt]-e[Xt]*e[Nt]*e[Qt],t[Kt]=e[Dt]*e[Gt]*e[qt]-e[_t]*e[Nt]*e[qt]+e[_t]*e[Ut]*e[Ht]-e[Xt]*e[Gt]*e[Ht]-e[Dt]*e[Ut]*e[zt]+e[Xt]*e[Nt]*e[zt],e[Xt]=t[Xt]*i,e[Dt]=t[Dt]*i,e[_t]=t[_t]*i,e[Vt]=t[Vt]*i,e[Ut]=t[Ut]*i,e[Nt]=t[Nt]*i,e[Gt]=t[Gt]*i,e[Wt]=t[Wt]*i,e[qt]=t[qt]*i,e[Ht]=t[Ht]*i,e[zt]=t[zt]*i,e[jt]=t[jt]*i,e[$t]=t[$t]*i,e[Jt]=t[Jt]*i,e[Qt]=t[Qt]*i,e[Kt]=t[Kt]*i,this}determinant(){let e=this.values;return e[$t]*e[Ht]*e[Gt]*e[Vt]-e[qt]*e[Jt]*e[Gt]*e[Vt]-e[$t]*e[Nt]*e[zt]*e[Vt]+e[Ut]*e[Jt]*e[zt]*e[Vt]+e[qt]*e[Nt]*e[Qt]*e[Vt]-e[Ut]*e[Ht]*e[Qt]*e[Vt]-e[$t]*e[Ht]*e[_t]*e[Wt]+e[qt]*e[Jt]*e[_t]*e[Wt]+e[$t]*e[Dt]*e[zt]*e[Wt]-e[Xt]*e[Jt]*e[zt]*e[Wt]-e[qt]*e[Dt]*e[Qt]*e[Wt]+e[Xt]*e[Ht]*e[Qt]*e[Wt]+e[$t]*e[Nt]*e[_t]*e[jt]-e[Ut]*e[Jt]*e[_t]*e[jt]-e[$t]*e[Dt]*e[Gt]*e[jt]+e[Xt]*e[Jt]*e[Gt]*e[jt]+e[Ut]*e[Dt]*e[Qt]*e[jt]-e[Xt]*e[Nt]*e[Qt]*e[jt]-e[qt]*e[Nt]*e[_t]*e[Kt]+e[Ut]*e[Ht]*e[_t]*e[Kt]+e[qt]*e[Dt]*e[Gt]*e[Kt]-e[Xt]*e[Ht]*e[Gt]*e[Kt]-e[Ut]*e[Dt]*e[zt]*e[Kt]+e[Xt]*e[Nt]*e[zt]*e[Kt]}translate(e,t,s){let i=this.values;return i[Vt]+=e,i[Wt]+=t,i[jt]+=s,this}copy(){return(new Zt).set(this.values)}projection(e,t,s,i){this.identity();let a=1/Math.tan(s*(Math.PI/180)/2),n=(t+e)/(e-t),r=2*t*e/(e-t),o=this.values;return o[Xt]=a/i,o[Ut]=0,o[qt]=0,o[$t]=0,o[Dt]=0,o[Nt]=a,o[Ht]=0,o[Jt]=0,o[_t]=0,o[Gt]=0,o[zt]=n,o[Qt]=-1,o[Vt]=0,o[Wt]=0,o[jt]=r,o[Kt]=0,this}ortho2d(e,t,s,i){return this.ortho(e,e+s,t,t+i,0,1)}ortho(e,t,s,i,a,n){this.identity();let r=2/(t-e),o=2/(i-s),l=-2/(n-a),h=-(t+e)/(t-e),c=-(i+s)/(i-s),d=-(n+a)/(n-a),u=this.values;return u[Xt]=r,u[Ut]=0,u[qt]=0,u[$t]=0,u[Dt]=0,u[Nt]=o,u[Ht]=0,u[Jt]=0,u[_t]=0,u[Gt]=0,u[zt]=l,u[Qt]=0,u[Vt]=h,u[Wt]=c,u[jt]=d,u[Kt]=1,this}multiply(e){let t=this.temp,s=this.values,i=e.values;return t[Xt]=s[Xt]*i[Xt]+s[Dt]*i[Ut]+s[_t]*i[qt]+s[Vt]*i[$t],t[Dt]=s[Xt]*i[Dt]+s[Dt]*i[Nt]+s[_t]*i[Ht]+s[Vt]*i[Jt],t[_t]=s[Xt]*i[_t]+s[Dt]*i[Gt]+s[_t]*i[zt]+s[Vt]*i[Qt],t[Vt]=s[Xt]*i[Vt]+s[Dt]*i[Wt]+s[_t]*i[jt]+s[Vt]*i[Kt],t[Ut]=s[Ut]*i[Xt]+s[Nt]*i[Ut]+s[Gt]*i[qt]+s[Wt]*i[$t],t[Nt]=s[Ut]*i[Dt]+s[Nt]*i[Nt]+s[Gt]*i[Ht]+s[Wt]*i[Jt],t[Gt]=s[Ut]*i[_t]+s[Nt]*i[Gt]+s[Gt]*i[zt]+s[Wt]*i[Qt],t[Wt]=s[Ut]*i[Vt]+s[Nt]*i[Wt]+s[Gt]*i[jt]+s[Wt]*i[Kt],t[qt]=s[qt]*i[Xt]+s[Ht]*i[Ut]+s[zt]*i[qt]+s[jt]*i[$t],t[Ht]=s[qt]*i[Dt]+s[Ht]*i[Nt]+s[zt]*i[Ht]+s[jt]*i[Jt],t[zt]=s[qt]*i[_t]+s[Ht]*i[Gt]+s[zt]*i[zt]+s[jt]*i[Qt],t[jt]=s[qt]*i[Vt]+s[Ht]*i[Wt]+s[zt]*i[jt]+s[jt]*i[Kt],t[$t]=s[$t]*i[Xt]+s[Jt]*i[Ut]+s[Qt]*i[qt]+s[Kt]*i[$t],t[Jt]=s[$t]*i[Dt]+s[Jt]*i[Nt]+s[Qt]*i[Ht]+s[Kt]*i[Jt],t[Qt]=s[$t]*i[_t]+s[Jt]*i[Gt]+s[Qt]*i[zt]+s[Kt]*i[Qt],t[Kt]=s[$t]*i[Vt]+s[Jt]*i[Wt]+s[Qt]*i[jt]+s[Kt]*i[Kt],this.set(this.temp)}multiplyLeft(e){let t=this.temp,s=this.values,i=e.values;return t[Xt]=i[Xt]*s[Xt]+i[Dt]*s[Ut]+i[_t]*s[qt]+i[Vt]*s[$t],t[Dt]=i[Xt]*s[Dt]+i[Dt]*s[Nt]+i[_t]*s[Ht]+i[Vt]*s[Jt],t[_t]=i[Xt]*s[_t]+i[Dt]*s[Gt]+i[_t]*s[zt]+i[Vt]*s[Qt],t[Vt]=i[Xt]*s[Vt]+i[Dt]*s[Wt]+i[_t]*s[jt]+i[Vt]*s[Kt],t[Ut]=i[Ut]*s[Xt]+i[Nt]*s[Ut]+i[Gt]*s[qt]+i[Wt]*s[$t],t[Nt]=i[Ut]*s[Dt]+i[Nt]*s[Nt]+i[Gt]*s[Ht]+i[Wt]*s[Jt],t[Gt]=i[Ut]*s[_t]+i[Nt]*s[Gt]+i[Gt]*s[zt]+i[Wt]*s[Qt],t[Wt]=i[Ut]*s[Vt]+i[Nt]*s[Wt]+i[Gt]*s[jt]+i[Wt]*s[Kt],t[qt]=i[qt]*s[Xt]+i[Ht]*s[Ut]+i[zt]*s[qt]+i[jt]*s[$t],t[Ht]=i[qt]*s[Dt]+i[Ht]*s[Nt]+i[zt]*s[Ht]+i[jt]*s[Jt],t[zt]=i[qt]*s[_t]+i[Ht]*s[Gt]+i[zt]*s[zt]+i[jt]*s[Qt],t[jt]=i[qt]*s[Vt]+i[Ht]*s[Wt]+i[zt]*s[jt]+i[jt]*s[Kt],t[$t]=i[$t]*s[Xt]+i[Jt]*s[Ut]+i[Qt]*s[qt]+i[Kt]*s[$t],t[Jt]=i[$t]*s[Dt]+i[Jt]*s[Nt]+i[Qt]*s[Ht]+i[Kt]*s[Jt],t[Qt]=i[$t]*s[_t]+i[Jt]*s[Gt]+i[Qt]*s[zt]+i[Kt]*s[Qt],t[Kt]=i[$t]*s[Vt]+i[Jt]*s[Wt]+i[Qt]*s[jt]+i[Kt]*s[Kt],this.set(this.temp)}lookAt(e,t,s){let i=Zt.xAxis,a=Zt.yAxis,n=Zt.zAxis;n.setFrom(t).normalize(),i.setFrom(t).normalize(),i.cross(s).normalize(),a.setFrom(i).cross(n).normalize(),this.identity();let r=this.values;return r[Xt]=i.x,r[Dt]=i.y,r[_t]=i.z,r[Ut]=a.x,r[Nt]=a.y,r[Gt]=a.z,r[qt]=-n.x,r[Ht]=-n.y,r[zt]=-n.z,Zt.tmpMatrix.identity(),Zt.tmpMatrix.values[Vt]=-e.x,Zt.tmpMatrix.values[Wt]=-e.y,Zt.tmpMatrix.values[jt]=-e.z,this.multiply(Zt.tmpMatrix),this}}class es{position=new Ot(0,0,0);direction=new Ot(0,0,-1);up=new Ot(0,1,0);near=0;far=100;zoom=1;viewportWidth=0;viewportHeight=0;projectionView=new Zt;inverseProjectionView=new Zt;projection=new Zt;view=new Zt;constructor(e,t){this.viewportWidth=e,this.viewportHeight=t,this.update()}update(){let e=this.projection,t=this.view,s=this.projectionView,i=this.inverseProjectionView,a=this.zoom,n=this.viewportWidth,r=this.viewportHeight;e.ortho(a*(-n/2),a*(n/2),a*(-r/2),a*(r/2),this.near,this.far),t.lookAt(this.position,this.direction,this.up),s.set(e.values),s.multiply(t),i.set(s.values).invert()}screenToWorld(e,t,s){let i=e.x,a=s-e.y-1;return e.x=2*i/t-1,e.y=2*a/s-1,e.z=2*e.z-1,e.project(this.inverseProjectionView),e}worldToScreen(e,t,s){return e.project(this.projectionView),e.x=t*(e.x+1)/2,e.y=s*(e.y+1)/2,e.z=(e.z+1)/2,e}setViewport(e,t){this.viewportWidth=e,this.viewportHeight=t}}class ts{vertexShader;fragmentShader;static MVP_MATRIX="u_projTrans";static POSITION="a_position";static COLOR="a_color";static COLOR2="a_color2";static TEXCOORDS="a_texCoords";static SAMPLER="u_texture";context;vs=null;vsSource;fs=null;fsSource;program=null;tmp2x2=new Float32Array(4);tmp3x3=new Float32Array(9);tmp4x4=new Float32Array(16);getProgram(){return this.program}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}getVertexShaderSource(){return this.vsSource}getFragmentSource(){return this.fsSource}constructor(e,t,s){this.vertexShader=t,this.fragmentShader=s,this.vsSource=t,this.fsSource=s,this.context=e instanceof Lt?e:new Lt(e),this.context.addRestorable(this),this.compile()}compile(){let e=this.context.gl;try{if(this.vs=this.compileShader(e.VERTEX_SHADER,this.vertexShader),!this.vs)throw new Error("Couldn't compile vertex shader.");if(this.fs=this.compileShader(e.FRAGMENT_SHADER,this.fragmentShader),!this.fs)throw new Error("Couldn#t compile fragment shader.");this.program=this.compileProgram(this.vs,this.fs)}catch(e){throw this.dispose(),e}}compileShader(e,t){let s=this.context.gl,i=s.createShader(e);if(!i)throw new Error("Couldn't create shader.");if(s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS)){let e="Couldn't compile shader: "+s.getShaderInfoLog(i);if(s.deleteShader(i),!s.isContextLost())throw new Error(e)}return i}compileProgram(e,t){let s=this.context.gl,i=s.createProgram();if(!i)throw new Error("Couldn't compile program.");if(s.attachShader(i,e),s.attachShader(i,t),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS)){let e="Couldn't compile shader program: "+s.getProgramInfoLog(i);if(s.deleteProgram(i),!s.isContextLost())throw new Error(e)}return i}restore(){this.compile()}bind(){this.context.gl.useProgram(this.program)}unbind(){this.context.gl.useProgram(null)}setUniformi(e,t){this.context.gl.uniform1i(this.getUniformLocation(e),t)}setUniformf(e,t){this.context.gl.uniform1f(this.getUniformLocation(e),t)}setUniform2f(e,t,s){this.context.gl.uniform2f(this.getUniformLocation(e),t,s)}setUniform3f(e,t,s,i){this.context.gl.uniform3f(this.getUniformLocation(e),t,s,i)}setUniform4f(e,t,s,i,a){this.context.gl.uniform4f(this.getUniformLocation(e),t,s,i,a)}setUniform2x2f(e,t){let s=this.context.gl;this.tmp2x2.set(t),s.uniformMatrix2fv(this.getUniformLocation(e),!1,this.tmp2x2)}setUniform3x3f(e,t){let s=this.context.gl;this.tmp3x3.set(t),s.uniformMatrix3fv(this.getUniformLocation(e),!1,this.tmp3x3)}setUniform4x4f(e,t){let s=this.context.gl;this.tmp4x4.set(t),s.uniformMatrix4fv(this.getUniformLocation(e),!1,this.tmp4x4)}getUniformLocation(e){let t=this.context.gl;if(!this.program)throw new Error("Shader not compiled.");let s=t.getUniformLocation(this.program,e);if(!s&&!t.isContextLost())throw new Error(`Couldn't find location for uniform ${e}`);return s}getAttributeLocation(e){let t=this.context.gl;if(!this.program)throw new Error("Shader not compiled.");let s=t.getAttribLocation(this.program,e);if(-1==s&&!t.isContextLost())throw new Error(`Couldn't find location for attribute ${e}`);return s}dispose(){this.context.removeRestorable(this);let e=this.context.gl;this.vs&&(e.deleteShader(this.vs),this.vs=null),this.fs&&(e.deleteShader(this.fs),this.fs=null),this.program&&(e.deleteProgram(this.program),this.program=null)}static newColoredTextured(e){let t=`\nattribute vec4 ${ts.POSITION};\nattribute vec4 ${ts.COLOR};\nattribute vec2 ${ts.TEXCOORDS};\nuniform mat4 ${ts.MVP_MATRIX};\nvarying vec4 v_color;\nvarying vec2 v_texCoords;\n\nvoid main () {\n\tv_color = ${ts.COLOR};\n\tv_texCoords = ${ts.TEXCOORDS};\n\tgl_Position = ${ts.MVP_MATRIX} * ${ts.POSITION};\n}\n`;return new ts(e,t,"\n#ifdef GL_ES\n\t#define LOWP lowp\n\tprecision mediump float;\n#else\n\t#define LOWP\n#endif\nvarying LOWP vec4 v_color;\nvarying vec2 v_texCoords;\nuniform sampler2D u_texture;\n\nvoid main () {\n\tgl_FragColor = v_color * texture2D(u_texture, v_texCoords);\n}\n")}static newTwoColoredTextured(e){let t=`\nattribute vec4 ${ts.POSITION};\nattribute vec4 ${ts.COLOR};\nattribute vec4 ${ts.COLOR2};\nattribute vec2 ${ts.TEXCOORDS};\nuniform mat4 ${ts.MVP_MATRIX};\nvarying vec4 v_light;\nvarying vec4 v_dark;\nvarying vec2 v_texCoords;\n\nvoid main () {\n\tv_light = ${ts.COLOR};\n\tv_dark = ${ts.COLOR2};\n\tv_texCoords = ${ts.TEXCOORDS};\n\tgl_Position = ${ts.MVP_MATRIX} * ${ts.POSITION};\n}\n`;return new ts(e,t,"\n#ifdef GL_ES\n\t#define LOWP lowp\n\tprecision mediump float;\n#else\n\t#define LOWP\n#endif\nvarying LOWP vec4 v_light;\nvarying LOWP vec4 v_dark;\nvarying vec2 v_texCoords;\nuniform sampler2D u_texture;\n\nvoid main () {\n\tvec4 texColor = texture2D(u_texture, v_texCoords);\n\tgl_FragColor.a = texColor.a * v_light.a;\n\tgl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n}\n")}static newColored(e){let t=`\nattribute vec4 ${ts.POSITION};\nattribute vec4 ${ts.COLOR};\nuniform mat4 ${ts.MVP_MATRIX};\nvarying vec4 v_color;\n\nvoid main () {\n\tv_color = ${ts.COLOR};\n\tgl_Position = ${ts.MVP_MATRIX} * ${ts.POSITION};\n}\n`;return new ts(e,t,"\n#ifdef GL_ES\n\t#define LOWP lowp\n\tprecision mediump float;\n#else\n\t#define LOWP\n#endif\nvarying LOWP vec4 v_color;\n\nvoid main () {\n\tgl_FragColor = v_color;\n}\n")}}class ss{attributes;context;vertices;verticesBuffer=null;verticesLength=0;dirtyVertices=!1;indices;indicesBuffer=null;indicesLength=0;dirtyIndices=!1;elementsPerVertex=0;getAttributes(){return this.attributes}maxVertices(){return this.vertices.length/this.elementsPerVertex}numVertices(){return this.verticesLength/this.elementsPerVertex}setVerticesLength(e){this.dirtyVertices=!0,this.verticesLength=e}getVertices(){return this.vertices}maxIndices(){return this.indices.length}numIndices(){return this.indicesLength}setIndicesLength(e){this.dirtyIndices=!0,this.indicesLength=e}getIndices(){return this.indices}getVertexSizeInFloats(){let e=0;for(var t=0;t<this.attributes.length;t++)e+=this.attributes[t].numElements;return e}constructor(e,t,s,i){this.attributes=t,this.context=e instanceof Lt?e:new Lt(e),this.elementsPerVertex=0;for(let e=0;e<t.length;e++)this.elementsPerVertex+=t[e].numElements;this.vertices=new Float32Array(s*this.elementsPerVertex),this.indices=new Uint16Array(i),this.context.addRestorable(this)}setVertices(e){if(this.dirtyVertices=!0,e.length>this.vertices.length)throw Error("Mesh can't store more than "+this.maxVertices()+" vertices");this.vertices.set(e,0),this.verticesLength=e.length}setIndices(e){if(this.dirtyIndices=!0,e.length>this.indices.length)throw Error("Mesh can't store more than "+this.maxIndices()+" indices");this.indices.set(e,0),this.indicesLength=e.length}draw(e,t){this.drawWithOffset(e,t,0,this.indicesLength>0?this.indicesLength:this.verticesLength/this.elementsPerVertex)}drawWithOffset(e,t,s,i){let a=this.context.gl;(this.dirtyVertices||this.dirtyIndices)&&this.update(),this.bind(e),this.indicesLength>0?a.drawElements(t,i,a.UNSIGNED_SHORT,2*s):a.drawArrays(t,s,i),this.unbind(e)}bind(e){let t=this.context.gl;t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer);let s=0;for(let i=0;i<this.attributes.length;i++){let a=this.attributes[i],n=e.getAttributeLocation(a.name);t.enableVertexAttribArray(n),t.vertexAttribPointer(n,a.numElements,t.FLOAT,!1,4*this.elementsPerVertex,4*s),s+=a.numElements}this.indicesLength>0&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}unbind(e){let t=this.context.gl;for(let s=0;s<this.attributes.length;s++){let i=this.attributes[s],a=e.getAttributeLocation(i.name);t.disableVertexAttribArray(a)}t.bindBuffer(t.ARRAY_BUFFER,null),this.indicesLength>0&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}update(){let e=this.context.gl;this.dirtyVertices&&(this.verticesBuffer||(this.verticesBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices.subarray(0,this.verticesLength),e.DYNAMIC_DRAW),this.dirtyVertices=!1),this.dirtyIndices&&(this.indicesBuffer||(this.indicesBuffer=e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices.subarray(0,this.indicesLength),e.DYNAMIC_DRAW),this.dirtyIndices=!1)}restore(){this.verticesBuffer=null,this.indicesBuffer=null,this.update()}dispose(){this.context.removeRestorable(this);let e=this.context.gl;e.deleteBuffer(this.verticesBuffer),e.deleteBuffer(this.indicesBuffer)}}class is{name;type;numElements;constructor(e,t,s){this.name=e,this.type=t,this.numElements=s}}class as extends is{constructor(){super(ts.POSITION,ls.Float,2)}}class ns extends is{constructor(e=0){super(ts.TEXCOORDS+(0==e?"":e),ls.Float,2)}}class rs extends is{constructor(){super(ts.COLOR,ls.Float,4)}}class os extends is{constructor(){super(ts.COLOR2,ls.Float,4)}}var ls,hs;!function(e){e[e.Float=0]="Float"}(ls||(ls={}));class cs{static disableCulling=!1;context;drawCalls=0;static globalDrawCalls=0;isDrawing=!1;mesh;shader=null;lastTexture=null;verticesLength=0;indicesLength=0;srcColorBlend;srcAlphaBlend;dstBlend;cullWasEnabled=!1;constructor(e,t=!0,s=10920){if(s>10920)throw new Error("Can't have more than 10920 triangles per batch: "+s);this.context=e instanceof Lt?e:new Lt(e);let i=t?[new as,new rs,new ns,new os]:[new as,new rs,new ns];this.mesh=new ss(e,i,s,3*s);let a=this.context.gl;this.srcColorBlend=a.SRC_ALPHA,this.srcAlphaBlend=a.ONE,this.dstBlend=a.ONE_MINUS_SRC_ALPHA}begin(e){if(this.isDrawing)throw new Error("PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()");this.drawCalls=0,this.shader=e,this.lastTexture=null,this.isDrawing=!0;let t=this.context.gl;t.enable(t.BLEND),t.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend),cs.disableCulling&&(this.cullWasEnabled=t.isEnabled(t.CULL_FACE),this.cullWasEnabled&&t.disable(t.CULL_FACE))}static blendModesGL=[{srcRgb:770,srcRgbPma:1,dstRgb:771,srcAlpha:1},{srcRgb:770,srcRgbPma:1,dstRgb:1,srcAlpha:1},{srcRgb:774,srcRgbPma:774,dstRgb:771,srcAlpha:1},{srcRgb:1,srcRgbPma:1,dstRgb:769,srcAlpha:1}];setBlendMode(e,t){const s=cs.blendModesGL[e],i=t?s.srcRgbPma:s.srcRgb,a=s.srcAlpha,n=s.dstRgb;this.srcColorBlend==i&&this.srcAlphaBlend==a&&this.dstBlend==n||(this.srcColorBlend=i,this.srcAlphaBlend=a,this.dstBlend=n,this.isDrawing&&this.flush(),this.context.gl.blendFuncSeparate(i,n,a,n))}draw(e,t,s){e!=this.lastTexture?(this.flush(),this.lastTexture=e):(this.verticesLength+t.length>this.mesh.getVertices().length||this.indicesLength+s.length>this.mesh.getIndices().length)&&this.flush();let i=this.mesh.numVertices();this.mesh.getVertices().set(t,this.verticesLength),this.verticesLength+=t.length,this.mesh.setVerticesLength(this.verticesLength);let a=this.mesh.getIndices();for(let e=this.indicesLength,t=0;t<s.length;e++,t++)a[e]=s[t]+i;this.indicesLength+=s.length,this.mesh.setIndicesLength(this.indicesLength)}flush(){if(0!=this.verticesLength){if(!this.lastTexture)throw new Error("No texture set.");if(!this.shader)throw new Error("No shader set.");this.lastTexture.bind(),this.mesh.draw(this.shader,this.context.gl.TRIANGLES),this.verticesLength=0,this.indicesLength=0,this.mesh.setVerticesLength(0),this.mesh.setIndicesLength(0),this.drawCalls++,cs.globalDrawCalls++}}end(){if(!this.isDrawing)throw new Error("PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()");(this.verticesLength>0||this.indicesLength>0)&&this.flush(),this.shader=null,this.lastTexture=null,this.isDrawing=!1;let e=this.context.gl;e.disable(e.BLEND),cs.disableCulling&&this.cullWasEnabled&&e.enable(e.CULL_FACE)}getDrawCalls(){return this.drawCalls}static getAndResetGlobalDrawCalls(){let e=cs.globalDrawCalls;return cs.globalDrawCalls=0,e}dispose(){this.mesh.dispose()}}class ds{context;isDrawing=!1;mesh;shapeType=hs.Filled;color=new h(1,1,1,1);shader=null;vertexIndex=0;tmp=new g;srcColorBlend;srcAlphaBlend;dstBlend;constructor(e,t=10920){if(t>10920)throw new Error("Can't have more than 10920 triangles per batch: "+t);this.context=e instanceof Lt?e:new Lt(e),this.mesh=new ss(e,[new as,new rs],t,0);let s=this.context.gl;this.srcColorBlend=s.SRC_ALPHA,this.srcAlphaBlend=s.ONE,this.dstBlend=s.ONE_MINUS_SRC_ALPHA}begin(e){if(this.isDrawing)throw new Error("ShapeRenderer.begin() has already been called");this.shader=e,this.vertexIndex=0,this.isDrawing=!0;let t=this.context.gl;t.enable(t.BLEND),t.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}setBlendMode(e,t,s){this.srcColorBlend=e,this.srcAlphaBlend=t,this.dstBlend=s,this.isDrawing&&(this.flush(),this.context.gl.blendFuncSeparate(e,s,t,s))}setColor(e){this.color.setFromColor(e)}setColorWith(e,t,s,i){this.color.set(e,t,s,i)}point(e,t,s){this.check(hs.Point,1),s||(s=this.color),this.vertex(e,t,s)}line(e,t,s,i,a){this.check(hs.Line,2),this.mesh.getVertices(),this.vertexIndex,a||(a=this.color),this.vertex(e,t,a),this.vertex(s,i,a)}triangle(e,t,s,i,a,n,r,o,l,h){this.check(e?hs.Filled:hs.Line,3),this.mesh.getVertices(),this.vertexIndex,o||(o=this.color),l||(l=this.color),h||(h=this.color),e?(this.vertex(t,s,o),this.vertex(i,a,l),this.vertex(n,r,h)):(this.vertex(t,s,o),this.vertex(i,a,l),this.vertex(i,a,o),this.vertex(n,r,l),this.vertex(n,r,o),this.vertex(t,s,l))}quad(e,t,s,i,a,n,r,o,l,h,c,d,u){this.check(e?hs.Filled:hs.Line,3),this.mesh.getVertices(),this.vertexIndex,h||(h=this.color),c||(c=this.color),d||(d=this.color),u||(u=this.color),e?(this.vertex(t,s,h),this.vertex(i,a,c),this.vertex(n,r,d),this.vertex(n,r,d),this.vertex(o,l,u),this.vertex(t,s,h)):(this.vertex(t,s,h),this.vertex(i,a,c),this.vertex(i,a,c),this.vertex(n,r,d),this.vertex(n,r,d),this.vertex(o,l,u),this.vertex(o,l,u),this.vertex(t,s,h))}rect(e,t,s,i,a,n){this.quad(e,t,s,t+i,s,t+i,s+a,t,s+a,n,n,n,n)}rectLine(e,t,s,i,a,n,r){this.check(e?hs.Filled:hs.Line,8),r||(r=this.color);let o=this.tmp.set(a-s,t-i);o.normalize(),n*=.5;let l=o.x*n,h=o.y*n;e?(this.vertex(t+l,s+h,r),this.vertex(t-l,s-h,r),this.vertex(i+l,a+h,r),this.vertex(i-l,a-h,r),this.vertex(i+l,a+h,r),this.vertex(t-l,s-h,r)):(this.vertex(t+l,s+h,r),this.vertex(t-l,s-h,r),this.vertex(i+l,a+h,r),this.vertex(i-l,a-h,r),this.vertex(i+l,a+h,r),this.vertex(t+l,s+h,r),this.vertex(i-l,a-h,r),this.vertex(t-l,s-h,r))}x(e,t,s){this.line(e-s,t-s,e+s,t+s),this.line(e-s,t+s,e+s,t-s)}polygon(e,t,s,i){if(s<3)throw new Error("Polygon must contain at least 3 vertices");this.check(hs.Line,2*s),i||(i=this.color),this.mesh.getVertices(),this.vertexIndex,s<<=1;let a=e[t<<=1],n=e[t+1],r=t+s;for(let o=t,l=t+s-2;o<l;o+=2){let t=e[o],s=e[o+1],l=0,h=0;o+2>=r?(l=a,h=n):(l=e[o+2],h=e[o+3]),this.vertex(t,s,i),this.vertex(l,h,i)}}circle(e,t,s,i,a,n=0){if(0==n&&(n=Math.max(1,6*c.cbrt(i)|0)),n<=0)throw new Error("segments must be > 0.");a||(a=this.color);let r=2*c.PI/n,o=Math.cos(r),l=Math.sin(r),h=i,d=0;if(e){this.check(hs.Filled,3*n+3),n--;for(let e=0;e<n;e++){this.vertex(t,s,a),this.vertex(t+h,s+d,a);let e=h;h=o*h-l*d,d=l*e+o*d,this.vertex(t+h,s+d,a)}this.vertex(t,s,a),this.vertex(t+h,s+d,a)}else{this.check(hs.Line,2*n+2);for(let e=0;e<n;e++){this.vertex(t+h,s+d,a);let e=h;h=o*h-l*d,d=l*e+o*d,this.vertex(t+h,s+d,a)}this.vertex(t+h,s+d,a)}h=i,d=0,this.vertex(t+h,s+d,a)}curve(e,t,s,i,a,n,r,o,l,h){this.check(hs.Line,2*l+2),h||(h=this.color);let c=1/l,d=c*c,u=c*c*c,g=3*c,m=3*d,p=6*d,f=6*u,y=e-2*s+a,w=t-2*i+n,x=3*(s-a)-e+r,b=3*(i-n)-t+o,v=e,k=t,S=(s-e)*g+y*m+x*u,C=(i-t)*g+w*m+b*u,T=y*p+x*f,P=w*p+b*f,A=x*f,I=b*f;for(;l-- >0;)this.vertex(v,k,h),v+=S,k+=C,S+=T,C+=P,T+=A,P+=I,this.vertex(v,k,h);this.vertex(v,k,h),this.vertex(r,o,h)}vertex(e,t,s){let i=this.vertexIndex,a=this.mesh.getVertices();a[i++]=e,a[i++]=t,a[i++]=s.r,a[i++]=s.g,a[i++]=s.b,a[i++]=s.a,this.vertexIndex=i}end(){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");this.flush();let e=this.context.gl;e.disable(e.BLEND),this.isDrawing=!1}flush(){if(0!=this.vertexIndex){if(!this.shader)throw new Error("No shader set.");this.mesh.setVerticesLength(this.vertexIndex),this.mesh.draw(this.shader,this.shapeType),this.vertexIndex=0}}check(e,t){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");if(this.shapeType==e){if(!(this.mesh.maxVertices()-this.mesh.numVertices()<t))return;this.flush()}else this.flush(),this.shapeType=e}dispose(){this.mesh.dispose()}}!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Filled=4]="Filled"}(hs||(hs={}));class us{boneLineColor=new h(1,0,0,1);boneOriginColor=new h(0,1,0,1);attachmentLineColor=new h(0,0,1,.5);triangleLineColor=new h(1,.64,0,.5);pathColor=(new h).setFromString("FF7F00");clipColor=new h(.8,0,0,2);aabbColor=new h(0,1,0,.5);drawBones=!0;drawRegionAttachments=!0;drawBoundingBoxes=!0;drawMeshHull=!0;drawMeshTriangles=!0;drawPaths=!0;drawSkeletonXY=!1;drawClipping=!0;premultipliedAlpha=!1;scale=1;boneWidth=2;context;bounds=new Ct;temp=new Array;vertices=d.newFloatArray(2048);static LIGHT_GRAY=new h(192/255,192/255,192/255,1);static GREEN=new h(0,1,0,1);constructor(e){this.context=e instanceof Lt?e:new Lt(e)}draw(e,t,s){let i=t.x,a=t.y,n=this.context.gl,r=this.premultipliedAlpha?n.ONE:n.SRC_ALPHA;e.setBlendMode(r,n.ONE,n.ONE_MINUS_SRC_ALPHA);let o=t.bones;if(this.drawBones){e.setColor(this.boneLineColor);for(let t=0,i=o.length;t<i;t++){let i=o[t];if(s&&s.indexOf(i.data.name)>-1)continue;if(!i.parent)continue;let a=i.data.length*i.a+i.worldX,n=i.data.length*i.c+i.worldY;e.rectLine(!0,i.worldX,i.worldY,a,n,this.boneWidth*this.scale)}this.drawSkeletonXY&&e.x(i,a,4*this.scale)}if(this.drawRegionAttachments){e.setColor(this.attachmentLineColor);let s=t.slots;for(let t=0,i=s.length;t<i;t++){let i=s[t],a=i.getAttachment();if(a instanceof Me){let t=a,s=this.vertices;t.computeWorldVertices(i,s,0,2),e.line(s[0],s[1],s[2],s[3]),e.line(s[2],s[3],s[4],s[5]),e.line(s[4],s[5],s[6],s[7]),e.line(s[6],s[7],s[0],s[1])}}}if(this.drawMeshHull||this.drawMeshTriangles){let s=t.slots;for(let t=0,i=s.length;t<i;t++){let i=s[t];if(!i.bone.active)continue;let a=i.getAttachment();if(!(a instanceof Pe))continue;let n=a,r=this.vertices;n.computeWorldVertices(i,0,n.worldVerticesLength,r,0,2);let o=n.triangles,l=n.hullLength;if(this.drawMeshTriangles){e.setColor(this.triangleLineColor);for(let t=0,s=o.length;t<s;t+=3){let s=2*o[t],i=2*o[t+1],a=2*o[t+2];e.triangle(!1,r[s],r[s+1],r[i],r[i+1],r[a],r[a+1])}}if(this.drawMeshHull&&l>0){e.setColor(this.attachmentLineColor),l=2*(l>>1);let t=r[l-2],s=r[l-1];for(let i=0,a=l;i<a;i+=2){let a=r[i],n=r[i+1];e.line(a,n,t,s),t=a,s=n}}}}if(this.drawBoundingBoxes){let s=this.bounds;s.update(t,!0),e.setColor(this.aabbColor),e.rect(!1,s.minX,s.minY,s.getWidth(),s.getHeight());let i=s.polygons,a=s.boundingBoxes;for(let t=0,s=i.length;t<s;t++){let s=i[t];e.setColor(a[t].color),e.polygon(s,0,s.length)}}if(this.drawPaths){let s=t.slots;for(let t=0,i=s.length;t<i;t++){let i=s[t];if(!i.bone.active)continue;let a=i.getAttachment();if(!(a instanceof Ae))continue;let n=a,r=n.worldVerticesLength,o=this.temp=d.setArraySize(this.temp,r,0);n.computeWorldVertices(i,0,r,o,0,2);let l=this.pathColor,h=o[2],c=o[3],u=0,g=0;if(n.closed){e.setColor(l);let t=o[0],s=o[1],i=o[r-2],a=o[r-1];u=o[r-4],g=o[r-3],e.curve(h,c,t,s,i,a,u,g,32),e.setColor(us.LIGHT_GRAY),e.line(h,c,t,s),e.line(u,g,i,a)}r-=4;for(let t=4;t<r;t+=6){let s=o[t],i=o[t+1],a=o[t+2],n=o[t+3];u=o[t+4],g=o[t+5],e.setColor(l),e.curve(h,c,s,i,a,n,u,g,32),e.setColor(us.LIGHT_GRAY),e.line(h,c,s,i),e.line(u,g,a,n),h=u,c=g}}}if(this.drawBones){e.setColor(this.boneOriginColor);for(let t=0,i=o.length;t<i;t++){let i=o[t];s&&s.indexOf(i.data.name)>-1||e.circle(!0,i.worldX,i.worldY,3*this.scale,this.boneOriginColor,8)}}if(this.drawClipping){let s=t.slots;e.setColor(this.clipColor);for(let t=0,i=s.length;t<i;t++){let i=s[t];if(!i.bone.active)continue;let a=i.getAttachment();if(!(a instanceof ce))continue;let n=a,r=n.worldVerticesLength,o=this.temp=d.setArraySize(this.temp,r,0);n.computeWorldVertices(i,0,r,o,0,2);for(let t=0,s=o.length;t<s;t+=2){let s=o[t],i=o[t+1],a=o[(t+2)%o.length],n=o[(t+3)%o.length];e.line(s,i,a,n)}}}}dispose(){}}class gs{vertices;numVertices;numFloats;constructor(e,t,s){this.vertices=e,this.numVertices=t,this.numFloats=s}}class ms{static QUAD_TRIANGLES=[0,1,2,2,3,0];premultipliedAlpha=!1;tempColor=new h;tempColor2=new h;vertices;vertexSize=8;twoColorTint=!1;renderable=new gs([],0,0);clipper=new Pt;temp=new g;temp2=new g;temp3=new h;temp4=new h;constructor(e,t=!0){this.twoColorTint=t,t&&(this.vertexSize+=4),this.vertices=d.newFloatArray(1024*this.vertexSize)}draw(e,t,s=-1,i=-1,a=null){let n,r,o,l=this.clipper,h=this.premultipliedAlpha,c=this.twoColorTint,u=null,g=this.renderable,m=t.drawOrder,p=t.color,f=c?12:8,y=!1;-1==s&&(y=!0);for(let t=0,w=m.length;t<w;t++){let w=l.isClipping()?2:f,x=m[t];if(!x.bone.active){l.clipEndWithSlot(x);continue}if(s>=0&&s==x.data.index&&(y=!0),!y){l.clipEndWithSlot(x);continue}i>=0&&i==x.data.index&&(y=!1);let b,v=x.getAttachment();if(v instanceof Me){let e=v;g.vertices=this.vertices,g.numVertices=4,g.numFloats=w<<2,e.computeWorldVertices(x,g.vertices,0,w),r=ms.QUAD_TRIANGLES,n=e.uvs,b=e.region.texture,o=e.color}else{if(!(v instanceof Pe)){if(v instanceof ce){let e=v;l.clipStart(x,e);continue}l.clipEndWithSlot(x);continue}{let e=v;g.vertices=this.vertices,g.numVertices=e.worldVerticesLength>>1,g.numFloats=g.numVertices*w,g.numFloats>g.vertices.length&&(g.vertices=this.vertices=d.newFloatArray(g.numFloats)),e.computeWorldVertices(x,0,e.worldVerticesLength,g.vertices,0,w),r=e.triangles,b=e.region.texture,n=e.uvs,o=e.color}}if(b){let t=x.color,s=this.tempColor;s.r=p.r*t.r*o.r,s.g=p.g*t.g*o.g,s.b=p.b*t.b*o.b,s.a=p.a*t.a*o.a,h&&(s.r*=s.a,s.g*=s.a,s.b*=s.a);let i=this.tempColor2;x.darkColor?(h?(i.r=x.darkColor.r*s.a,i.g=x.darkColor.g*s.a,i.b=x.darkColor.b*s.a):i.setFromColor(x.darkColor),i.a=h?1:0):i.set(0,0,0,1);let d=x.data.blendMode;if(d!=u&&(u=d,e.setBlendMode(u,h)),l.isClipping()){l.clipTriangles(g.vertices,g.numFloats,r,r.length,n,s,i,c);let t=new Float32Array(l.clippedVertices),o=l.clippedTriangles;a&&a(t,t.length,f),e.draw(b,t,o)}else{let t=g.vertices;if(c)for(let e=2,a=0,r=g.numFloats;e<r;e+=f,a+=2)t[e]=s.r,t[e+1]=s.g,t[e+2]=s.b,t[e+3]=s.a,t[e+4]=n[a],t[e+5]=n[a+1],t[e+6]=i.r,t[e+7]=i.g,t[e+8]=i.b,t[e+9]=i.a;else for(let e=2,i=0,a=g.numFloats;e<a;e+=f,i+=2)t[e]=s.r,t[e+1]=s.g,t[e+2]=s.b,t[e+3]=s.a,t[e+4]=n[i],t[e+5]=n[i+1];let o=g.vertices.subarray(0,g.numFloats);a&&a(g.vertices,g.numFloats,f),e.draw(b,o,r)}}l.clipEndWithSlot(x)}l.clipEnd()}}const ps=[0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0],fs=[0,1,2,2,3,0],ys=new h(1,1,1,1);class ws{context;canvas;camera;batcher;twoColorTint=!1;batcherShader;shapes;shapesShader;activeRenderer=null;skeletonRenderer;skeletonDebugRenderer;constructor(e,t,s=!0){this.canvas=e,this.context=t instanceof Lt?t:new Lt(t),this.twoColorTint=s,this.camera=new es(e.width,e.height),this.batcherShader=s?ts.newTwoColoredTextured(this.context):ts.newColoredTextured(this.context),this.batcher=new cs(this.context,s),this.shapesShader=ts.newColored(this.context),this.shapes=new ds(this.context),this.skeletonRenderer=new ms(this.context,s),this.skeletonDebugRenderer=new us(this.context)}dispose(){this.batcher.dispose(),this.batcherShader.dispose(),this.shapes.dispose(),this.shapesShader.dispose(),this.skeletonDebugRenderer.dispose()}begin(){this.camera.update(),this.enableRenderer(this.batcher)}drawSkeleton(e,t=!1,s=-1,i=-1,a=null){this.enableRenderer(this.batcher),this.skeletonRenderer.premultipliedAlpha=t,this.skeletonRenderer.draw(this.batcher,e,s,i,a)}drawSkeletonDebug(e,t=!1,s){this.enableRenderer(this.shapes),this.skeletonDebugRenderer.premultipliedAlpha=t,this.skeletonDebugRenderer.draw(this.shapes,e,s)}drawTexture(e,t,s,i,a,n){this.enableRenderer(this.batcher),n||(n=ys);var r=0;ps[r++]=t,ps[r++]=s,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=0,ps[r++]=1,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r++]=0),ps[r++]=t+i,ps[r++]=s,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=1,ps[r++]=1,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r++]=0),ps[r++]=t+i,ps[r++]=s+a,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=1,ps[r++]=0,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r++]=0),ps[r++]=t,ps[r++]=s+a,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=0,ps[r++]=0,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r]=0),this.batcher.draw(e,ps,fs)}drawTextureUV(e,t,s,i,a,n,r,o,l,h){this.enableRenderer(this.batcher),h||(h=ys);var c=0;ps[c++]=t,ps[c++]=s,ps[c++]=h.r,ps[c++]=h.g,ps[c++]=h.b,ps[c++]=h.a,ps[c++]=n,ps[c++]=r,this.twoColorTint&&(ps[c++]=0,ps[c++]=0,ps[c++]=0,ps[c++]=0),ps[c++]=t+i,ps[c++]=s,ps[c++]=h.r,ps[c++]=h.g,ps[c++]=h.b,ps[c++]=h.a,ps[c++]=o,ps[c++]=r,this.twoColorTint&&(ps[c++]=0,ps[c++]=0,ps[c++]=0,ps[c++]=0),ps[c++]=t+i,ps[c++]=s+a,ps[c++]=h.r,ps[c++]=h.g,ps[c++]=h.b,ps[c++]=h.a,ps[c++]=o,ps[c++]=l,this.twoColorTint&&(ps[c++]=0,ps[c++]=0,ps[c++]=0,ps[c++]=0),ps[c++]=t,ps[c++]=s+a,ps[c++]=h.r,ps[c++]=h.g,ps[c++]=h.b,ps[c++]=h.a,ps[c++]=n,ps[c++]=l,this.twoColorTint&&(ps[c++]=0,ps[c++]=0,ps[c++]=0,ps[c]=0),this.batcher.draw(e,ps,fs)}drawTextureRotated(e,t,s,i,a,n,r,o,l){this.enableRenderer(this.batcher),l||(l=ys);let h=t+n,d=s+r,u=-n,g=-r,m=i-n,p=a-r,f=u,y=g,w=u,x=p,b=m,v=p,k=m,S=g,C=0,T=0,P=0,A=0,I=0,M=0,R=0,F=0;if(0!=o){let e=c.cosDeg(o),t=c.sinDeg(o);C=e*f-t*y,T=t*f+e*y,R=e*w-t*x,F=t*w+e*x,I=e*b-t*v,M=t*b+e*v,P=I+(C-R),A=M+(T-F)}else C=f,T=y,R=w,F=x,I=b,M=v,P=k,A=S;C+=h,T+=d,P+=h,A+=d,I+=h,M+=d,R+=h,F+=d;var E=0;ps[E++]=C,ps[E++]=T,ps[E++]=l.r,ps[E++]=l.g,ps[E++]=l.b,ps[E++]=l.a,ps[E++]=0,ps[E++]=1,this.twoColorTint&&(ps[E++]=0,ps[E++]=0,ps[E++]=0,ps[E++]=0),ps[E++]=P,ps[E++]=A,ps[E++]=l.r,ps[E++]=l.g,ps[E++]=l.b,ps[E++]=l.a,ps[E++]=1,ps[E++]=1,this.twoColorTint&&(ps[E++]=0,ps[E++]=0,ps[E++]=0,ps[E++]=0),ps[E++]=I,ps[E++]=M,ps[E++]=l.r,ps[E++]=l.g,ps[E++]=l.b,ps[E++]=l.a,ps[E++]=1,ps[E++]=0,this.twoColorTint&&(ps[E++]=0,ps[E++]=0,ps[E++]=0,ps[E++]=0),ps[E++]=R,ps[E++]=F,ps[E++]=l.r,ps[E++]=l.g,ps[E++]=l.b,ps[E++]=l.a,ps[E++]=0,ps[E++]=0,this.twoColorTint&&(ps[E++]=0,ps[E++]=0,ps[E++]=0,ps[E]=0),this.batcher.draw(e,ps,fs)}drawRegion(e,t,s,i,a,n){this.enableRenderer(this.batcher),n||(n=ys);var r=0;ps[r++]=t,ps[r++]=s,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=e.u,ps[r++]=e.v2,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r++]=0),ps[r++]=t+i,ps[r++]=s,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=e.u2,ps[r++]=e.v2,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r++]=0),ps[r++]=t+i,ps[r++]=s+a,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=e.u2,ps[r++]=e.v,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r++]=0),ps[r++]=t,ps[r++]=s+a,ps[r++]=n.r,ps[r++]=n.g,ps[r++]=n.b,ps[r++]=n.a,ps[r++]=e.u,ps[r++]=e.v,this.twoColorTint&&(ps[r++]=0,ps[r++]=0,ps[r++]=0,ps[r]=0),this.batcher.draw(e.page.texture,ps,fs)}line(e,t,s,i,a,n){this.enableRenderer(this.shapes),this.shapes.line(e,t,s,i,a)}triangle(e,t,s,i,a,n,r,o,l,h){this.enableRenderer(this.shapes),this.shapes.triangle(e,t,s,i,a,n,r,o,l,h)}quad(e,t,s,i,a,n,r,o,l,h,c,d,u){this.enableRenderer(this.shapes),this.shapes.quad(e,t,s,i,a,n,r,o,l,h,c,d,u)}rect(e,t,s,i,a,n){this.enableRenderer(this.shapes),this.shapes.rect(e,t,s,i,a,n)}rectLine(e,t,s,i,a,n,r){this.enableRenderer(this.shapes),this.shapes.rectLine(e,t,s,i,a,n,r)}polygon(e,t,s,i){this.enableRenderer(this.shapes),this.shapes.polygon(e,t,s,i)}circle(e,t,s,i,a,n=0){this.enableRenderer(this.shapes),this.shapes.circle(e,t,s,i,a,n)}curve(e,t,s,i,a,n,r,o,l,h){this.enableRenderer(this.shapes),this.shapes.curve(e,t,s,i,a,n,r,o,l,h)}end(){this.activeRenderer===this.batcher?this.batcher.end():this.activeRenderer===this.shapes&&this.shapes.end(),this.activeRenderer=null}resize(e){let t=this.canvas;var s=window.devicePixelRatio||1,i=Math.round(t.clientWidth*s),a=Math.round(t.clientHeight*s);if(t.width==i&&t.height==a||(t.width=i,t.height=a),this.context.gl.viewport(0,0,t.width,t.height),e===xs.Expand)this.camera.setViewport(i,a);else if(e===xs.Fit){let e=t.width,s=t.height,i=this.camera.viewportWidth,a=this.camera.viewportHeight,n=a/i<s/e?i/e:a/s;this.camera.setViewport(e*n,s*n)}this.camera.update()}enableRenderer(e){this.activeRenderer!==e&&(this.end(),e instanceof cs?(this.batcherShader.bind(),this.batcherShader.setUniform4x4f(ts.MVP_MATRIX,this.camera.projectionView.values),this.batcherShader.setUniformi("u_texture",0),this.batcher.begin(this.batcherShader),this.activeRenderer=this.batcher):e instanceof ds?(this.shapesShader.bind(),this.shapesShader.setUniform4x4f(ts.MVP_MATRIX,this.camera.projectionView.values),this.shapes.begin(this.shapesShader),this.activeRenderer=this.shapes):this.activeRenderer=this.skeletonDebugRenderer)}}var xs,bs;(bs=xs||(xs={}))[bs.Stretch=0]="Stretch",bs[bs.Expand=1]="Expand",bs[bs.Fit=2]="Fit";let vs=Phaser.GameObjects.Components;const ks=vs.ComputedSize,Ss=vs.Depth,Cs=vs.Flip,Ts=vs.ScrollFactor,Ps=vs.Transform,As=vs.Visible,Is=vs.Origin,Ms=vs.Alpha;function Rs(...e){return t=>(Phaser.Class.mixin(t,e),t)}const Fs=Rs(ks),Es=Rs(Ss),Bs=Rs(Cs),Ls=Rs(Ts),Ys=Rs(Ps),Os=Rs(As),Xs=Rs(Is),Ds=Rs(Ms);class _s extends Phaser.GameObjects.GameObject{constructor(e,t){super(e,t)}}class Vs{calculateBounds(e){if(!e.skeleton)return{x:0,y:0,width:0,height:0};const t=new Ve(e.skeleton.data);t.setToSetupPose(),t.updateWorldTransform();const s=t.getBoundsRect();return s.width==Number.NEGATIVE_INFINITY?{x:0,y:0,width:0,height:0}:s}}class Us{animation;skins;timeStep;constructor(e,t=[],s=.05){this.animation=e,this.skins=t,this.timeStep=s}calculateBounds(e){if(!e.skeleton||!e.animationState)return{x:0,y:0,width:0,height:0};const t=new Q(e.animationState.data),s=new Ve(e.skeleton.data),i=s.data;if(this.skins.length>0){let e=new qe("custom-skin");for(const t of this.skins){const s=i.findSkin(t);null!=s&&e.addSkin(s)}s.setSkin(e)}s.setToSetupPose();const a=null!=this.animation?i.findAnimation(this.animation):null;if(null==a){s.updateWorldTransform();const e=s.getBoundsRect();return e.width==Number.NEGATIVE_INFINITY?{x:0,y:0,width:0,height:0}:e}{let e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;t.clearTracks(),t.setAnimationWith(0,a,!1);const o=Math.max(a.duration/this.timeStep,1);for(let a=0;a<o;a++){t.update(a>0?this.timeStep:0),t.apply(s),s.updateWorldTransform();const o=s.getBoundsRect();e=Math.min(e,o.x),i=Math.min(i,o.y),n=Math.max(n,e+o.width),r=Math.max(r,i+o.height)}const l={x:e,y:i,width:n-e,height:r-i};return l.width==Number.NEGATIVE_INFINITY?{x:0,y:0,width:0,height:0}:l}}}class Ns extends(Es(Xs(Fs(Bs(Ls(Ys(Os(Ds(_s))))))))){plugin;boundsProvider;blendMode=-1;skeleton;animationStateData;animationState;beforeUpdateWorldTransforms=()=>{};afterUpdateWorldTransforms=()=>{};premultipliedAlpha=!1;constructor(e,t,s,i,a,n,r=new Vs){super(e,window.SPINE_GAME_OBJECT_TYPE?window.SPINE_GAME_OBJECT_TYPE:o),this.plugin=t,this.boundsProvider=r,this.setPosition(s,i),this.premultipliedAlpha=this.plugin.isAtlasPremultiplied(n),this.skeleton=this.plugin.createSkeleton(a,n),this.animationStateData=new le(this.skeleton.data),this.animationState=new Q(this.animationStateData),this.skeleton.updateWorldTransform(),this.updateSize()}updateSize(){if(!this.skeleton)return;let e=this.boundsProvider.calculateBounds(this);this.width=e.width,this.height=e.height,this.displayOriginX=-e.x,this.displayOriginY=-e.y}skeletonToPhaserWorldCoordinates(e){let t=this.getWorldTransformMatrix(),s=t.a,i=t.b,a=t.c,n=t.d,r=t.tx,o=t.ty,l=e.x,h=e.y;e.x=l*s+h*a+r,e.y=l*i+h*n+o}phaserWorldCoordinatesToSkeleton(e){let t=this.getWorldTransformMatrix();t=t.invert();let s=t.a,i=t.b,a=t.c,n=t.d,r=t.tx,o=t.ty,l=e.x,h=e.y;e.x=l*s+h*a+r,e.y=l*i+h*n+o}phaserWorldCoordinatesToBone(e,t){this.phaserWorldCoordinatesToSkeleton(e),t.parent?t.parent.worldToLocal(e):t.worldToLocal(e)}updatePose(e){this.animationState.update(e/1e3),this.animationState.apply(this.skeleton),this.beforeUpdateWorldTransforms(this),this.skeleton.updateWorldTransform(),this.afterUpdateWorldTransforms(this)}preUpdate(e,t){this.skeleton&&this.animationState&&this.updatePose(t)}preDestroy(){}willRender(e){var t=!this.skeleton||!(15!==this.renderFlags||0!==this.cameraFilter&&this.cameraFilter&e.id);if(this.visible||(t=!1),!t&&this.parentContainer&&this.plugin.webGLRenderer){var s=this.plugin.webGLRenderer;this.plugin.gl&&this.plugin.phaserRenderer instanceof Phaser.Renderer.WebGL.WebGLRenderer&&s.batcher.isDrawing&&(s.end(),this.plugin.phaserRenderer.pipelines.rebind())}return t}renderWebGL(e,t,s,i){if(!this.skeleton||!this.animationState||!this.plugin.webGLRenderer)return;let a=this.plugin.webGLRenderer;e.newType&&(e.pipelines.clear(),a.begin()),s.addToRenderList(t);let n=Phaser.GameObjects.GetCalcMatrix(t,s,i).calc,r=n.a,o=n.b,l=n.c,h=n.d,c=n.tx,d=n.ty;a.drawSkeleton(this.skeleton,this.premultipliedAlpha,-1,-1,(e,t,s)=>{for(let i=0;i<t;i+=s){let t=e[i],s=e[i+1];e[i]=t*r+s*l+c,e[i+1]=t*o+s*h+d}}),e.nextTypeMatch||(a.end(),e.pipelines.rebind())}renderCanvas(e,t,s,i){if(!this.skeleton||!this.animationState||!this.plugin.canvasRenderer)return;let a=e.currentContext,n=this.plugin.canvasRenderer;n.ctx=a,s.addToRenderList(t);let r=Phaser.GameObjects.GetCalcMatrix(t,s,i).calc,o=this.skeleton;o.x=r.tx,o.y=r.ty,o.scaleX=r.scaleX,o.scaleY=r.scaleY,o.getRootBone().rotation=-c.radiansToDegrees*r.rotationNormalized,this.skeleton.updateWorldTransform(),a.save(),n.draw(o),a.restore()}}class Gs extends de{constructor(e){super(e)}setFilters(e,t){}setWraps(e,t){}dispose(){}}const Ws=d.newFloatArray(8);class qs{static QUAD_TRIANGLES=[0,1,2,2,3,0];static VERTEX_SIZE=8;ctx;triangleRendering=!1;debugRendering=!1;vertices=d.newFloatArray(8192);tempColor=new h;constructor(e){this.ctx=e}draw(e){this.triangleRendering?this.drawTriangles(e):this.drawImages(e)}drawImages(e){let t=this.ctx,s=this.tempColor,i=e.color,a=e.drawOrder;this.debugRendering&&(t.strokeStyle="green");for(let e=0,n=a.length;e<n;e++){let n=a[e],r=n.bone;if(!r.active)continue;let o=n.getAttachment();if(!(o instanceof Me))continue;o.computeWorldVertices(n,Ws,0,2);let l=o.region,h=l.texture.getImage(),c=n.color,d=o.color;s.set(i.r*c.r*d.r,i.g*c.g*d.g,i.b*c.b*d.b,i.a*c.a*d.a),t.save(),t.transform(r.a,r.c,r.b,r.d,r.worldX,r.worldY),t.translate(o.offset[0],o.offset[1]),t.rotate(o.rotation*Math.PI/180);let u=o.width/l.originalWidth;t.scale(u*o.scaleX,u*o.scaleY);let g=l.width,m=l.height;if(t.translate(g/2,m/2),90==o.region.degrees){let e=g;g=m,m=e,t.rotate(-Math.PI/2)}t.scale(1,-1),t.translate(-g/2,-m/2),t.globalAlpha=s.a,t.drawImage(h,h.width*l.u,h.height*l.v,g,m,0,0,g,m),this.debugRendering&&t.strokeRect(0,0,g,m),t.restore()}}drawTriangles(e){let t=this.ctx,s=this.tempColor,i=e.color,a=e.drawOrder,n=null,r=this.vertices,o=null;for(let e=0,h=a.length;e<h;e++){let h,c=a[e],d=c.getAttachment();if(d instanceof Me){let e=d;r=this.computeRegionVertices(c,e,!1),o=qs.QUAD_TRIANGLES,h=e.region.texture.getImage()}else{if(!(d instanceof Pe))continue;{let e=d;r=this.computeMeshVertices(c,e,!1),o=e.triangles,h=e.region.texture.getImage()}}if(h){c.data.blendMode!=n&&(n=c.data.blendMode);let e=c.color,a=d.color;s.set(i.r*e.r*a.r,i.g*e.g*a.g,i.b*e.b*a.b,i.a*e.a*a.a),t.globalAlpha=s.a;for(var l=0;l<o.length;l+=3){let e=8*o[l],s=8*o[l+1],i=8*o[l+2],a=r[e],n=r[e+1],c=r[e+6],d=r[e+7],u=r[s],g=r[s+1],m=r[s+6],p=r[s+7],f=r[i],y=r[i+1],w=r[i+6],x=r[i+7];this.drawTriangle(h,a,n,c,d,u,g,m,p,f,y,w,x),this.debugRendering&&(t.strokeStyle="green",t.beginPath(),t.moveTo(a,n),t.lineTo(u,g),t.lineTo(f,y),t.lineTo(a,n),t.stroke())}}}this.ctx.globalAlpha=1}drawTriangle(e,t,s,i,a,n,r,o,l,h,c,d,u){let g=this.ctx;i*=e.width,a*=e.height,o*=e.width,l*=e.height,d*=e.width,u*=e.height,g.beginPath(),g.moveTo(t,s),g.lineTo(n,r),g.lineTo(h,c),g.closePath();var m=1/((o-=i)*(u-=a)-(d-=i)*(l-=a)),p=(u*(n-=t)-l*(h-=t))*m,f=(u*(r-=s)-l*(c-=s))*m,y=(o*h-d*n)*m,w=(o*c-d*r)*m,x=t-p*i-y*a,b=s-f*i-w*a;g.save(),g.transform(p,f,y,w,x,b),g.clip(),g.drawImage(e,0,0),g.restore()}computeRegionVertices(e,t,s){let i=e.bone.skeleton.color,a=e.color,n=t.color,r=i.a*a.a*n.a,o=s?r:1,l=this.tempColor;l.set(i.r*a.r*n.r*o,i.g*a.g*n.g*o,i.b*a.b*n.b*o,r),t.computeWorldVertices(e,this.vertices,0,qs.VERTEX_SIZE);let h=this.vertices,c=t.uvs;return h[Me.C1R]=l.r,h[Me.C1G]=l.g,h[Me.C1B]=l.b,h[Me.C1A]=l.a,h[Me.U1]=c[0],h[Me.V1]=c[1],h[Me.C2R]=l.r,h[Me.C2G]=l.g,h[Me.C2B]=l.b,h[Me.C2A]=l.a,h[Me.U2]=c[2],h[Me.V2]=c[3],h[Me.C3R]=l.r,h[Me.C3G]=l.g,h[Me.C3B]=l.b,h[Me.C3A]=l.a,h[Me.U3]=c[4],h[Me.V3]=c[5],h[Me.C4R]=l.r,h[Me.C4G]=l.g,h[Me.C4B]=l.b,h[Me.C4A]=l.a,h[Me.U4]=c[6],h[Me.V4]=c[7],h}computeMeshVertices(e,t,s){let i=e.bone.skeleton.color,a=e.color,n=t.color,r=i.a*a.a*n.a,o=s?r:1,l=this.tempColor;l.set(i.r*a.r*n.r*o,i.g*a.g*n.g*o,i.b*a.b*n.b*o,r);let h=t.worldVerticesLength/2,c=this.vertices;c.length<t.worldVerticesLength&&(this.vertices=c=d.newFloatArray(t.worldVerticesLength)),t.computeWorldVertices(e,0,t.worldVerticesLength,c,0,qs.VERTEX_SIZE);let u=t.uvs;for(let e=0,t=0,s=2;e<h;e++)c[s++]=l.r,c[s++]=l.g,c[s++]=l.b,c[s++]=l.a,c[s++]=u[t++],c[s++]=u[t++],s+=2;return c}}class Hs extends i.Plugins.ScenePlugin{game;isWebGL;gl;static gameWebGLRenderer=null;get webGLRenderer(){return Hs.gameWebGLRenderer}canvasRenderer;phaserRenderer;skeletonDataCache;atlasCache;constructor(e,t,s){super(e,t,s),this.game=t.game,this.isWebGL=2===this.game.config.renderType,this.gl=this.isWebGL?this.game.renderer.gl:null,this.phaserRenderer=this.game.renderer,this.canvasRenderer=null,this.skeletonDataCache=this.game.cache.addCustom("esotericsoftware.spine.skeletonFile.cache"),this.atlasCache=this.game.cache.addCustom("esotericsoftware.spine.atlas.cache"),t.registerFileType("spineJson",function(e,t,s){let i=new js(this,e,t,zs.json,s);return this.addFile(i.files),this},e),t.registerFileType("spineBinary",function(e,t,s){let i=new js(this,e,t,zs.binary,s);return this.addFile(i.files),this},e),t.registerFileType("spineAtlas",function(e,t,s,i){let a=new $s(this,e,t,s,i);return this.addFile(a.files),this},e);let a=this;t.registerGameObject(window.SPINE_GAME_OBJECT_TYPE?window.SPINE_GAME_OBJECT_TYPE:o,function(e,t,s,i,n){let r=new Ns(this.scene,a,e,t,s,i,n);return this.displayList.add(r),this.updateList.add(r),r},function(e,t=!1){let s=e.x?e.x:0,n=e.y?e.y:0,r=e.boundsProvider?e.boundsProvider:void 0,o=new Ns(this.scene,a,s,n,e.dataKey,e.atlasKey,r);return void 0!==t&&(e.add=t),i.GameObjects.BuildGameObject(this.scene,o,e)})}static rendererId=0;boot(){Ve.yDown=!0,this.isWebGL?(Hs.gameWebGLRenderer||(Hs.gameWebGLRenderer=new ws(this.game.renderer.canvas,this.gl,!0)),this.onResize(),this.game.scale.on(i.Scale.Events.RESIZE,this.onResize,this)):this.canvasRenderer||(this.canvasRenderer=new qs(this.scene.sys.context));var e=this.systems.events;e.once("shutdown",this.shutdown,this),e.once("destroy",this.destroy,this),this.game.events.once("destroy",this.gameDestroy,this)}onResize(){var e=this.game.renderer,t=this.webGLRenderer;if(e&&t){var s=e.width,i=e.height;t.camera.position.x=s/2,t.camera.position.y=i/2,t.camera.up.y=-1,t.camera.direction.z=1,t.camera.setViewport(s,i)}}shutdown(){this.systems.events.off("shutdown",this.shutdown,this),this.isWebGL&&this.game.scale.off(i.Scale.Events.RESIZE,this.onResize,this)}destroy(){this.shutdown()}gameDestroy(){this.pluginManager.removeGameObject(window.SPINE_GAME_OBJECT_TYPE?window.SPINE_GAME_OBJECT_TYPE:o,!0,!0),this.webGLRenderer&&this.webGLRenderer.dispose(),Hs.gameWebGLRenderer=null}getAtlas(e){let t;if(this.atlasCache.exists(e))t=this.atlasCache.get(e);else{let s=this.game.cache.text.get(e);if(t=new ke(s.data),this.isWebGL){let s=this.gl;const i=s.getParameter(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL);i&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);for(let i of t.pages)i.setTexture(new Yt(s,this.game.textures.get(e+"!"+i.name).getSourceImage(),!1));i&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)}else for(let s of t.pages)s.setTexture(new Gs(this.game.textures.get(e+"!"+s.name).getSourceImage()));this.atlasCache.add(e,t)}return t}isAtlasPremultiplied(e){let t=this.game.cache.text.get(e);return!!t&&t.premultipliedAlpha}getSkeletonData(e,t){const s=this.getAtlas(t),i=e+t;let a;if(this.skeletonDataCache.exists(i))a=this.skeletonDataCache.get(i);else{if(this.game.cache.json.exists(e)){let t=this.game.cache.json.get(e);a=new At(new Re(s)).readSkeletonData(t)}else{let t=this.game.cache.binary.get(e);a=new je(new Re(s)).readSkeletonData(new Uint8Array(t))}this.skeletonDataCache.add(i,a)}return a}createSkeleton(e,t){return new Ve(this.getSkeletonData(e,t))}}var zs;!function(e){e[e.json=0]="json",e[e.binary=1]="binary"}(zs||(zs={}));class js extends i.Loader.MultiFile{fileType;constructor(e,t,s,a,n){if("string"!=typeof t){const e=t;t=e.key,s=e.url,a="spineJson"===e.type?zs.json:zs.binary,n=e.xhrSettings}let r=null;r=a==zs.json?new i.Loader.FileTypes.JSONFile(e,{key:t,url:s,extension:"json",xhrSettings:n}):new i.Loader.FileTypes.BinaryFile(e,{key:t,url:s,extension:"skel",xhrSettings:n}),super(e,"spineSkeletonData",t,[r]),this.fileType=a}onFileComplete(e){this.pending--}addToCache(){this.isReadyToProcess()&&this.files[0].addToCache()}}class $s extends i.Loader.MultiFile{premultipliedAlpha;constructor(e,t,s,a,n){if("string"!=typeof t){const e=t;t=e.key,s=e.url,a=e.premultipliedAlpha,n=e.xhrSettings}super(e,"spineAtlasData",t,[new i.Loader.FileTypes.TextFile(e,{key:t,url:s,xhrSettings:n,extension:"atlas"})]),this.premultipliedAlpha=a}onFileComplete(e){if(-1!=this.files.indexOf(e)&&(this.pending--,"text"==e.type)){var t=e.data.split(/\r\n|\r|\n/);let h=[];h.push(t[0]);for(var s=1;s<t.length;s++){var a=t[s];""===a.trim()&&s<t.length-1&&(a=t[s+1],h.push(a))}let c=e.src.match(/^.*\//)??"";for(var n=0;n<h.length;n++){var r=c+h[n],o=e.key+"!"+h[n],l=new i.Loader.FileTypes.ImageFile(this.loader,o,r);this.loader.keyExists(l)||(this.addToMultiFile(l),this.loader.addFile(l))}}}addToCache(){if(this.isReadyToProcess()){let e=this.loader.textureManager;for(let t of this.files)"image"==t.type?e.exists(t.key)||e.addImage(t.key,t.data):(this.premultipliedAlpha=this.premultipliedAlpha??(t.data.indexOf("pma: true")>=0||t.data.indexOf("pma:true")>=0),t.data={data:t.data,premultipliedAlpha:this.premultipliedAlpha},t.addToCache())}}}window.spine={SpinePlugin:Hs},window["spine.SpinePlugin"]=Hs;class Js extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"BubblePop",a??"BubblePop_0006_bubble1.png"),this.play("BubblePop2")}}class Qs extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"RingLoad2",a??"Ring20012.png"),this.scaleX=.4322736032890191,this.scaleY=.4322736032890191,this.play("LoadRing"),this.on(Phaser.Animations.Events.ANIMATION_COMPLETE,e=>{"LoadRing"===e.key&&this.play("StayRing")})}followTarget;followLerp=.05;attachTo(e,t=.15){this.followTarget=e,this.followLerp=Phaser.Math.Clamp(t,.01,.95),this.x=e.x,this.y=e.y}preUpdate(e,t){super.preUpdate(e,t),this.followTarget&&this.followTarget.active&&(this.x=Phaser.Math.Linear(this.x,this.followTarget.x,this.followLerp),this.y=Phaser.Math.Linear(this.y,this.followTarget.y,this.followLerp))}destroy(e){this.followTarget=void 0,super.destroy(e)}}class Ks extends Ns{constructor(e,t,s,i,a,n,r,o,l){super(e,t,s??0,i??0,a??"KittenPlayer",n??"KittenPlayer-atlas",o??new Us("Idle",["default"])),this.setInteractive(new Phaser.Geom.Circle(34,34,40),Phaser.Geom.Circle.Contains),this.skeleton.setSkinByName(r??"default"),e.physics.add.existing(this,!1),this.body.friction.x=0,this.body.friction.y=1,this.body.bounce.x=.1,this.body.bounce.y=.1,this.body.collideWorldBounds=!0,this.body.setCircle(35),this.OriginalX=this.x,this.OriginalY=this.y,this.OriginalMoveSpeed=this.moveSpeed,this.animationState.setAnimation(0,"Idle",!0),this.setVisible(!1),this.setInteractive(),this.floatFX1=this.scene.sound.add("meow1"),this.floatFX2=this.scene.sound.add("meow2"),this.floatFX3=this.scene.sound.add("meow3"),this.floatFX4=this.scene.sound.add("meow4"),this.scene.addFx(this.floatFX1),this.scene.addFx(this.floatFX2),this.scene.addFx(this.floatFX3),this.scene.addFx(this.floatFX4),this.floatFX=this.scene.sound.add("sound8"),this.scene.addFx(this.floatFX),this.explodeFx=this.scene.sound.add("realPop"),this.scene.addFx(this.explodeFx),this.ChargingSound=this.scene.sound.add("ChargingSound"),this.scene.addFx(this.ChargingSound),this.on("pointerup",()=>this.cancelLongPress()),this.on("pointerout",()=>this.cancelLongPress()),this.scene.input.on("pointerup",()=>this.cancelLongPress()),this.on("pointerdown",e=>{this.clickingOnPlayer=!0,this.setScale(1.1,1.1),this.scene.time.delayedCall(100,()=>{this.setScale(1,1)}),!this.gravityTimerActive&&this.CanMove&&(this.gravityTimerActive=!0,this.body.setVelocity(0,0),this.moveSpeed=0,this.scene.time.delayedCall(this.gravityRestoreDelay,()=>{this.body.setVelocity(0,0),this.body.setGravityY(this.originalGravityY),this.gravityTimerActive=!1}))}),this.on("pointerup",()=>{this.clickingOnPlayer=!1,this.cancelLongPress()}),this.on("pointerout",()=>{this.clickingOnPlayer=!1,this.cancelLongPress()}),e.input.on("pointerdown",e=>{this.spawnClickRipple(e.x,e.y),this.chargeMode=!1,this.scene.registry?.set("chargeMode",!1),this.startLongPressCountdown(),this.clickingOnPlayer||(this.currentRing&&this.currentRing.active&&(this.currentRing.destroy(),this.currentRing=void 0,this.nextClickBoost=!0,this.scene.events.emit("player-charge-ready",this)),this.MovementLinear?(this.decelTween?.stop(),this.scene.tweens.add({targets:this,scale:1.1,ease:"Quad.Out",duration:100,onComplete:()=>{this.scene.time.delayedCall(100,()=>{this.scene.tweens.add({targets:this,scale:1,duration:100,ease:"Quad.Out"})})}}),this.targetPos=new Phaser.Math.Vector2(e.x,e.y),this.lastMoveTime=this.scene.time.now,this.addFloatingSound(),this.nextClickBoost?(this.moveSpeed=2.5*this.OriginalMoveSpeed,this.nextClickBoost=!1,this.chargeMode=!0,this.scene.registry?.set("chargeMode",!0)):this.moveSpeed=this.OriginalMoveSpeed,this.startBubbleTrail()):(this.addFloatingSound(),this.targetPos=new Phaser.Math.Vector2(e.x,e.y),this.lastMoveTime=this.scene.time.now,this.gravityTimerActive||(this.moveSpeed=this.OriginalMoveSpeed,this.body.setVelocityY(200)),this.followParticles=this.scene.add.particles(0,0,"BubbleParticle",{x:this.x,y:this.y,speed:{min:0,max:0},angle:{min:0,max:360},lifespan:{min:1e3,max:2500},scale:{start:0,end:1},quantity:1,maxParticles:1,frequency:100,gravityY:-100}),this.scene.time.delayedCall(400,()=>{this.followParticles?.stop(),this.scene.time.delayedCall(1200,()=>{this.followParticles?.destroy()})})))})}spawnClickRipple(e,t){const s=this.scene.add.circle(e,t,12,16777215,.45);s.setDepth(1e4),this.scene.tweens.add({targets:s,scale:1.8,alpha:0,duration:240,ease:"Cubic.Out",onComplete:()=>s.destroy()})}targetPos=null;moveSpeed=175;originalGravityY=-300;reducedGravityY=-50;gravityRestoreDelay=1e3;gravityTimerActive=!1;OriginalMoveSpeed=0;CanMove=!1;IsDead=!1;OriginalX=0;followParticles;dieParticles;OriginalY=0;lastMoveTime;floatFX;explodeFx;MovementLinear=!0;idleFloatPhase=0;bubbleTrail;meowFxs;floatFX1;floatFX2;floatFX3;floatFX4;blinkTimer;decelTween;longPressTimer;isPressing=!1;LONG_PRESS_THRESHOLD=250;currentRing;clickingOnPlayer=!1;nextClickBoost=!1;chargeMode=!1;ChargingSound;impulseStrength=420;boostMultiplier=2;airDragX=30;airDragY=30;bounceDamping=.55;maxSpeed=460;minSpeedCutoff=12;startLongPressCountdown(){this.currentRing&&this.currentRing.active||(this.cancelLongPress(),this.isPressing=!0,this.longPressTimer=this.scene.time.delayedCall(this.LONG_PRESS_THRESHOLD,()=>{!this.isPressing||this.currentRing&&this.currentRing.active||(this.onLongPress(),this.emit("longpress"),this.ChargingSound?.play(),this.scene.events.emit("player-charged",this))}))}cancelLongPress(){this.isPressing=!1,this.longPressTimer&&(this.longPressTimer.remove(!1),this.longPressTimer=void 0)}onLongPress(){if(this.currentRing&&this.currentRing.active)return;const e=new Qs(this.scene,this.x,this.y);this.scene.add.existing(e),e.attachTo(this,.18),e.setDepth(this.depth+1),this.currentRing=e,e.once(Phaser.GameObjects.Events.DESTROY,()=>{this.currentRing===e&&(this.currentRing=void 0)}),this.scene.tweens.add({targets:this,scale:1.2,duration:120,yoyo:!0,ease:"Quad.Out"})}startBubbleTrail(){this.bubbleTrail=this.scene.add.particles(0,0,"BubbleParticle",{x:this.x,y:this.y,speed:{min:0,max:-100},angle:{min:0,max:360},lifespan:{min:500,max:2e3},scale:{start:.5,end:0},quantity:5,maxParticles:5,frequency:100,gravityY:-300})}addFloatingSound(){if(Phaser.Math.FloatBetween(0,1)<.2)switch(Phaser.Math.Between(1,4)){case 1:this.floatFX1.play();break;case 2:this.floatFX2.play();break;case 3:this.floatFX3.play();break;case 4:this.floatFX4.play()}else this.floatFX.play()}startMoving(){this.MovementLinear?(this.body.collideWorldBounds=!0,this.body.checkCollision.none=!1,this.body.enable=!0,this.body.setAllowGravity(!1),this.body.setGravityY(0),this.CanMove=!0,this.setVisible(!0),this.skeleton.setAttachment("Bubble","Bubble"),this.animationState.setAnimation(0,"Idle",!0),this.IsDead=!1,this.setActive(!0)):(console.log("Player starts moving"),this.setVisible(!0),this.CanMove=!0,this.body.checkCollision.none=!1,this.body.enable=!0,this.body.setGravityY(this.originalGravityY),this.moveSpeed=this.OriginalMoveSpeed,this.body.collideWorldBounds=!0,this.skeleton.setAttachment("Bubble","Bubble"),this.moveSpeed=this.OriginalMoveSpeed,this.setActive(!0),this.IsDead=!1,this.animationState.setAnimation(0,"Idle",!0))}SetOriginalPosition(e,t){this.OriginalX=e,this.OriginalY=t}startBlinkLoop(){if(this.blinkTimer)return;const e=()=>{!this.IsDead&&this.visible&&this.active&&(this.animationState.setAnimation(0,"Blink",!1),this.animationState.addAnimation(0,"Idle",!0,0)),this.blinkTimer=this.scene.time.delayedCall(Phaser.Math.Between(2e3,5e3),e,[],this)};e()}preUpdate(e,t){if(super.preUpdate(e,t),this.IsDead)return;if(this.MovementLinear){const s=this.body;if(this.CanMove&&this.targetPos){const t=new Phaser.Math.Vector2(this.targetPos.x-this.x,this.targetPos.y-this.y),i=t.length();if(this.targetPos=null,i>=4){t.scale(1/i),s.setVelocity(t.x*this.moveSpeed,t.y*this.moveSpeed);const e=.25;Math.abs(t.x)>.05&&(this.rotation=Phaser.Math.Linear(this.rotation,e*Math.sign(t.x),.15))}this.lastMoveTime=e}else{const e=s.velocity.x||0,i=s.velocity.y||0;if(Math.hypot(e,i)<this.minSpeedCutoff){s.setVelocity(0,0),this.idleFloatPhase+=.0025*t;const e=25*Math.sin(this.idleFloatPhase);s.setVelocityY(e)}this.rotation=Phaser.Math.Linear(this.rotation,0,.08)}}else{const t=.25;if(this.targetPos&&this.CanMove){const s=new Phaser.Math.Vector2(this.targetPos.x-this.x);s.length()<5?(this.targetPos=null,this.lastMoveTime=e):(s.normalize(),this.gravityTimerActive||this.body.setVelocityX(s.x*this.moveSpeed),Math.abs(s.x)>.1&&(this.rotation=Phaser.Math.Linear(this.rotation,t*Math.sign(s.x),.2)),this.lastMoveTime=e)}else(!this.lastMoveTime||e-this.lastMoveTime>500)&&(this.rotation=Phaser.Math.Linear(this.rotation,0,.1))}const s=this.body.velocity.x||0,i=this.body.velocity.y||0;Math.hypot(s,i),this.startBlinkLoop()}Die(){if(this.IsDead)return;this.IsDead=!0,this.CanMove=!1,this.body.setVelocity(0,0),this.body.setGravity(0,0),this.body.setBounce(0,0),this.body.setDrag(0,0),this.body.checkCollision.none=!0,this.body.enable=!1,this.blinkTimer&&(this.blinkTimer.remove(),this.blinkTimer=void 0),console.log("Player has died"),this.body.collideWorldBounds=!1,this.setActive(!0),this.rotation=0,this.skeleton.setAttachment("Bubble","");const e=this.scene.scale.height+200,t=this.x;this.scene.tweens.add({targets:this,x:t,y:this.y-70,duration:220,ease:"Quad.Out",onComplete:()=>{this.scene.tweens.add({targets:this,x:t,y:e,duration:780,ease:"Cubic.In"})}}),this.scene.add.existing(new Js(this.scene,this.x,this.y)).setRotation(Math.random()*Math.PI*2),this.explodeFx.play(),this.dieParticles=this.scene.add.particles(0,0,"BubbleParticle",{x:this.x,y:this.y,speed:{min:0,max:-1e3},angle:{min:0,max:360},lifespan:{min:500,max:1500},scale:{start:.5,end:0},quantity:5,maxParticles:5,frequency:100,gravityY:-3e3}),this.scene.time.delayedCall(400,()=>{this.dieParticles?.stop(),this.scene.time.delayedCall(1200,()=>{this.resetPlayer(),this.dieParticles?.destroy()})}),this.cancelLongPress(),this.currentRing&&this.currentRing.active&&(this.currentRing.destroy(),this.currentRing=void 0)}resetPlayer(){this.scene.chest.resetChest(),this.setVisible(!1),this.body.checkCollision.none=!0,this.body.enable=!1,this.scene.tweens.add({targets:this,y:this.OriginalY,x:this.OriginalX,duration:500,ease:"Quad.Out",onComplete:()=>{}}),this.cancelLongPress(),this.currentRing&&this.currentRing.active&&(this.currentRing.destroy(),this.currentRing=void 0)}CompleteLevel(e,t){this.CanMove=!1,this.body.setVelocity(0,0),this.body.setGravityY(0),this.scene.tweens.add({targets:this,x:e,y:t,duration:1e3,ease:"Quad.Out",onComplete:()=>{this.scene.time.delayedCall(1e3,()=>{this.scene.closeCurtains(),this.scene.tweens.add({targets:this.skeleton.color,a:0,duration:500,ease:"Quad.Out"})})}})}}class Zs extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"FxON",a),this.setInteractive({useHandCursor:!0}),this.isMuted=!1,this.on("pointerdown",()=>{this.isMuted=!this.isMuted,this.setTexture(this.isMuted?"FxOff":"FxON"),this.scene.muteAllFx(this.isMuted)})}isMuted=!1;setMuted(e){console.log("FxButton setMuted called with:",e),this.isMuted=e,this.setTexture(this.isMuted?"FxOff":"FxON")}}class ei extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"MusicON",a),this.setInteractive({useHandCursor:!0}),this.isMuted=!1,this.on("pointerdown",()=>{this.isMuted=!this.isMuted,this.setTexture(this.isMuted?"MusicOff":"MusicON");const e=this.scene.music;e&&e.setMute(this.isMuted);try{localStorage.setItem("musicMuted",String(!!this.isMuted))}catch{console.warn("No se pudo guardar la preferencia de FX muteados")}})}isMuted=!1;setMuted(e){this.isMuted=e,this.setTexture(this.isMuted?"FxOff":"FxON")}}class ti extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"MapBtn",a),this.setInteractive({useHandCursor:!0}),this.on("pointerdown",()=>{console.log("Map button clicked"),this.scene.toggleMapOverlay(),this.stopAttentionPulse()}),this.on("pointerover",()=>this.stopAttentionPulse()),this.on("pointerout",()=>this.startAttentionPulse()),this.startAttentionPulse()}_pulseTimer;_wiggleTween;startAttentionPulse(){this._pulseTimer||(this.scene.time.delayedCall(Phaser.Math.Between(1500,4e3),()=>this.doWiggle()),this._pulseTimer=this.scene.time.addEvent({delay:1e4,loop:!0,callback:()=>this.doWiggle()}))}stopAttentionPulse(){this._pulseTimer&&(this._pulseTimer.remove(!1),this._pulseTimer=void 0),this._wiggleTween&&this._wiggleTween.isPlaying()&&this._wiggleTween.stop(),this._wiggleTween=void 0,this.setAngle(0)}doWiggle(){this._wiggleTween&&this._wiggleTween.isPlaying()||(this._wiggleTween=this.scene.tweens.add({targets:this,angle:10,duration:90,ease:"Sine.Out",yoyo:!0,repeat:5,onComplete:()=>{this._wiggleTween=void 0,this.setAngle(0)}}))}}class si extends Phaser.GameObjects.Container{constructor(e,t,s){super(e,t??0,s??0);const i=e.add.image(0,0,"PauseHomeBtn");this.add(i);const a=e.add.text(32,-8,"",{});a.text="Loading music style . . .",a.setStyle({fontFamily:"Arial",fontSize:"14px"}),this.add(a),this.pauseHomeBtn=i,this.musicStyleText=a;const n=this.musicStyleText.y;this.musicStyleText.setAlpha(0),this.musicStyleText.y=n+60,this.scene.time.delayedCall(2e3,()=>{this.musicStyleText.active&&this.scene.tweens.add({targets:this.musicStyleText,y:n,alpha:1,duration:600,ease:"Cubic.Out"})}),this._onRegChange=(e,t,s)=>{"RadioLog"===t&&this.updateMusicStyleText(s)},this.scene.registry.events.on("changedata",this._onRegChange,this),this.updateMusicStyleText(this.scene.registry.get("RadioLog")),this.once(Phaser.GameObjects.Events.DESTROY,()=>{this._onRegChange&&(this.scene.registry.events.off("changedata",this._onRegChange,this),this._onRegChange=void 0)}),this.pauseHomeBtn.setInteractive({useHandCursor:!0}),this.pauseHomeBtn.on("pointerdown",()=>{console.log("PauseHomeBtn clicked");const e=!(!0===this.scene.registry.get("PlayerPaused"));this.scene.registry.set("PlayerPaused",e),console.log(this.scene.registry.getAll()),this.pauseHomeBtn.setTexture(e?"PlayHomeBtn":"PauseHomeBtn")})}pauseHomeBtn;musicStyleText;_onRegChange;updateMusicStyleText(e){let t="Loading music style . . .";Array.isArray(e)&&e.length&&(t=e[e.length-1].replace(/^\[Radio\]\s*/i,"")),this.musicStyleText.setText(t)}}class ii extends Phaser.Scene{editorCreate(){const e=this.add.tileSprite(-48,-22,1031,580,"bg1");e.scaleX=1.1,e.scaleY=1.1,e.setOrigin(0,0);const t=this.add.tileSprite(-215,47,1500,580,"bg2");t.setOrigin(0,0);const s=this.add.tileSprite(-215,57,1500,580,"bg3");s.setOrigin(0,0);const i=this.add.tileSprite(-223,108,1500,580,"bg4");i.setOrigin(0,0);const a=this.add.image(516,270,"Vinete");a.blendMode=Phaser.BlendModes.MULTIPLY;const o=new n(this,133,192);this.add.existing(o);const l=new r(this,938,177);this.add.existing(l);const h=new Ks(this,this.spine,133,149);this.add.existing(h),this.add.image(511,568,"FrontLayer");const c=new Zs(this,987,46);this.add.existing(c);const d=new ei(this,1179,46);this.add.existing(d);const u=new ti(this,44,46);this.add.existing(u);const g=this.add.image(0,0,"CarboardEffect");g.blendMode=Phaser.BlendModes.MULTIPLY,g.setOrigin(0,0);const m=this.add.image(515,-218,"Curtain1"),p=this.add.image(515,743,"Curtain2"),f=new si(this,61,543);this.add.existing(f),this.gameBg=e,this.bg2=t,this.bg3=s,this.bg4=i,this.vinete=a,this.chest=o,this.door=l,this.player=h,this.fxON=c,this.musicON=d,this.mapBtn=u,this.carboardEffect=g,this.curtain1=m,this.curtain2=p,this.homePlayer=f,this.events.emit("scene-awake")}gameBg;bg2;bg3;bg4;vinete;chest;door;player;fxON;musicON;mapBtn;carboardEffect;curtain1;curtain2;homePlayer;nextLevel="Level";_mapVisible=!1;_mapFromTop=!0;collidingEnemies=[];enemiesGroup;BaseCreate(){this.collidingEnemies=[];const e=this.add.tileSprite(-48,-22,1031,580,"bg1");e.scaleX=1.1,e.scaleY=1.1,e.setOrigin(0,0);const t=this.add.tileSprite(-215,47,1500,580,"bg2");t.setOrigin(0,0);const s=this.add.tileSprite(-215,57,1500,580,"bg3");s.setOrigin(0,0);const i=this.add.tileSprite(-223,108,1500,580,"bg4");i.setOrigin(0,0);const a=new ti(this,44,46);this.add.existing(a);const o=this.add.image(516,270,"Vinete");o.blendMode=Phaser.BlendModes.MULTIPLY;const l=new n(this,135,164);this.add.existing(l);const h=new r(this,938,177);this.add.existing(h);const c=new Ks(this,this.spine,133,149);this.add.existing(c);const d=new Zs(this,987,46);this.add.existing(d);const u=new ei(this,1179,46);this.add.existing(u);const g=this.add.image(0,0,"CarboardEffect");g.blendMode=Phaser.BlendModes.MULTIPLY,g.setOrigin(0,0),g.visible=!1;const m=this.add.image(515,-218,"Curtain1"),p=this.add.image(515,743,"Curtain2"),f=new si(this,44,543);this.add.existing(f),this.homePlayer=f,this.homePlayer.depth=20,this.gameBg=e,this.bg2=t,this.bg3=s,this.bg4=i,this.vinete=o,this.chest=l,this.door=h,this.player=c,this.fxON=d,this.musicON=u,this.carboardEffect=g,this.curtain1=m,this.curtain2=p,this.events.emit("scene-awake"),this.curtainOpen=this.sound.add("CurtainOpen"),this.addFx(this.curtainOpen)}plataformas;starsGroup;music;fxList=[];UseInternetMusic=!0;curtainOpen;create(){this.plataformas=this.physics.add.group(),this.enemiesGroup=this.physics.add.group(),this.physics.add.collider(this.enemiesGroup,this.plataformas),this.BaseCreate(),this.editorCreate(),this.resolveDepths(),this.startingPositions(),this.initMapOverlay(),this.physics.world.gravity.y=100,this.game.registry.set("HasNewTrack",!1),this.loadPlayerPrefs(),this.curtain1.y=144,this.curtain2.y=434,this.vinete.visible=!0,this.carboardEffect.visible=!0,this.starsGroup=this.physics.add.group(),this.input.once("pointerdown",()=>{this.sys.game.device.os.desktop||this.scale.isFullscreen||!this.scale.fullscreen.available||this.scale.startFullscreen()}),this.openCurtains(),this.events.on(Phaser.Scenes.Events.SLEEP,()=>{try{this.music?.stop()}catch{}this.fxList.forEach(e=>{try{e.stop()}catch{}})}),this.events.on(Phaser.Scenes.Events.SHUTDOWN,()=>{try{this.music?.stop()}catch{}this.fxList.forEach(e=>{try{e.stop()}catch{}})})}initMapOverlay(){const e="Map",t=this.scale.width,s=this.scale.height,i=()=>{let i;try{i=this.scene.get(e)}catch{}i&&(i.cameras.main.setViewport(0,-s,t,s),i.input.enabled=!1,this.scene.bringToTop(this.scene.key))};this.scene.isActive(e)||this.scene.isSleeping(e)||this.scene.isPaused(e)?i():(this.scene.launch(e),this.time.delayedCall(0,i))}showMapOverlay(e=!0){this._mapFromTop=e;const t=this.scene.get("Map"),s=this.scale.width,i=this.scale.height,a=e?-i:i;t&&"function"==typeof t.loadMapState&&"function"==typeof t.locatePlayerOnMap&&(t.loadMapState(),t.locatePlayerOnMap()),t.cameras.main.setViewport(0,a,s,i),this.scene.bringToTop("Map"),t.input.enabled=!0;try{this.registry.set("LastActiveSceneKey",this.scene.key)}catch{}const n=this;t.tweens.add({targets:t.cameras.main,props:{y:0},duration:400,ease:"Cubic.Out",onComplete:()=>{n._mapVisible=!0}}),this.input.enabled=!1;try{this.physics.world.pause()}catch{}this.scene.pause(this.scene.key)}hideMapOverlay(e=this._mapFromTop){const t=this.scene.get("Map"),s=this.scale.height,i=e?-s:s;this.tweens.add({targets:t.cameras.main,props:{y:i},duration:350,ease:"Cubic.In",onComplete:()=>{t.input.enabled=!1,this.scene.bringToTop(this.scene.key),this.input.enabled=!0,this._mapVisible=!1}})}toggleMapOverlay(){this.showMapOverlay(this._mapFromTop)}addCollidingEnemy(e){this.enemiesGroup||(this.enemiesGroup=this.physics.add.group(),this.plataformas&&this.physics.add.collider(this.enemiesGroup,this.plataformas)),e.body||this.physics.add.existing(e);const t=this.enemiesGroup;t.getChildren().includes(e)||(t.add(e),this.events.emit("colliding-enemy-added",e))}removeCollidingEnemy(e){if(this.enemiesGroup){const t=this.enemiesGroup;t.getChildren().includes(e)&&(t.remove(e,!1,!1),this.events.emit("colliding-enemy-removed",e))}const t=this.collidingEnemies.indexOf(e);-1!==t&&this.collidingEnemies.splice(t,1)}clearCollidingEnemies(){this.enemiesGroup&&this.enemiesGroup.clear(!1,!1),this.collidingEnemies.length=0}startRain(){this.add.particles(0,0,"BubbleParticle",{x:{min:0,max:this.scale.width},y:0,lifespan:1200,speedY:{min:400,max:600},scale:{start:.15,end:.05},alpha:{start:.7,end:0},quantity:2,frequency:30,blendMode:"ADD"}).setDepth(999)}resolveDepths(){this.curtain1.setDepth(1e3),this.curtain2.setDepth(1e3),this.player.setDepth(10)}startingPositions(){const e=this.chestOrigin,t=this.doorOrigin;try{if(e&&this.chest){this.chest.setPosition?.(e.x,e.y),this.chest.x=e.x,this.chest.y=e.y,this.player.x=e.x,this.player.y=e.y,this.player.SetOriginalPosition?.(e.x,e.y),"function"==typeof e.destroy&&e.destroy();try{delete this.chestOrigin}catch{}}if(t&&this.door){this.door.setPosition?.(t.x,t.y),this.door.x=t.x,this.door.y=t.y,"function"==typeof t.destroy&&t.destroy();try{delete this.doorOrigin}catch{}}}catch{}}addFx(e){this.fxList.push(e)}loadPlayerPrefs(){try{const e=localStorage.getItem("musicMuted"),t=localStorage.getItem("fxMuted"),s="true"===e,i="true"===t;console.log("Preferencias cargadas - Msica muteada:",s,"Efectos de sonido muteados:",i),this.sound.setMute(!1),i&&(this.fxON.setMuted(!0),this.muteAllFx(!0)),this.registry.set("musicMuted",s)}catch{}}muteAllFx(e){console.log("Muteando efectos de sonido:",e),this.fxList.forEach(t=>t.setMute(e));try{localStorage.setItem("fxMuted",String(!!e))}catch{console.warn("No se pudo guardar la preferencia de FX muteados")}}openCurtains(){if(this.curtainOpen?.play(),this.UseInternetMusic){try{this.music?.stop()}catch{}this.music=void 0}else this.music=this.sound.add("WholeMusic",{loop:!0}),this.music.play();this.tweens.add({targets:this.curtain1,y:-150,duration:700,ease:"Quad.Out"}),this.tweens.add({targets:this.curtain2,y:740,duration:700,ease:"Quad.Out"})}closeCurtains(){this.tweens.add({targets:this.curtain1,y:144,duration:700,ease:"Quad.Out"}),this.tweens.add({targets:this.curtain2,y:434,duration:700,ease:"Quad.Out"}),this.music&&this.tweens.add({targets:this.music,volume:0,duration:1e3,ease:"Quad.Out",onComplete:()=>{this.music?.stop()}}),this.time.delayedCall(1e3,()=>{this.gotoLevel()})}gotoLevel(){const e=this.nextLevel||"Level1",t=e.match(/(\d+)$/),s=t?Number(t[1]):1;let i=1;try{const e=localStorage.getItem("PlayerMaxLevel");i=e?Math.max(1,Number(e)):1}catch{}const a=Math.max(i,s);try{localStorage.setItem("PlayerMaxLevel",String(a))}catch{}try{this.registry.set("PlayerMaxLevel",a)}catch{}this.scene.start(e)}update(){if(!this.player)return;const e=this.player.x,t=this.player.y;this.bg2.x=.05*(e-299)-100,this.bg2.y=40+.05*(t-322),this.bg3.x=.08*(e-299)-100,this.bg3.y=40+.08*(t-322),this.bg4.x=.12*(e-299)-100,this.bg4.y=40+.12*(t-322)}collectStar(){console.log("Estrella recogida"),0===this.starsGroup.countActive(!0)&&(console.log("Todas las estrellas recogidas, aparece la puerta"),this.door.AppearDoor())}}class ai extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"Platform1",a),e.physics.add.existing(this,!1),this.body.moves=!1,this.body.allowGravity=!1,this.body.allowDrag=!1,this.body.allowRotation=!1,this.body.pushable=!1,this.body.immovable=!0,this.body.setSize(261,154,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}create(){this.scene.physics.add.collider(this.scene.player,this),this.body.setImmovable(!0);const e=this.scene;e.plataformas&&e.plataformas.add(this);const t=()=>{const t=e.enemiesGroup;return!!t&&(this.scene.physics.add.collider(t,this),!0)};if(!t()){const e=this.scene.time.addEvent({delay:100,repeat:30,callback:()=>{t()&&e.remove(!1)}})}this.fitBodyToTexture()}fitBodyToTexture(){const e=this.body,t=this.frame;if(!e||!t)return;const s=Math.abs(this.scaleX)||1,i=Math.abs(this.scaleY)||1,a=(t.realWidth??t.width)*s,n=(t.realHeight??t.height)*i;e.setSize(a,n,!0)}}class ni extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"star",a),e.physics.add.existing(this,!1),this.body.moves=!1,this.body.allowGravity=!1,this.body.allowDrag=!1,this.body.allowRotation=!1,this.body.pushable=!1,this.body.immovable=!0,this.body.setSize(40,40,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this);const n=this.y;this.moveTween=this.scene.tweens.add({targets:this,y:n+20,duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}collectFx;isCollected=!1;moveTween;shakeTween;shakeTimer;create(){this.scene.physics.add.overlap(this.scene.player,this,this.collectStar,void 0,this),this.addStarToSceneStarsGroup(),this.collectFx=this.scene.sound.add("collectStar"),this.scene.addFx(this.collectFx)}addStarToSceneStarsGroup(){const e=this.scene;e.starsGroup?e.starsGroup.add(this):console.warn("starsGroup no est definido en la escena.")}collectStar(e,t){const s=this.scene.add.particles(0,0,"starParticle",{x:this.x,y:this.y,speed:{min:120,max:260},angle:{min:0,max:360},scale:{start:1,end:0},alpha:{start:1,end:0},lifespan:{min:250,max:500},quantity:20,gravityY:-50});if(s.explode(5,this.x,this.y),this.scene.time.delayedCall(600,()=>{s.destroy()}),this.isCollected)return;this.isCollected=!0,this.collectFx.play(),this.moveTween&&this.moveTween.stop(),this.shakeTween&&this.shakeTween.stop(),this.shakeTimer&&this.shakeTimer.remove();const i=this.scene;this.scene.tweens.add({targets:this,angle:this.angle+360,scale:0,duration:400,ease:"Back.easeIn",onComplete:()=>{this.scene.events.emit("star-collected",this),i&&i.starsGroup&&i.starsGroup.remove(this,!0,!0),i&&"function"==typeof i.collectStar&&i.collectStar(),this.destroy()}})}}class ri extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"cloud1",a),e.physics.add.existing(this,!1),this.body.moves=!1,this.body.allowGravity=!1,this.body.allowDrag=!1,this.body.allowRotation=!1,this.body.pushable=!1,this.body.setSize(261,154,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this),this.explodeFx=this.scene.sound.add("realPop"),this.scene.addFx(this.explodeFx)}explodeFx;heartbeatTween;hasBurst=!1;create(){this.scene.physics.add.collider(this.scene.player,this,this.handlePlayerHit,void 0,this),this.fitBodyToTexture(),this.startHeartbeat(),this.body.setImmovable(!0);const e=this.scene,t=()=>{const t=e.enemiesGroup;return!!t&&(this.scene.physics.add.collider(t,this),!0)};if(!t()){const e=this.scene.time.addEvent({delay:100,repeat:30,callback:()=>{t()&&e.remove(!1)}})}}fitBodyToTexture(){const e=this.body;if(!e)return;const t=this.displayWidth,s=(this.displayHeight,this.displayHeight/1.5),i=t/2-s;e.setCircle(s,i,0)}startHeartbeat(){this.heartbeatTween=this.scene.tweens.add({targets:this,scale:{from:this.scale,to:1.05*this.scale},duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.once(Phaser.GameObjects.Events.DESTROY,()=>this.heartbeatTween?.stop())}handlePlayerHit(e,t){const s=e?.body,i=this.body;if(!s||this.hasBurst)return;const a=!!e?.chargeMode;console.log(`Plataforma2: jugador hit. Charged: ${a}`),a?(console.log("Plataforma2: jugador cargado, plataforma movible"),i.pushable=!0,i.setImmovable(!1),this.hasBurst=!0,i.enable=!1,this.spawnBubbleBurst(),this.setVisible(!1),this.setActive(!1),this.scene.time.delayedCall(300,()=>this.destroy())):(i.pushable=!1,i.setImmovable(!0))}spawnBubbleBurst(){this.explodeFx.play();const e=this.scene.add.particles(0,0,"BubbleParticle",{x:this.x,y:this.y,speed:{min:120,max:300},angle:{min:0,max:360},lifespan:{min:500,max:1200},scale:{start:.8,end:0},quantity:20,maxParticles:20,frequency:0,gravityY:-120});this.scene.time.delayedCall(1500,()=>e.destroy())}}class oi extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"HandClick",a??"ClickHand0001.png"),this.play(""),void 0===t&&void 0===s&&this.setPosition(.5*this.scene.scale.width,.5*this.scene.scale.height),this.setScale(0),this.setAlpha(0),this.scene.time.delayedCall(2e3,()=>{this.scene.tweens.add({targets:this,scale:1,alpha:1,duration:400,ease:"Back.Out",onComplete:()=>{this.startFloat(),this.scene.time.delayedCall(2e3,()=>this.moveToChestOrigin())}})}),this.scene.events.once("chest-opened",()=>this.onChestOpened()),this.scene.events.on("star-collected",e=>this.onStarCollected(e)),this.scene.events.on("player-charged",()=>this.onPlayerCharged())}floatTween;hasHandledChestOpen=!1;hasHandledStar1=!1;waitingForSecondStar=!1;waitingForCharge=!1;startFloat(){this.floatTween?.stop(),this.floatTween=this.scene.tweens.add({targets:this,y:"-=8",duration:1500,ease:"Sine.InOut",yoyo:!0,repeat:-1})}moveToChestOrigin(){const e=this.scene.chest;e&&"number"==typeof e.x&&"number"==typeof e.y&&(this.floatTween?.stop(),this.scene.tweens.add({targets:this,x:e.x,y:e.y+30,duration:900,ease:"Quad.InOut",onComplete:()=>{this.playClickAnimation(!1)}}))}playClickAnimation(e){this.anims&&this.scene.anims.exists("HandClick")?(this.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{e&&this.startFloat()}),this.play("HandClick",!0)):e&&this.startFloat()}onChestOpened(){if(this.hasHandledChestOpen)return;this.hasHandledChestOpen=!0,this.floatTween?.stop(),this.anims?.stop(),this.setFrame("ClickHand0001.png");const e=this.scene.star1;e&&"number"==typeof e.x&&"number"==typeof e.y&&this.scene.tweens.add({targets:this,x:e.x,y:e.y,duration:900,ease:"Quad.InOut",onComplete:()=>this.playClickAnimation(!0)})}onStarCollected(e){const t=this.scene.star1,s=this.scene.star2;if(t&&s){if(!this.hasHandledStar1&&e===t){if("number"!=typeof s.x||"number"!=typeof s.y)return;return this.hasHandledStar1=!0,this.waitingForSecondStar=!0,this.floatTween?.stop(),this.anims?.stop(),this.setFrame("ClickHand0001.png"),void this.scene.tweens.add({targets:this,x:s.x,y:s.y,duration:900,ease:"Quad.InOut",onComplete:()=>this.playClickAnimation(!0)})}if(this.waitingForSecondStar&&e===s&&(this.waitingForSecondStar=!1,this.floatTween?.stop(),this.anims?.stop(),this.setFrame("ClickHand0001.png"),this.playHoldAnimation()),this.isLastStar(e)){const e=this.getDoorTarget();if(!e)return;this.floatTween?.stop(),this.anims?.stop(),this.setFrame("ClickHand0001.png"),this.scene.tweens.add({targets:this,x:e.x,y:e.y,duration:900,ease:"Quad.InOut",onComplete:()=>this.playClickAnimation(!1)})}}}playHoldAnimation(){this.waitingForCharge=!0,this.anims&&this.scene.anims.exists("HandHold")?(this.play({key:"HandHold",repeat:-1},!0),this.startFloat()):this.startFloat()}findLastStar(){const e=this.scene.starsGroup;if(e){const t=e.getChildren().filter(e=>e.active&&!e.isCollected);if(t.length>0)return t.reduce((e,t)=>e?t.x>e.x?t:e:t,void 0)}const t=this.scene.star_2||this.scene.star2;if(t&&"number"==typeof t.x&&"number"==typeof t.y)return t}onPlayerCharged(){if(!this.waitingForCharge)return;this.waitingForCharge=!1;const e=this.findLastStar();e?(this.floatTween?.stop(),this.anims?.stop(),this.setFrame("ClickHand0001.png"),this.scene.tweens.add({targets:this,x:e.x,y:e.y,duration:900,ease:"Quad.InOut",onComplete:()=>this.playClickAnimation(!1)})):this.startFloat()}isLastStar(e){const t=this.scene.starsGroup;return!!t&&0===t.getChildren().filter(t=>t.active&&!t.isCollected&&t!==e).length}getDoorTarget(){const e=this.scene.door||this.scene.doorOrigin;if(e&&"number"==typeof e.x&&"number"==typeof e.y)return{x:e.x,y:e.y}}}class li extends ii{constructor(){super("Level1")}editorCreate(){const e=new ai(this,116,515,"Platform1");this.add.existing(e),e.scaleX=1,e.scaleY=1;const t=new ai(this,939,573);this.add.existing(t);const s=new ai(this,526,510);this.add.existing(s);const i=new ni(this,539,290);this.add.existing(i);const a=this.add.image(511,568,"FrontLayer"),n=new ni(this,242,92);this.add.existing(n);const r=new ni(this,944,74);this.add.existing(r);const o=this.add.image(127,354,"CloseChestanimation","CloseChest0031.png"),l=this.add.image(941,439,"door"),h=new ri(this,938,72);this.add.existing(h);const c=new oi(this,609,226);this.add.existing(c),this.star2=i,this.frontLayer=a,this.star1=n,this.chestOrigin=o,this.doorOrigin=l,this.cloud=h,this.events.emit("scene-awake")}star2;frontLayer;star1;chestOrigin;doorOrigin;cloud;nextLevel="Level2"}class hi extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"spikes",a),e.physics.add.existing(this,!1),this.body.moves=!1,this.body.allowGravity=!1,this.body.pushable=!1,this.body.immovable=!0,this.body.setSize(139,44,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}create(){this.scene.physics.add.collider(this.scene.player,this,this.killPlayer,void 0,this),this.fitBodyToTexture()}killPlayer(e,t){e.Die()}fitBodyToTexture(){const e=this.body,t=this.frame;if(!e||!t)return;const s=Math.abs(this.scaleX)||1,i=Math.abs(this.scaleY)||1;let a=(t.realWidth??t.width)*s,n=(t.realHeight??t.height)*i;const r=Math.abs(this.angle%360);(r>45&&r<135||r>225&&r<315)&&([a,n]=[n,a]),e.setSize(a,n,!0)}}class ci extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"EnemyBullet",a??"Bullet0001.png"),this.play("EnemyBullet"),e.add.existing(this),e.physics.add.existing(this);const n=this.body;n.setAllowGravity(!1),n.setCollideWorldBounds(!0),n.onWorldBounds=!0,n.setCircle(10,0,5),e.physics.world.on("worldbounds",e=>{e.gameObject===this&&this.destroy()}),e.time.delayedCall(1e4,()=>{this.active&&this.destroy()}),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}create(){this.scene.physics.add.overlap(this.scene.player,this,this.killPlayer,void 0,this),this.scene.physics.add.collider(this.scene.plataformas,this,this.killBullet,void 0,this)}killPlayer(e,t){e.Die()}killBullet(e,t){const s=this.scene.add.particles(0,0,"starParticle",{x:this.x,y:this.y,speed:{min:120,max:260},angle:{min:0,max:360},scale:{start:1,end:0},alpha:{start:1,end:0},lifespan:{min:250,max:500},quantity:20,gravityY:-50});s.explode(5,this.x,this.y),this.scene.time.delayedCall(600,()=>{s.destroy()}),this.destroy()}fireFrom(e,t=10,s=Math.PI/180*-90){const i=this.body;let a=e.x??0,n=e.y??0,r=e.rotation??0;const o=e.getWorldTransformMatrix?.bind(e);if(o){const e=o(),t=new Phaser.Math.Vector2;e.transformPoint(0,0,t),a=t.x,n=t.y,r=Math.atan2(e.b,e.a)}r+=s,this.setPosition(a,n),this.setRotation(r+Math.PI/180*90);const l=Math.cos(r)*t,h=Math.sin(r)*t;i.setVelocity(l,h)}}class di extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"EnemyCannon",a??"EnemyCannon0001.png"),this.on("animationcomplete-EnemyCannon",this.shoot,this),this.on("animationrepeat-EnemyCannon",this.shoot,this)}shoot(){const e=new ci(this.scene);if(e.fireFrom)return void e.fireFrom(this,100);const t=this.getWorldTransformMatrix?.();let s=this.x,i=this.y,a=this.rotation;if(t){const e=new Phaser.Math.Vector2;t.transformPoint(0,0,e),s=e.x,i=e.y,a=Math.atan2(t.b,t.a)}e.setPosition(s,i),e.body.setVelocity(500*Math.cos(a),500*Math.sin(a)),this.setDepth(100)}}class ui extends Phaser.GameObjects.Container{constructor(e,t,s){super(e,t??0,s??0);const i=new di(e,0,-55);this.add(i);const a=new di(e,38,-39);a.angle=45,this.add(a);const n=new di(e,54,0);n.angle=90,this.add(n);const r=new di(e,38,39);r.angle=135,this.add(r);const o=new di(e,0,53);o.angle=-180,this.add(o);const l=new di(e,-40,40);l.angle=-135,this.add(l);const h=new di(e,-54,0);h.angle=-90,this.add(h);const c=new di(e,-41,-36);c.angle=-45.00000000000006,this.add(c);const d=e.add.sprite(1,0,"EnemyFace","Enemy10001.png");d.play({key:"EnemyFace",frameRate:12,yoyo:!0}),this.add(d),this.cannon1=i,this.cannon2=a,this.cannon3=n,this.cannon4=r,this.cannon5=o,this.cannon6=l,this.cannon7=h,this.cannon8=c,this.allCannons=[this.cannon1,this.cannon2,this.cannon3,this.cannon4,this.cannon5,this.cannon6,this.cannon7,this.cannon8],this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}cannon1;cannon2;cannon3;cannon4;cannon5;cannon6;cannon7;cannon8;NumberOfCannons=2;sequenceTimer;allCannons=[];activeCannons=[];create(){this.configureCannons(this.NumberOfCannons)}configureCannons(e){let t=[];switch(1===e||2===e||4===e||8===e?e:8){case 1:t=[0];break;case 2:t=[0,3];break;case 4:t=[0,2,4,6];break;case 8:t=[0,1,2,3,4,5,6,7]}this.allCannons.forEach((e,s)=>{const i=t.includes(s);e.setVisible(i),e.active=i,!i&&e.anims?.isPlaying&&e.anims.stop()}),this.activeCannons=t.map(e=>this.allCannons[e]),this.startCannonSequence()}startCannonSequence(){this.sequenceTimer&&(this.sequenceTimer.remove(!1),this.sequenceTimer=void 0);const e=this.activeCannons.length>0?this.activeCannons:this.allCannons.filter(e=>e.visible&&e.active);if(0===e.length)return;let t=0;this.sequenceTimer=this.scene.time.addEvent({delay:1e3,loop:!0,callback:()=>{const s=e[t];s&&s.play&&s.active&&s.visible&&s.play("EnemyCannon"),t=(t+1)%e.length}})}}class gi extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"CristalBlock",a),this.setInteractive(new Phaser.Geom.Rectangle(0,0,202,155),Phaser.Geom.Rectangle.Contains),e.physics.add.existing(this,!1),this.body.allowGravity=!1,this.body.allowDrag=!1,this.body.allowRotation=!1,this.body.collideWorldBounds=!0,this.body.setSize(80,80,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}isFalling=!1;IsCristalPlatform=!0;create(){this.fitBodyToTexture(),this.body.setImmovable(!0),this.body.moves=!1,this.body.pushable=!1,this.body.allowGravity=!1;const e=this.scene;e.physics.add.collider(this.scene.player,this,this.handlePlayerHit,void 0,this),e.plataformas&&e.plataformas.add(this);const t=()=>{const t=e.enemiesGroup;return!!t&&(this.scene.physics.add.collider(t,this),!0)};if(!t()){const e=this.scene.time.addEvent({delay:100,repeat:30,callback:()=>{t()&&e.remove(!1)}})}}fitBodyToTexture(){const e=this.body;if(!e)return;const t=this.displayWidth,s=this.displayHeight;e.setSize(t,s,!0)}handlePlayerHit(e,t){e?.chargeMode&&(this.scene.cameras.main.shake(200,.005),console.log("Cristal_Platform: no se puede destruir con golpe del jugador"))}handlePlatformCollision(e,t){const s=e===this?t:e;if(console.log("plataforma con la que colisiona Cristal_Platform:",s),s.IsFallingPlatform){console.log("Cristal_Platform: golpeada por plataforma cayendo, destruyndose"),this.body.enable=!1,this.spawnBubbleBurst(),this.setVisible(!1),this.setActive(!1);const e=this.scene;e.plataformas&&e.plataformas.remove(this,!1,!1),this.scene.time.delayedCall(300,()=>this.destroy())}}destroyByCrush(){console.log("Cristal_Platform: siendo destruida por aplastamiento"),this.body.enable=!1,this.spawnBubbleBurst(),this.setVisible(!1),this.setActive(!1);const e=this.scene;e.plataformas&&e.plataformas.remove(this,!1,!1),this.scene.time.delayedCall(300,()=>this.destroy())}preUpdate(e,t){super.preUpdate(e,t),this.isFalling&&this.y>this.scene.scale.height+200&&this.destroy()}spawnBubbleBurst(){const e=this.scene.add.particles(0,0,"BubbleParticle",{x:this.x,y:this.y,speed:{min:120,max:300},angle:{min:0,max:360},lifespan:{min:500,max:1200},scale:{start:.8,end:0},quantity:20,maxParticles:20,frequency:0,gravityY:-120});this.scene.time.delayedCall(1500,()=>e.destroy())}}class mi extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??1,s??0,i||"BlockRockl",a),this.setInteractive(new Phaser.Geom.Rectangle(0,0,202,155),Phaser.Geom.Rectangle.Contains),e.physics.add.existing(this,!1),this.body.allowGravity=!1,this.body.allowDrag=!1,this.body.allowRotation=!1,this.body.collideWorldBounds=!0,this.body.setCircle(64),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}isFalling=!1;IsFallingPlatform=!0;swayTween;originalX=0;originalY=0;originalTexture="";playerCollider;regenerating=!1;carryEnabled=!1;carryDirection=0;pendingDespawn=!1;respawnTimer;blinkTween;hostScene;playerCollisionDisabled=!1;create(){this.startSpawnScale(),this.body.setImmovable(!0),this.body.moves=!1,this.body.pushable=!1,this.body.allowGravity=!1,this.originalX=this.x,this.originalY=this.y,this.originalTexture=this.texture.key,this.startSwayMotion();const e=this.scene;e.plataformas&&e.plataformas.add(this),this.playerCollider=e.physics.add.collider(this.scene.player,this,this.handlePlayerHit,void 0,this),e.physics.add.collider(e.plataformas,this,this.handlePlatformCollision,void 0,this);const t=()=>{const t=e.enemiesGroup;return!!t&&(this.scene.physics.add.collider(t,this),!0)};if(!t()){const e=this.scene.time.addEvent({delay:100,repeat:30,callback:()=>{t()&&e.remove(!1)}})}}startSpawnScale(){this.body.enable=!1,this.setScale(0),this.scene.tweens.add({targets:this,scale:1,duration:250,ease:"Back.Out",onComplete:()=>{this.fitBodyToTexture(),this.body.enable=!0}})}fitBodyToTexture(){const e=this.body;if(!e)return;const t=this.displayWidth,s=this.displayHeight,i=.5*Math.min(t,s),a=.5*t-i,n=.5*s-i;e.setCircle(i,a,n)}handlePlayerHit(e,t){const s=e?.body,i=this.body;if(!s)return;const a=!!e?.chargeMode;if(console.log(`Fall_Platform: jugador hit. Charged: ${a}`),this.isFalling){const e=(s.center?.x??s.x+.5*s.width)<(i.center?.x??this.x)?1:-1;this.carryDirection=e,this.carryEnabled=!0;const t=i.angularVelocity||0,a=Math.max(Math.abs(t),40);return i.setAngularVelocity(a*e),void i.setAngularDrag(10)}if(a){console.log("Fall_Platform: jugador cargado, plataforma cae"),this.isFalling=!0,this.carryEnabled=!0,this.stopSwayMotion();const e=this.scene;e.plataformas&&e.plataformas.remove(this,!1,!1),i.setImmovable(!1),i.pushable=!0,i.moves=!0,i.allowGravity=!0,i.allowRotation=!0,i.setGravityY(0),i.setMaxVelocity(100,400),i.setBounce(.1,.35);const t=(s.center?.x??s.x+.5*s.width)<(i.center?.x??this.x)?1:-1;this.carryDirection=t,i.setAngularVelocity(20*t),i.setAngularDrag(10),this.spawnBubbleBurst()}else i.pushable=!1,i.setImmovable(!0)}handlePlatformCollision(e,t){if(!this.isFalling||this.regenerating||this.pendingDespawn)return;this.pendingDespawn=!0;const s=e===this?t:e,i=s?.body,a=this.body;return s&&s.IsBtnPresion&&"function"==typeof s.handlePlatformCollision?(s.handlePlatformCollision(s,this),void(this.pendingDespawn=!1)):s&&s.IsCristalPlatform?(console.log("Fall_Platform: golpe plataforma de cristal, destruyndola"),"function"==typeof s.destroyByCrush&&s.destroyByCrush(),void(this.pendingDespawn=!1)):void(i&&a.bottom<=i.top+10&&a.velocity.y>=0?(a.moves=!1,a.pushable=!1,a.allowGravity=!1,a.setDrag(0),this.isFalling=!1,console.log("Fall_Platform: detenida al colisionar, titileo diferido antes de regenerar"),this.scene.time.delayedCall(2e3,()=>{this.disablePlayerCollisionDuringBlink();const e=this.scene.tweens.add({targets:this,alpha:.3,yoyo:!0,duration:120,repeat:-1});this.scene.time.delayedCall(4e3,()=>{e.stop(),this.setAlpha(1),this.spawnStarBurst(),this.scheduleRegeneration()})})):this.pendingDespawn=!1)}startSwayMotion(){if(this.swayTween)return;const e=()=>{this.scene.tweens.add({targets:this,x:this.originalX+2,duration:50,ease:"Linear",yoyo:!0,repeat:3,onComplete:()=>{this.x=this.originalX}})};e(),this.swayTween=this.scene.time.addEvent({delay:3e3,callback:e,loop:!0})}stopSwayMotion(){this.swayTween&&("function"==typeof this.swayTween.remove?this.swayTween.remove():"function"==typeof this.swayTween.stop&&this.swayTween.stop(),this.swayTween=void 0),this.x=this.originalX}scheduleRegeneration(){const e=this.hostScene||this.scene;if(!e)return;this.regenerating=!0,this.pendingDespawn=!0,this.setVisible(!1),this.setActive(!1);const t=this.body;t&&(t.enable=!1),console.log("Fall_Platform: programando regeneracin en 3 segundos"),this.respawnTimer=e.time.delayedCall(3e3,()=>{this.spawnReplacement()})}blinkThenRegenerate(e=1200){const t=this.hostScene||this.scene;t&&(this.regenerating||(this.disablePlayerCollisionDuringBlink(),this.blinkTween&&(this.blinkTween.stop(),this.blinkTween=void 0),this.isFalling=!1,this.pendingDespawn=!0,this.blinkTween=t.tweens.add({targets:this,alpha:.3,yoyo:!0,duration:100,repeat:-1}),t.time.delayedCall(e,()=>{this.blinkTween?.stop(),this.blinkTween=void 0,this.setAlpha(1),this.scheduleRegeneration()})))}disablePlayerCollisionDuringBlink(){this.playerCollisionDisabled||(this.playerCollider&&(this.playerCollider.active=!1),this.playerCollisionDisabled=!0)}destroy(e){this.blinkTween?.stop(),this.blinkTween=void 0,this.respawnTimer?.remove(!1),this.respawnTimer=void 0,super.destroy(e)}spawnReplacement(){const e=this.hostScene||this.scene;if(!e||!e.sys)return;const t=e,s=new mi(e,this.originalX,this.originalY,this.originalTexture);e.add.existing(s),t.plataformas&&t.plataformas.add(s),this.respawnTimer&&(this.respawnTimer.remove(!1),this.respawnTimer=void 0),this.destroy()}preUpdate(e,t){if(super.preUpdate(e,t),this.isFalling&&this.carryEnabled&&!this.regenerating){const e=this.body,t=this.carryDirection||0;if(0!==t){const s=220*t;e.setAngularVelocity(Phaser.Math.Linear(e.angularVelocity,s,.1));const i=Phaser.Math.Clamp(.2*e.angularVelocity,-300,300);e.setVelocityX(i)}this.y>this.scene.scale.height+200&&this.scheduleRegeneration()}}spawnBubbleBurst(){const e=this.scene.add.particles(0,0,"BubbleParticle",{x:this.x,y:this.y,speed:{min:120,max:300},angle:{min:0,max:360},lifespan:{min:500,max:1200},scale:{start:.8,end:0},quantity:20,maxParticles:20,frequency:0,gravityY:-120});this.scene.time.delayedCall(1500,()=>e.destroy())}spawnStarBurst(){const e=this.scene.add.particles(0,0,"starParticle",{x:this.x,y:this.y,speed:{min:120,max:260},angle:{min:0,max:360},scale:{start:1,end:0},alpha:{start:1,end:0},lifespan:{min:250,max:500},quantity:20,gravityY:-50});e.explode(5,this.x,this.y),this.scene.time.delayedCall(600,()=>{e.destroy()})}}class pi extends ii{constructor(){super("Level2")}editorCreate(){const e=new ai(this,111,363);this.add.existing(e);const t=new ai(this,946,509);this.add.existing(t);const s=new hi(this,542,49);this.add.existing(s),this.add.image(540,-42,"Platform3").angle=-180;const i=new ni(this,132,481);this.add.existing(i);const a=this.add.image(511,568,"FrontLayer"),n=new ni(this,927,106);this.add.existing(n);const r=new ni(this,530,117);this.add.existing(r);const o=this.add.image(112,203,"CloseChestanimation","CloseChest0031.png"),l=new ui(this,539,321);this.add.existing(l);const h=this.add.image(947,376,"door"),c=new gi(this,274,504,"CristalBlock2");this.add.existing(c);const d=new mi(this,346,92);this.add.existing(d);const u=new ri(this,940,77,"cloud1");this.add.existing(u),this.frontLayer=a,this.chestOrigin=o,this.doorOrigin=h,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level3"}class fi extends Ns{constructor(e,t,s,i,a,n,r,o,l){super(e,t,s??0,i??0,a??"RanaEnemy",n??"RanaEnemy-atlas",o??new Us("Idle",["default"])),this.skeleton.setSkinByName(r??"default"),this.scaleX=.4786267887723732,this.scaleY=.4786267887723732,e.physics.add.existing(this,!1),this.body.setSize(83.0000027382022,76.49000000953671,!1),this.animationState.setAnimation(0,"Idle",!0);const h=this.body;h.setAllowGravity(!0),h.setGravityY(900),h.setDrag(0,0),h.setMaxVelocity(300,1200),h.setOffset(h.offset.x,h.offset.y-15),this.scene.physics.add.overlap(this.scene.player,this,this.killPlayer,void 0,this);const c=e;"function"==typeof c.addCollidingEnemy?(c.addCollidingEnemy(this),this._addedToList=!0):c.enemiesGroup&&(c.enemiesGroup.add(this),this._addedToList=!0),this.once(Phaser.GameObjects.Events.DESTROY,()=>{this._addedToList&&("function"==typeof c.removeCollidingEnemy?c.removeCollidingEnemy(this):c.enemiesGroup&&c.enemiesGroup.remove(this,!1,!1),this._addedToList=!1),this.jumpTimer?.remove(!1)}),this.initJumpLoop()}killPlayer(e,t){e.Die()}jumpImpulse=200;jumpIntervalMin=3e3;jumpIntervalMax=6e3;_addedToList=!1;jumpTimer;isJumping=!1;initJumpLoop(){try{this.animationState.addListener({complete:e=>{if("Jumping"===e?.animation?.name){const e=this.body;e&&e.setVelocityY(-this.jumpImpulse);try{this.animationState.setAnimation(0,"Idle",!0)}catch{}this.isJumping=!1,this.scheduleNextJump()}}})}catch{}this.scheduleNextJump()}scheduleNextJump(){const e=Phaser.Math.Between(this.jumpIntervalMin,this.jumpIntervalMax);this.jumpTimer=this.scene.time.addEvent({delay:e,callback:()=>this.triggerJump()})}triggerJump(){if(!this.isJumping){this.isJumping=!0;try{this.animationState.setAnimation(0,"Jumping",!1)}catch{const e=this.body;e&&e.setVelocityY(-this.jumpImpulse);try{this.animationState.setAnimation(0,"Idle",!0)}catch{}this.isJumping=!1,this.scheduleNextJump()}}}}class yi extends ii{constructor(){super("Level3")}editorCreate(){const e=new hi(this,682,519);this.add.existing(e),e.angle=-90;const t=new ai(this,610,390);this.add.existing(t);const s=new ai(this,119,615);this.add.existing(s);const i=new hi(this,675,123);this.add.existing(i),i.angle=-180;const a=new ai(this,675,226,"Platform3");this.add.existing(a);const n=new gi(this,889,399);this.add.existing(n);const r=new ni(this,877,507);this.add.existing(r);const o=this.add.image(511,568,"FrontLayer"),l=new ni(this,927,106);this.add.existing(l);const h=new ni(this,96,80);this.add.existing(h);const c=this.add.image(536,228,"CloseChestanimation","CloseChest0031.png"),d=new ri(this,684,71,"cloud1");this.add.existing(d),d.scaleX=.8365933650783711,d.scaleY=.8365933650783711;const u=new ai(this,604,494,"Platform3");this.add.existing(u);const g=new mi(this,897,67);this.add.existing(g);const m=this.add.image(65,482,"door"),p=new fi(this,this.spine,182,522);this.add.existing(p),this.frontLayer=o,this.chestOrigin=c,this.doorOrigin=m,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level4"}class wi extends ii{constructor(){super("Level4")}editorCreate(){const e=new hi(this,572,342);this.add.existing(e),e.angle=-90;const t=new ai(this,100,512,"Platform2");this.add.existing(t);const s=new ai(this,953,583);this.add.existing(s);const i=new ai(this,470,339,"Platform2");this.add.existing(i);const a=new ni(this,106,98);this.add.existing(a);const n=this.add.image(511,568,"FrontLayer"),r=new ni(this,767,281);this.add.existing(r);const o=new ni(this,466,74);this.add.existing(o);const l=this.add.image(89,355,"CloseChestanimation","CloseChest0031.png"),h=this.add.image(952,455,"door"),c=new fi(this,this.spine,467,245);this.add.existing(c);const d=new ri(this,772,277,"cloud1");this.add.existing(d),d.scaleX=.8365933650783711,d.scaleY=.8365933650783711;const u=new ri(this,133,114,"cloud2");this.add.existing(u),u.scaleX=.8365933650783711,u.scaleY=.8365933650783711,this.frontLayer=n,this.chestOrigin=l,this.doorOrigin=h,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level5"}class xi extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"DoorGlow",a??"LateralDoor0001.png"),this.setInteractive(new Phaser.Geom.Rectangle(0,0,68,141),Phaser.Geom.Rectangle.Contains),e.physics.add.existing(this,!1),this.body.moves=!1,this.body.allowGravity=!1,this.body.pushable=!1,this.body.immovable=!0,this.body.setSize(68,141,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}DoorName="Door1";flickTimer;create(){const e=this.scene;e.plataformas&&(e.plataformas.add(this),e.physics.add.collider(this.scene.player,this)),this.scheduleFlick()}scheduleFlick(){if(!this.scene||!this.scene.time)return;const e=Phaser.Math.Between(4e3,9e3);this.flickTimer=this.scene.time.delayedCall(e,()=>{this.playFlick()},void 0,this)}playFlick(){const e=this.body,t=this.anims?.currentAnim?.key,s="OpenLateralDoor"===t;this.active&&this.visible&&!s&&!1!==e?.enable?(this.play("LateralDoorFlick",!0),this.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{this.setTexture("DoorGlow","LateralDoor0001.png"),this.scheduleFlick()})):this.scheduleFlick()}destroy(e){this.flickTimer?.remove(!1),this.flickTimer=void 0,super.destroy(e)}}class bi extends Phaser.GameObjects.Sprite{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"BtnPresion",a??"BtnPresion0001.png"),this.setInteractive(new Phaser.Geom.Rectangle(0,0,280,49),Phaser.Geom.Rectangle.Contains),e.physics.add.existing(this,!1),this.body.setSize(280,49,!1);const n=this.body;n.setImmovable(!0),n.moves=!1,n.pushable=!1,n.allowGravity=!1,this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}IsBtnPresion=!0;DoorToActivate="Door1";isPressed=!1;isTouching=!1;create(){const e=this.scene;e.plataformas&&e.plataformas.add(this),e.player&&this.scene.physics.add.collider(this,e.player,this.handlePlatformCollisionPlayer,void 0,this),e.plataformas}handlePlatformCollision(e,t){console.log(t),t.body.setBounce(0),t.body.setVelocityY(0),t.body.setImmovable(!0),t.body.moves=!1,t.body.allowGravity=!1,t.body.pushable=!1,t.y=e.y-e.displayHeight/2-t.displayHeight/2+5,this.isTouching=!0,this.isPressed||(this.isPressed=!0,this.play("BtnPresionDown",!0),this.openLinkedDoor()),t?.IsFallingPlatform&&("function"==typeof t.blinkThenRegenerate?t.blinkThenRegenerate(4e3):"function"==typeof t.scheduleRegeneration&&t.scheduleRegeneration())}handlePlatformCollisionPlayer(e,t){}preUpdate(e,t){super.preUpdate(e,t);const s=this.body,i=!1===s.touching.none||!1===s.wasTouching.none||s.embedded||this.isTouching;this.isTouching=!1,this.isPressed&&!i&&(this.isPressed=!1,this.playReverse?.("BtnPresionDown"),this.closeLinkedDoor())}openLinkedDoor(){const e=this.scene;if(!e?.plataformas)return;const t=e.plataformas.getChildren()?.find(e=>e?.DoorName===this.DoorToActivate);t&&(t.body&&(t.body.checkCollision.none=!0,t.body.enable=!1),"function"==typeof t.play&&t.play("OpenLateralDoor",!0))}closeLinkedDoor(){const e=this.scene;if(!e?.plataformas)return;const t=e.plataformas.getChildren()?.find(e=>e?.DoorName===this.DoorToActivate);t&&(t.body&&(t.body.checkCollision.none=!1,t.body.enable=!0),"function"==typeof t.play&&t.playReverse?.("OpenLateralDoor"))}}class vi extends ii{constructor(){super("Level5")}editorCreate(){const e=new hi(this,240,305);this.add.existing(e),e.angle=-90;const t=new gi(this,921,466);this.add.existing(t);const s=new mi(this,950,89);this.add.existing(s);const i=new ai(this,107,302);this.add.existing(i);const a=new ai(this,421,521,"Platform3");this.add.existing(a);const n=new ai(this,817,204,"Platform3");this.add.existing(n),n.angle=-180;const r=new ni(this,92,489);this.add.existing(r);const o=this.add.image(511,568,"FrontLayer"),l=new ni(this,951,254);this.add.existing(l);const h=new ni(this,584,68);this.add.existing(h);const c=this.add.image(115,144,"CloseChestanimation","CloseChest0031.png"),d=this.add.image(417,378,"door"),u=new ri(this,131,474,"cloud1");this.add.existing(u),u.scaleX=.8365933650783711,u.scaleY=.8365933650783711;const g=new fi(this,this.spine,658,410);this.add.existing(g);const m=new ni(this,963,537);this.add.existing(m);const p=new ri(this,580,66,"cloud3");this.add.existing(p),p.scaleX=.8365933650783711,p.scaleY=.8365933650783711;const f=new xi(this,849,364);this.add.existing(f);const y=new ai(this,573,521);this.add.existing(y);const w=new ai(this,816,26,"Platform3");this.add.existing(w),w.angle=-180;const x=new bi(this,566,435);this.add.existing(x),x.scaleX=.4,x.scaleY=.4;const b=new mi(this,300,69);this.add.existing(b),this.frontLayer=o,this.chestOrigin=c,this.doorOrigin=d,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level6"}class ki extends Ns{constructor(e,t,s,i,a,n,r,o,l){super(e,t,s??0,i??0,a??"BatEnemy",n??"BatEnemy-atlas",o??new Us(null,["default"])),this.skeleton.setSkinByName(r??"default"),this.scaleX=.4,this.scaleY=.4,e.physics.add.existing(this,!1),this.body.setSize(143.0000019028185,117.99999999999997,!1),this.animationState.setAnimation(0,"Born",!1),this.animationState.addAnimation(0,"Idle",!0,0);const h=this.body;h.setAllowGravity(!1),h.setGravityY(0),h.setDrag(0,0),h.setMaxVelocity(300,1200),this.scene.physics.add.overlap(this.scene.player,this,this.killPlayer,void 0,this);let c=!1;this.animationState.addListener({complete:e=>{if(!c&&e&&e.animation&&"Born"===e.animation.name){c=!0;const e=this.y;this.scene.tweens.add({targets:this,y:e+30,duration:500,ease:"Bounce.Out",onComplete:()=>{const e=0===Phaser.Math.Between(0,1)?-1:1;h.setVelocity(140*e,0),this.baseY=this.y,this.sinePhase=0,this.oscillate=!0}})}}})}preUpdate(e,t){super.preUpdate(e,t),this.oscillate&&(this.sinePhase+=t*this.sineFrequency,this.y=this.baseY+Math.sin(this.sinePhase)*this.sineAmplitude);const s=this.scene.scale.width,i=this.scene.scale.height;(this.x<-120||this.x>s+120||this.y<-120||this.y>i+120)&&this.destroy()}killPlayer(e,t){e.Die()}baseY=0;sinePhase=0;oscillate=!1;sineAmplitude=18;sineFrequency=.01}class Si extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"BatCave",a),this.scaleX=.5,this.scaleY=.54,this.startSpawner(),this.scene.events.once(Phaser.Scenes.Events.DESTROY,()=>{this.stopSpawner()})}DeployTime=3e3;spawnTimer;startSpawner(){this.stopSpawner();const e=Math.max(200,this.DeployTime||0);this.spawnTimer=this.scene.time.addEvent({delay:e,loop:!0,callback:()=>this.spawnBat()})}stopSpawner(){this.spawnTimer&&(this.spawnTimer.remove(!1),this.spawnTimer=void 0)}spawnBat(){const e=this.scene.spine;if(!e)return;const t=new ki(this.scene,e,this.x,this.y);this.scene.add.existing(t)}}class Ci extends ii{constructor(){super("Level6")}editorCreate(){const e=new ai(this,55,224);this.add.existing(e);const t=new gi(this,890,421);this.add.existing(t);const s=new ai(this,356,504,"Platform3");this.add.existing(s);const i=new ai(this,514,504,"Platform3");this.add.existing(i);const a=new ai(this,692,612,"Platform3");this.add.existing(a),a.angle=-180;const n=new ai(this,692,432,"Platform3");this.add.existing(n);const r=new ai(this,86,616);this.add.existing(r);const o=new ni(this,688,250);this.add.existing(o);const l=this.add.image(591,565,"FrontLayer"),h=new ni(this,887,508);this.add.existing(h);const c=new ni(this,348,280);this.add.existing(c);const d=this.add.image(79,68,"CloseChestanimation","CloseChest0031.png"),u=new mi(this,499,45);this.add.existing(u);const g=this.add.image(65,482,"door"),m=new ri(this,501,63,"cloud1");this.add.existing(m),m.scaleX=.8365933650783711,m.scaleY=.8365933650783711;const p=new ai(this,912,70);this.add.existing(p),p.angle=-180;const f=new Si(this,915,201);this.add.existing(f);const y=new fi(this,this.spine,511,399);this.add.existing(y),this.frontLayer=l,this.chestOrigin=d,this.doorOrigin=g,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level7"}class Ti extends ii{constructor(){super("Level7")}editorCreate(){const e=new hi(this,456,55);this.add.existing(e),e.angle=90;const t=new ai(this,527,77,"Platform3");this.add.existing(t),t.angle=-180;const s=new ai(this,119,615);this.add.existing(s);const i=new ai(this,920,546);this.add.existing(i);const a=new ni(this,487,518);this.add.existing(a);const n=this.add.image(511,568,"FrontLayer"),r=new ni(this,927,106);this.add.existing(r);const o=new ni(this,96,80);this.add.existing(o);const l=this.add.image(923,389,"CloseChestanimation","CloseChest0031.png"),h=this.add.image(65,482,"door"),c=new fi(this,this.spine,182,522);this.add.existing(c);const d=new ri(this,112,94,"cloud1");this.add.existing(d),d.scaleX=.4914675624384814,d.scaleY=.4914675624384814;const u=new ri(this,480,510,"cloud2");this.add.existing(u),u.scaleX=.4914675624384814,u.scaleY=.4914675624384814;const g=new ri(this,930,106,"cloud3");this.add.existing(g),g.scaleX=.4914675624384814,g.scaleY=.4914675624384814;const m=new Si(this,528,223);this.add.existing(m),this.frontLayer=n,this.chestOrigin=l,this.doorOrigin=h,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level8"}class Pi extends ii{constructor(){super("Level8")}editorCreate(){const e=new ai(this,290,541,"Platform3");this.add.existing(e);const t=new hi(this,940,460);this.add.existing(t),t.angle=-180;const s=new ai(this,937,545);this.add.existing(s);const i=new ai(this,135,490,"Platform3");this.add.existing(i);const a=new ni(this,284,351);this.add.existing(a);const n=this.add.image(511,568,"FrontLayer"),r=new ni(this,927,106);this.add.existing(r);const o=new ni(this,96,80);this.add.existing(o);const l=this.add.image(523,359,"CloseChestanimation","CloseChest0031.png"),h=this.add.image(136,345,"door"),c=new fi(this,this.spine,283,436);this.add.existing(c);const d=new ri(this,770,102,"cloud1");this.add.existing(d),d.scaleX=.8365933650783711,d.scaleY=.8365933650783711;const u=new ai(this,528,508);this.add.existing(u);const g=new ri(this,95,58,"cloud1");this.add.existing(g),g.scaleX=.8365933650783711,g.scaleY=.8365933650783711;const m=new ri(this,292,70,"cloud2");this.add.existing(m),m.scaleX=.8365933650783711,m.scaleY=.8365933650783711;const p=new ri(this,953,59,"cloud3");this.add.existing(p),p.scaleX=.8365933650783711,p.scaleY=.8365933650783711;const f=new ai(this,533,27,"Platform3");this.add.existing(f),f.angle=-180;const y=new Si(this,529,171);this.add.existing(y),this.frontLayer=n,this.chestOrigin=l,this.doorOrigin=h,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level9"}class Ai extends ii{constructor(){super("Level9")}editorCreate(){const e=new ai(this,949,158);this.add.existing(e),e.scaleX=.6753246753246753,e.scaleY=.6753246753246753;const t=new ai(this,144,276,"Platform2");this.add.existing(t);const s=new ai(this,370,511,"Platform3");this.add.existing(s);const i=new ai(this,823,510,"Platform3");this.add.existing(i);const a=new ai(this,1016,498,"Platform3");this.add.existing(a);const n=new ni(this,487,518);this.add.existing(n);const r=this.add.image(511,568,"FrontLayer"),o=new ni(this,144,460);this.add.existing(o);const l=new ni(this,113,62);this.add.existing(l);const h=this.add.image(946,22,"CloseChestanimation","CloseChest0031.png"),c=this.add.image(815,365,"door"),d=new fi(this,this.spine,333,404);this.add.existing(d);const u=new ri(this,637,501,"cloud1");this.add.existing(u),u.scaleX=.8365933650783711,u.scaleY=.8365933650783711;const g=new fi(this,this.spine,990,390);this.add.existing(g);const m=new fi(this,this.spine,169,182);this.add.existing(m);const p=new ni(this,977,276);this.add.existing(p);const f=new ri(this,144,467,"cloud2");this.add.existing(f),f.scaleX=.8365933650783711,f.scaleY=.8365933650783711,this.frontLayer=r,this.chestOrigin=h,this.doorOrigin=c,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level10"}class Ii extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"CatTrack",a),e.physics.add.existing(this,!1),this.body.setSize(58,54,!1),e.physics.add.existing(this,!1),this.body.moves=!1,this.body.allowGravity=!1,this.body.allowDrag=!1,this.body.allowRotation=!1,this.body.pushable=!1,this.body.immovable=!0,this.body.setSize(40,40,!1),this.scene.events.once(Phaser.Scenes.Events.UPDATE,this.create,this)}TrackToUnlock="Unlock1";bobTween;collected=!1;create(){this.scene.physics.add.overlap(this.scene.player,this,this.collectBy,void 0,this)}createBob(){const e=this.y;this.bobTween=this.scene.tweens.add({targets:this,y:e-12,duration:900,ease:"Sine.InOut",yoyo:!0,repeat:-1})}collectBy(e,t){if(this.collected)return;this.collected=!0,this.body&&(this.body.enable=!1);const s=this.scene.game.registry;s.set("HasNewTrack",!0);try{const e="UnlockedTracks",t=localStorage.getItem(e),i=t?JSON.parse(t):[];i.includes(this.TrackToUnlock)||(i.push(this.TrackToUnlock),localStorage.setItem(e,JSON.stringify(i)),s.set(e,i))}catch(e){const t=s.get("UnlockedTracks")||[];t.includes(this.TrackToUnlock)||(t.push(this.TrackToUnlock),s.set("UnlockedTracks",t))}this.bobTween?.stop(),this.bobTween=void 0;const i=this.scene.add.particles(0,0,"starParticle",{x:this.x,y:this.y,speed:{min:120,max:260},angle:{min:0,max:360},scale:{start:1,end:0},alpha:{start:1,end:0},lifespan:{min:250,max:500},quantity:20,gravityY:-50});i.explode(20,this.x,this.y),this.scene.time.delayedCall(600,()=>{i.destroy()}),this.scene.tweens.add({targets:this,y:-100,duration:1200,ease:"Quad.Out",onComplete:()=>{e.scene?.toggleMapOverlay?.(),this.destroy()}})}preUpdate(){this.collected||this.bobTween||this.createBob()}}class Mi extends ii{constructor(){super("Level10")}editorCreate(){const e=new gi(this,485,263);this.add.existing(e);const t=new ai(this,769,512);this.add.existing(t);const s=new ai(this,119,615);this.add.existing(s);const i=new ni(this,96,286);this.add.existing(i);const a=this.add.image(511,568,"FrontLayer"),n=new ni(this,554,510);this.add.existing(n);const r=new ni(this,249,47);this.add.existing(r);const o=this.add.image(98,456,"CloseChestanimation","CloseChest0031.png"),l=this.add.image(976,441,"door"),h=new mi(this,69,66);this.add.existing(h);const c=new fi(this,this.spine,221,519);this.add.existing(c);const d=new ri(this,55,32,"cloud1");this.add.existing(d),d.scaleX=.8365933650783711,d.scaleY=.8365933650783711;const u=new ui(this,891,106);this.add.existing(u);const g=new ai(this,1018,572,"Platform2");this.add.existing(g);const m=new ai(this,323,388,"Platform3");this.add.existing(m);const p=new ai(this,323,554,"Platform3");this.add.existing(p);const f=new ni(this,959,285);this.add.existing(f);const y=new fi(this,this.spine,684,381);this.add.existing(y);const w=new fi(this,this.spine,769,381);this.add.existing(w);const x=new fi(this,this.spine,847,381);this.add.existing(x);const b=new ni(this,477,100);this.add.existing(b);const v=new Ii(this,459,391);this.add.existing(v),u.NumberOfCannons=8,v.TrackToUnlock="Unlock2",this.frontLayer=a,this.chestOrigin=o,this.doorOrigin=l,this.events.emit("scene-awake")}frontLayer;chestOrigin;doorOrigin;nextLevel="Level1"}class Ri extends Phaser.Scene{constructor(){super("TitleScene")}editorCreate(){const e=this.add.image(0,0,"BackGround");e.setOrigin(0,0);const t=this.add.image(947,559,"Bubble"),s=this.add.image(900,537,"TitleCloud1"),i=this.add.image(781,550,"TitleCloud2"),a=this.add.image(134,541,"TitleCloud1");a.scaleX=-1;const n=this.add.image(283,575,"TitleCloud2");n.scaleX=-1;const r=this.add.image(530,269,"TextTitle"),o=this.add.image(534,461,"ReadyButton"),l=this.add.image(922,214,"Intro_Star"),h=this.add.image(122,142,"Intro_Star");h.angle=-52.99999999999994;const c=this.add.image(317,464,"Mishiko");c.scaleX=.5,c.scaleY=.5,this.backGround=e,this.bubble=t,this.titleCloud1=s,this.titleCloud2=i,this.titleCloud=a,this.titleCloud_1=n,this.textTitle=r,this.readyButton=o,this.intro_Star=l,this.intro_Star_1=h,this.mishiko=c,this.events.emit("scene-awake")}backGround;bubble;titleCloud1;titleCloud2;titleCloud;titleCloud_1;textTitle;readyButton;intro_Star;intro_Star_1;mishiko;create(){this.editorCreate(),this.startFadeIn(),this.initIntroStars(),this.initMishiko(),this.startCloudFloat(),this.startTitleIntro(),this.startReadyIntro(),this.wireReadyButton(),this.startBubbleRise()}startFadeIn(){const e=this.add.rectangle(0,0,this.scale.width,this.scale.height,0,1).setOrigin(0,0).setScrollFactor(0).setDepth(2e3);this.tweens.add({targets:e,alpha:0,duration:1500,ease:"Quad.Out",onComplete:()=>e.destroy()})}initMishiko(){this.mishiko.setData("baseScaleX",this.mishiko.scaleX||1),this.mishiko.setData("baseScaleY",this.mishiko.scaleY||1),this.mishiko.setScale(0),this.mishiko.setAlpha(0)}initIntroStars(){[this.intro_Star,this.intro_Star_1].forEach(e=>{e.setData("baseScaleX",e.scaleX||1),e.setData("baseScaleY",e.scaleY||1),e.setScale(0),e.setAlpha(0)})}startTitleIntro(){const e=this.textTitle.y,t=this.textTitle.scaleX||1,s=this.textTitle.scaleY||1,i=-this.textTitle.height-40;this.textTitle.y=i,this.textTitle.scale=1*t,this.time.delayedCall(1e3,()=>{this.tweens.add({targets:this.textTitle,y:e,scaleX:1.04*t,scaleY:1.04*s,duration:950,ease:"Back.Out",onComplete:()=>{this.tweens.add({targets:this.textTitle,scaleX:1.03*t,scaleY:1.03*s,duration:1800,yoyo:!0,repeat:-1,ease:"Sine.InOut"}),this.startStarsIntro()}})})}startStarsIntro(){[this.intro_Star,this.intro_Star_1].forEach(e=>{const t=e.getData("baseScaleX")||e.scaleX||1,s=(e.getData("baseScaleY")||e.scaleY,t),i=Phaser.Math.Between(0,180);e.setScale(0),e.alpha=0,this.time.delayedCall(150+i,()=>{this.tweens.add({targets:e,scaleX:1.15*s,scaleY:1.15*s,alpha:1,duration:520,ease:"Back.Out",onComplete:()=>{this.tweens.add({targets:e,scaleX:s,scaleY:s,duration:220,ease:"Quad.Out"});const t=Phaser.Math.FloatBetween(3,7),i=Phaser.Math.Between(2e3,3200);this.tweens.add({targets:e,angle:`+=${t}`,duration:i,ease:"Sine.InOut",yoyo:!0,repeat:-1})}})})})}readyShakeActive=!1;mishikoFloatTween;startReadyIntro(){const e=this.readyButton.y,t=this.readyButton.scaleX||1,s=this.readyButton.scaleY||1,i=-this.readyButton.height-20;this.readyButton.y=i,this.readyButton.scale=1*t,this.time.delayedCall(1200,()=>{this.tweens.add({targets:this.readyButton,y:e,scaleX:1.06*t,scaleY:1.06*s,duration:900,ease:"Back.Out",onComplete:()=>{this.readyButton.setScale(t,s),this.startReadyShakeLoop(t,s),this.startMishikoIntro()}})})}startReadyShakeLoop(e,t){this.time.addEvent({delay:6e3,loop:!0,callback:()=>{this.readyShakeActive||(this.readyShakeActive=!0,this.tweens.add({targets:this.readyButton,y:this.readyButton.y-6,scaleX:1.04*e,scaleY:1.04*t,duration:120,yoyo:!0,repeat:2,ease:"Quad.Out",onComplete:()=>{this.readyButton.setScale(e,t),this.readyShakeActive=!1}}))}})}wireReadyButton(){this.readyButton.setInteractive({useHandCursor:!0}),this.readyButton.on(Phaser.Input.Events.POINTER_UP,()=>{this.scene.start("Level1")})}startMishikoIntro(){const e=this.mishiko.y,t=this.mishiko.x,s=this.mishiko.getData("baseScaleX")||this.mishiko.scaleX||1,i=this.mishiko.getData("baseScaleY")||this.mishiko.scaleY||1,a=this.scale.height+this.mishiko.height;this.mishiko.y=a,this.mishiko.x=t,this.mishiko.alpha=0,this.mishiko.setScale(0),this.tweens.add({targets:this.mishiko,y:e,alpha:1,scaleX:1.02*s,scaleY:1.02*i,duration:1e3,ease:"Back.Out",onComplete:()=>{this.mishiko.setScale(s,i),this.startMishikoFloat()}})}startMishikoFloat(){this.mishikoFloatTween?.stop(),this.mishikoFloatTween=this.tweens.add({targets:this.mishiko,y:"+=8",duration:1800,ease:"Sine.InOut",yoyo:!0,repeat:-1})}startCloudFloat(){const e=(e,t,s,i=0)=>{const a=e.scaleX||1,n=e.scaleY||1;this.tweens.add({targets:e,scaleX:a*(1+t),scaleY:n*(1+t),duration:s,ease:"Sine.InOut",yoyo:!0,repeat:-1,delay:i})};e(this.titleCloud1,.06,2600,0),e(this.titleCloud2,.05,2800,200),e(this.titleCloud,.05,2400,120),e(this.titleCloud_1,.04,3e3,320)}startBubbleRise(){const e=[this.bubble];for(let t=1;t<8;t++){const t=this.add.image(this.bubble.x,this.bubble.y,this.bubble.texture.key);e.push(t)}e.forEach((e,t)=>this.launchBubble(e,200*t))}launchBubble(e,t=0){const s=Phaser.Math.Between(40,this.scale.width-40),i=this.scale.height+Phaser.Math.Between(120,220),a=Phaser.Math.FloatBetween(.5,1),n=Phaser.Math.Between(5e3,9500);e.setPosition(s,i),e.setScale(a),e.setAlpha(.9),this.tweens.add({targets:e,y:-160,duration:n,ease:"Sine.InOut",delay:t,onComplete:()=>this.launchBubble(e)})}}class Fi extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"MapStar",a),e.add.existing(this),this.startFloating()}originalY;floatTween;startFloating(e=6,t=2e3){if(this.originalY=this.originalY??this.y,this.floatTween&&!this.floatTween?.isDestroyed)return;const s=t+Phaser.Math.Between(-400,400),i=Phaser.Math.Between(0,800);this.floatTween=this.scene.tweens.add({targets:this,y:this.originalY+e,ease:"Sine.InOut",duration:s,yoyo:!0,repeat:-1,delay:i})}destroy(e){if(this.floatTween){try{this.floatTween.stop()}catch{}this.floatTween=void 0}super.destroy(e)}}class Ei extends Phaser.GameObjects.Container{constructor(e,t,s){super(e,t??0,s??0);const i=e.add.image(0,0,"MapDot");this.add(i);const a=e.add.image(0,-34,"MapSelector");this.add(a),this.mapDot=i,this.mapSelector=a,this.scene.events.once("scene-awake",()=>this.awake()),this.mapDot.setTint(10395294),this.setAlpha(.4),this.mapSelector.setVisible(!1);const n=()=>{this.mapSelector.setVisible(!0),this.scene.tweens.killTweensOf(this.mapDot),this.scene.tweens.add({targets:this.mapDot,scale:1.08,duration:150,ease:"Quad.Out"}),this.mapDot.clearTint()},r=()=>{this.mapSelector.setVisible(!1),this.scene.tweens.killTweensOf(this.mapDot),this.scene.tweens.add({targets:this.mapDot,scale:1,duration:150,ease:"Quad.Out"}),this.mapDot.setTint(10395294)};this.mapDot.on("pointerover",n),this.mapDot.on("pointerout",r),this.mapDot.on("pointerdown",()=>{if(!this.IsDotActive)return;const e="Level"+this.Level;this.scene.sound.stopAll();const t=this.scene.game.scene,s=t.getScenes?t.getScenes(!0):[];for(const t of s){const s=t?.sys?.settings?.key;if(s&&s.startsWith("Level")&&s!==e)try{this.scene.scene.sleep(s)}catch{}}this.scene.scene.start(e)}),this.once(Phaser.GameObjects.Events.DESTROY,()=>{this.mapDot.off("pointerover",n),this.mapDot.off("pointerout",r),this.mapDot.off("pointerdown")})}mapDot;mapSelector;Level=1;IsDotActive=!1;awake(){this.IsDotActive?(console.log("MapDot is active, enabling interactivity."),this.mapDot.setInteractive({useHandCursor:!0}),this.mapDot.setTint(16777215),this.setAlpha(1)):(console.log("MapDot is inactive, disabling interactivity."),this.mapDot.disableInteractive(),this.mapSelector.setVisible(!1))}}class Bi extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"MapPlayer",a),e.add.existing(this)}originalY;floatTween;startFloating(e){let t=e;if(this.originalY=this.originalY??this.y,this.floatTween&&!this.floatTween?.isDestroyed)return;const s=1e3+Phaser.Math.Between(-400,400);Phaser.Math.Between(0,400),this.floatTween=this.scene.tweens.add({targets:this,y:(t??this.originalY)+20,ease:"Sine.InOut",duration:s,yoyo:!0,repeat:-1,delay:500})}destroy(e){if(this.floatTween){try{this.floatTween.stop()}catch{}this.floatTween=void 0}super.destroy(e)}}class Li extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"CatTrackCover",a),this.scene.events.once("scene-awake",()=>this.awake())}TrackToUnlock="Unlock1";radioPreset="Retrowave";CatToUnlock="BigCat1";_onRegChange;pulseTween;isFlipping=!1;hasFlipped=!1;awake(){const e=this.scene.game.registry;if(null==e.get("UnlockedTracks"))try{e.set("UnlockedTracks",JSON.parse(localStorage.getItem("UnlockedTracks")||"[]")||[])}catch{e.set("UnlockedTracks",[])}if(null==e.get("UnlockedAndFliped"))try{e.set("UnlockedAndFliped",JSON.parse(localStorage.getItem("UnlockedAndFliped")||"[]")||[])}catch{e.set("UnlockedAndFliped",[])}null==e.get("HasNewTrack")&&e.set("HasNewTrack",!1),this._onRegChange=(e,t)=>{"HasNewTrack"!==t&&"UnlockedTracks"!==t&&"UnlockedAndFliped"!==t||(this.applyUnlockFX(),this.applyInteractivityByUnlock())},e.events.on("changedata",this._onRegChange,this),this.loadFlippedState(),this.applyUnlockFX(),this.applyInteractivityByUnlock(),this.radioPreset&&"lofi"===this.radioPreset.toLowerCase()&&!this.hasFlipped&&this.revealPresetImmediately(),this.setInteractive({useHandCursor:!0}),this.on("pointerdown",()=>this.onClickFlip()),this.once(Phaser.GameObjects.Events.DESTROY,()=>{e.events.off("changedata",this._onRegChange,this),this._onRegChange=void 0,this.stopPulseFX()})}applyUnlockFX(){if(this.hasFlipped)return void this.stopPulseFX(!0);let e=this.scene.game.registry.get("UnlockedTracks");if(!Array.isArray(e))try{e=JSON.parse(localStorage.getItem("UnlockedTracks")||"[]")}catch{e=[]}Array.isArray(e)&&e.includes(this.TrackToUnlock)?this.startPulseFX():this.stopPulseFX(!0)}isUnlocked(){let e=this.scene.game.registry.get("UnlockedTracks");if(!Array.isArray(e))try{e=JSON.parse(localStorage.getItem("UnlockedTracks")||"[]")}catch{e=[]}return Array.isArray(e)&&e.includes(this.TrackToUnlock)}applyInteractivityByUnlock(){const e=this.isUnlocked();if(this.hasFlipped)return this.setInteractive({useHandCursor:!0}),this.clearTint(),this.setBlendMode(Phaser.BlendModes.NORMAL),void this.setAlpha(1);e?(this.setInteractive({useHandCursor:!0}),this.clearTint(),this.setBlendMode(Phaser.BlendModes.NORMAL),this.setAlpha(1)):(this.disableInteractive(),this.setTint(8026746),this.setAlpha(.6),this.setBlendMode(Phaser.BlendModes.NORMAL),this.stopPulseFX(!0))}loadFlippedState(){try{const e=localStorage.getItem("UnlockedAndFliped"),t=e?JSON.parse(e):[];this.hasFlipped=Array.isArray(t)&&t.includes(this.TrackToUnlock)}catch{this.hasFlipped=!1}this.hasFlipped&&(this.TrackToUnlock&&this.setTexture(this.TrackToUnlock),this.stopPulseFX(!0),this.setInteractive({useHandCursor:!0}),this.setScale(1),this.clearTint(),this.setBlendMode(Phaser.BlendModes.NORMAL),this.setAlpha(1))}persistFlippedState(){try{const e="UnlockedAndFliped",t=localStorage.getItem(e),s=t?JSON.parse(t):[];s.includes(this.TrackToUnlock)||(s.push(this.TrackToUnlock),localStorage.setItem(e,JSON.stringify(s)),this.scene.game.registry.set(e,s))}catch{const e=this.scene.game.registry,t=e.get("UnlockedAndFliped")||[];t.includes(this.TrackToUnlock)||(t.push(this.TrackToUnlock),e.set("UnlockedAndFliped",t))}}revealPresetImmediately(){if(this.hasFlipped=!0,this.TrackToUnlock&&this.setTexture(this.TrackToUnlock),this.stopPulseFX(!0),this.setInteractive({useHandCursor:!0}),this.setScale(1),this.clearTint(),this.setBlendMode(Phaser.BlendModes.NORMAL),this.setAlpha(1),this.persistFlippedState(),this.radioPreset){const e="UnlockedRadioPresets";let t=[];try{t=JSON.parse(localStorage.getItem(e)||"[]"),Array.isArray(t)||(t=[])}catch{t=[]}if(!t.includes(this.radioPreset)){t.push(this.radioPreset);try{localStorage.setItem(e,JSON.stringify(t))}catch{}}this.scene.game.registry.set(e,t)}this.scene.newUnlockText?.setVisible(!1)}startPulseFX(){this.pulseTween&&this.pulseTween.isPlaying()||(this.setBlendMode(Phaser.BlendModes.ADD),this.setTint(16777164),this.setScale(1),this.pulseTween=this.scene.tweens.add({targets:this,scale:1.1,duration:420,yoyo:!0,repeat:-1,ease:"Sine.InOut"}))}stopPulseFX(e=!1){this.pulseTween?.stop(),this.pulseTween=void 0,e&&(this.setScale(1),this.clearTint(),this.setBlendMode(Phaser.BlendModes.NORMAL))}onClickFlip(){if(this.hasFlipped&&this.radioPreset){try{localStorage.setItem("RadioStylePreset",this.radioPreset)}catch{}const e=this.scene.game.registry;return e.set("RequestLoadRadio",this.radioPreset),void(this.TrackToUnlock&&e.set("RequestAlbumTexture",this.CatToUnlock))}this.isFlipping||this.hasFlipped||!this.isUnlocked()||(this.isFlipping=!0,this.stopPulseFX(!0),this.setScale(1,1),this.scene.tweens.add({targets:this,scaleX:0,duration:180,ease:"Cubic.In",onComplete:()=>{this.TrackToUnlock&&this.setTexture(this.TrackToUnlock),this.scene.tweens.add({targets:this,scaleX:1,duration:180,ease:"Cubic.Out",onComplete:()=>{this.isFlipping=!1,this.hasFlipped=!0,this.persistFlippedState(),this.setInteractive({useHandCursor:!0});const e=this.scene;if(e.newUnlockText?.setVisible(!1),this.radioPreset){const e="UnlockedRadioPresets";let t=[];try{t=JSON.parse(localStorage.getItem(e)||"[]"),Array.isArray(t)||(t=[])}catch{t=[]}if(!t.includes(this.radioPreset)){t.push(this.radioPreset);try{localStorage.setItem(e,JSON.stringify(t))}catch{}}this.scene.game.registry.set(e,t);try{localStorage.setItem("RadioStylePreset",this.radioPreset)}catch{}const s=this.scene.game.registry;s.set("RequestLoadRadio",this.radioPreset),this.TrackToUnlock&&s.set("RequestAlbumTexture",this.CatToUnlock)}this.applyInteractivityByUnlock()}})}}))}}class Yi extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"MapBtnOff",a),this.on("pointerover",()=>this.btnHover()),this.on("pointerout",()=>this.btnOut()),this.on("pointerdown",()=>this.btnClick()),this.setInteractive({useHandCursor:!0}),this.scene.events.once(Phaser.Scenes.Events.UPDATE,()=>{this.checkIfClicked(this.IsClicked)},this)}IsClicked=!1;ActivateSection="Map";checkIfClicked(e){console.log("cheking click status in mapbigbtn: ",e),e&&(this.setTint(16777215),this.setTexture("MapBtnOn"))}btnHover(){this.setTint(14540253)}btnOut(){this.setTexture("MapBtnOff"),this.setTint(16777215),this.IsClicked&&(this.setTint(16777215),this.setTexture("MapBtnOn"))}btnClick(){this.IsClicked||(this.IsClicked=!0,this.setTint(16777215),this.setTexture("MapBtnOn"),this.scene.ActivateSection(this.ActivateSection))}unclickBtn(){this.IsClicked=!1,this.setTexture("MapBtnOff"),this.setTint(16777215)}}class Oi extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,t??0,s??0,i||"new_txt",a),this.setVisible(!1);const n=this.y;this._bobTween=e.tweens.add({targets:this,y:n-12,duration:900,ease:"Sine.InOut",yoyo:!0,repeat:-1,delay:Phaser.Math.Between(0,250)})}_bobTween;destroy(e){this._bobTween?.stop(),this._bobTween=void 0,super.destroy(e)}}class Xi extends Phaser.Scene{constructor(){super("Map")}editorCreate(){this.add.image(0,0,"MapBg").setOrigin(0,0),this.add.image(494,323,"MapDeviceBase");const e=this.add.container(143,116),t=this.add.image(237,223,"MapBase");e.add(t);const s=this.add.image(420,277,"MapIsland3");s.scaleX=.485148175624755,s.scaleY=.485148175624755,e.add(s);const i=new Fi(this,251,138);e.add(i);const a=this.add.image(237,228,"MapRoute");a.scaleX=.4839260914617205,a.scaleY=.4839260914617205,e.add(a);const n=this.add.image(-6,114,"MapIsland2");n.scaleX=.4200679672068577,n.scaleY=.4200679672068577,e.add(n);const r=this.add.image(363,330,"MapIsland2");r.scaleX=.4314879593255744,r.scaleY=.4314879593255744,e.add(r);const o=this.add.image(196,105,"MapStar2");e.add(o);const l=this.add.image(163,111,"MapStar2");e.add(l);const h=this.add.image(355,262,"MapStar2");e.add(h);const c=this.add.image(8,271,"MapStar2");e.add(c);const d=this.add.image(74,352,"MapStar2");e.add(d);const u=this.add.image(188,325,"MapStar2");e.add(u);const g=this.add.image(267,198,"MapStar2");e.add(g);const m=new Ei(this,27,196);m.scaleX=.6174998739057824,m.scaleY=.6174998739057824,e.add(m);const p=new Ei(this,67,284);p.scaleX=.6174998739057824,p.scaleY=.6174998739057824,e.add(p);const f=new Ei(this,151,296);f.scaleX=.6174998739057824,f.scaleY=.6174998739057824,e.add(f);const y=new Ei(this,149,193);y.scaleX=.6174998739057824,y.scaleY=.6174998739057824,e.add(y);const w=new Ei(this,220,205);w.scaleX=.6174998739057824,w.scaleY=.6174998739057824,e.add(w);const x=new Ei(this,281,276);x.scaleX=.6174998739057824,x.scaleY=.6174998739057824,e.add(x);const b=new Ei(this,317,188);b.scaleX=.6174998739057824,b.scaleY=.6174998739057824,e.add(b);const v=new Ei(this,381,133);v.scaleX=.6174998739057824,v.scaleY=.6174998739057824,e.add(v);const k=new Ei(this,439,199);k.scaleX=.6174998739057824,k.scaleY=.6174998739057824,e.add(k);const S=new Ei(this,466,294);S.scaleX=.6174998739057824,S.scaleY=.6174998739057824,e.add(S);const C=this.add.image(25,195,"MapDot1");C.scaleX=.5345951773847478,C.scaleY=.5345951773847478,e.add(C);const T=this.add.image(67,282,"MapDot2");T.scaleX=.5482835545204905,T.scaleY=.5482835545204905,e.add(T);const P=this.add.image(151,294,"MapDot3");P.scaleX=.5345951773847478,P.scaleY=.5345951773847478,e.add(P);const A=this.add.image(147,191,"MapDot4");A.scaleX=.5345951773847478,A.scaleY=.5345951773847478,e.add(A);const I=this.add.image(220,201,"MapDot5");I.scaleX=.5345951773847478,I.scaleY=.5345951773847478,e.add(I);const M=this.add.image(281,272,"MapDot6");M.scaleX=.5482835545204905,M.scaleY=.5482835545204905,e.add(M);const R=this.add.image(317,182,"MapDot7");R.scaleX=.5345951773847478,R.scaleY=.5345951773847478,e.add(R);const F=this.add.image(381,129,"MapDot8");F.scaleX=.5345951773847478,F.scaleY=.5345951773847478,e.add(F);const E=this.add.image(441,192,"MapDot9");E.scaleX=.5345951773847478,E.scaleY=.5345951773847478,e.add(E);const B=this.add.image(466,293,"MapDot10");B.scaleX=.5345951773847478,B.scaleY=.5345951773847478,e.add(B);const L=this.add.image(36,325,"MapIsland2");L.scaleX=.41868662442697524,L.scaleY=.41868662442697524,e.add(L);const Y=this.add.image(93,203,"MapIsland");Y.scaleX=.606880368437767,Y.scaleY=.606880368437767,e.add(Y);const O=this.add.image(271,347,"MapIsland");O.scaleX=.606880368437767,O.scaleY=.606880368437767,e.add(O);const X=this.add.image(378,218,"MapIsland");X.scaleX=.606880368437767,X.scaleY=.606880368437767,e.add(X);const D=new Bi(this,26,174);D.scaleX=.5248733321815928,D.scaleY=.5248733321815928,e.add(D);const _=new Fi(this,226,323);_.scaleX=.5493458055294465,_.scaleY=.5493458055294465,e.add(_);const V=new Fi(this,86,168);V.scaleX=.5493458055294465,V.scaleY=.5493458055294465,e.add(V);const U=new Fi(this,462,128);U.scaleX=.5493458055294465,U.scaleY=.5493458055294465,e.add(U);const N=this.add.container(757,261),G=new Li(this,0,0);N.add(G);const W=new Li(this,130,0);N.add(W);const q=new Li(this,260,0);N.add(q);const H=new Li(this,390,0);N.add(H);const z=new Li(this,0,135);N.add(z);const j=new Li(this,130,135);N.add(j);const $=new Li(this,260,135);N.add($);const J=new Li(this,390,135);N.add(J),this.add.image(821,118,"BigCassette"),this.add.image(1124,323,"MapDeviceBase"),this.add.image(821,319,"BasePlayer");const Q=new ti(this,44,46);this.add.existing(Q);const K=new Yi(this,487,136);this.add.existing(K);const Z=new Yi(this,277,136);this.add.existing(Z);const ee=new Oi(this,486,83);this.add.existing(ee),this.add.image(272,136,"world_Txt"),this.add.image(483,134,"unlocks_txt");const te=this.add.image(886,409,"NextBtn");te.scaleX=1.2,te.scaleY=1.2,te.visible=!1;const se=this.add.image(827,409,"PauseBtn");se.scaleX=1.2,se.scaleY=1.2;const ie=this.add.image(766,409,"PrevBtn");ie.scaleX=1.2,ie.scaleY=1.2,ie.visible=!1;const ae=this.add.image(738,339,"SongTimeline");ae.setOrigin(0,.5);const ne=this.add.image(742,339,"SongStatusHandle"),re=this.add.image(821,216,"song1Almbum");this.add.image(821,215,"SongPortrait"),this.add.image(742,319,"VolumeDown"),this.add.image(901,319,"VolumeUp"),this.add.image(754,484,"useLocalText").visible=!1,this.add.image(758,518,"sliderOpBack").visible=!1,this.add.image(725,518,"sliderBtn").visible=!1,m.IsDotActive=!0,p.Level=2,f.Level=3,y.Level=4,w.Level=5,x.Level=6,b.Level=7,v.Level=8,k.Level=9,S.Level=10,G.radioPreset="Lofi",W.TrackToUnlock="Unlock2",W.radioPreset="Synthwave",W.CatToUnlock="BigCat2",q.TrackToUnlock="Unlock3",q.CatToUnlock="BigCat3",H.TrackToUnlock="Unlock4",H.CatToUnlock="BigCat4",z.TrackToUnlock="Unlock5",z.CatToUnlock="BigCat5",j.TrackToUnlock="Unlock6",j.CatToUnlock="BigCat6",$.TrackToUnlock="Unlock7",$.CatToUnlock="BigCat7",J.TrackToUnlock="Unlock8",J.CatToUnlock="BigCat8",K.ActivateSection="Unlocks",Z.IsClicked=!0,Z.ActivateSection="Mundo",this.mapDot1=m,this.mapDot2=p,this.mapDot3=f,this.mapDot4=y,this.mapDot5=w,this.mapDot6=x,this.mapDot7=b,this.mapDot8=v,this.mapDot9=k,this.mapDot10=S,this.mapPlayer=D,this.wholeMap=e,this.unlocks=N,this.mapBigBtn2=K,this.mapBigBtn1=Z,this.newUnlockText=ee,this.nextBtn=te,this.playPauseBtn=se,this.prevBtn=ie,this.volumenSizeBar=ae,this.songVolumenHandle=ne,this.songAlbum=re,this.events.emit("scene-awake")}mapDot1;mapDot2;mapDot3;mapDot4;mapDot5;mapDot6;mapDot7;mapDot8;mapDot9;mapDot10;mapPlayer;wholeMap;unlocks;mapBigBtn2;mapBigBtn1;newUnlockText;nextBtn;playPauseBtn;prevBtn;volumenSizeBar;songVolumenHandle;songAlbum;_lastSceneKey;currentStationUrl;radioAudio;radioLog=[];wholeMapOrigX=0;wholeMapOrigY=0;radioPresets=[];radioPresetIndex=0;create(){this.editorCreate(),this.cameras.main.fadeIn(1200,0,0,0),this.wholeMapOrigX=this.wholeMap.x,this.wholeMapOrigY=this.wholeMap.y,this._lastSceneKey=this.registry.get("LastActiveSceneKey")||this.findUnderlyingActiveSceneKey(),this.prepareRadioElement();const e=this.registry.get("RadioLog");this.radioLog=Array.isArray(e)?e.slice():[],this.registry.set("RadioLog",this.radioLog),this.loadMapState(),this.locatePlayerOnMap(),this.ensureUnlockedRadioPresetsList();const t=(localStorage.getItem("RadioStylePreset")||"").trim();if(t){const e=this.radioPresets.findIndex(e=>e.toLowerCase()===t.toLowerCase());this.radioPresetIndex=e>=0?e:0}else this.radioPresetIndex=0;this.loadRadio(this.radioPresets[this.radioPresetIndex]),this.hookRadioButtons(),this.registry.set("PlayerPaused",this.registry.get("PlayerPaused")??!1);const s=!0===this.registry.get("PlayerPaused");this.playPauseBtn&&this.playPauseBtn.setTexture(s?"PlayBtn":"PauseBtn"),this.registry.events.on("changedata",(e,t,s)=>{if("PlayerPaused"===t){const e=!0===s;e?this.pauseRadio():this.playRadio(),this.playPauseBtn&&this.playPauseBtn.setTexture(e?"PlayBtn":"PauseBtn")}},this),this.initVolumeControls();const i=this.game.registry;(()=>{const e=!0===i.get("HasNewTrack");this.newUnlockText?.setVisible(e)})();const a=(e,t,s)=>{if("UnlockedRadioPresets"===t){const e=Array.isArray(s)?s.slice():this.getUnlockedRadioPresetsFromStorage();this.radioPresets=e,this.radioPresets.length||(this.radioPresets=["Lofi"]);const t=(localStorage.getItem("RadioStylePreset")||"").trim(),i=t?this.radioPresets.findIndex(e=>e.toLowerCase()===t.toLowerCase()):-1;this.radioPresetIndex=i>=0?i:0,this.loadRadio(this.radioPresets[this.radioPresetIndex]),this.logRadio(`Presets updated: ${this.radioPresets.join(", ")}`)}if("HasNewTrack"===t){const e=!0===s;this.newUnlockText?.setVisible(e)}if("PlayerPaused"===t){const e=!0===s;e?this.pauseRadio():this.playRadio(),this.playPauseBtn?.setTexture(e?"PlayBtn":"PauseBtn")}if("RequestLoadRadio"===t&&"string"==typeof s&&s.length){const e=this.radioPresets.findIndex(e=>e.toLowerCase()===s.toLowerCase());e>=0&&(this.radioPresetIndex=e);try{localStorage.setItem("RadioStylePreset",s)}catch{}this.registry.set("RadioStyle",s),this.loadRadio(s),this.logRadio(`Style selected: ${s}`)}"RequestAlbumTexture"===t&&"string"==typeof s&&s.length&&this.songAlbum?.setTexture(s)};i.events.on("changedata",a,this),this.events.once(Phaser.Scenes.Events.SHUTDOWN,()=>{i.events.off("changedata",a,this)})}getUnlockedRadioPresetsFromStorage(){try{const e=JSON.parse(localStorage.getItem("UnlockedRadioPresets")||"[]"),t=Array.isArray(e)?e:[];return t.length?t:["Lofi"]}catch{return["Lofi"]}}initVolumeControls(){if(!this.songVolumenHandle||!this.volumenSizeBar)return;this.volumenSizeBar.setOrigin(0,.5);const e=this.volumenSizeBar.x,t=e+this.volumenSizeBar.displayWidth,s=this.volumenSizeBar.y;let i=.8;try{const e=localStorage.getItem("MusicVolume");null!==e&&(i=Phaser.Math.Clamp(parseFloat(e),0,1))}catch{}this.setRadioVolume(i),this.songVolumenHandle.x=Phaser.Math.Linear(e,t,i),this.songVolumenHandle.y=s,this.songVolumenHandle.setInteractive({useHandCursor:!0,draggable:!0}),this.input.setDraggable(this.songVolumenHandle,!0),this.songVolumenHandle.on("drag",(i,a,n)=>{const r=Phaser.Math.Clamp(a,e,t);this.songVolumenHandle.x=r,this.songVolumenHandle.y=s;const o=(r-e)/(t-e);this.setRadioVolume(o)}),this.volumenSizeBar.setInteractive({useHandCursor:!0}),this.volumenSizeBar.on("pointerdown",i=>{const a=Phaser.Math.Clamp(i.x,e,t);this.songVolumenHandle.x=a,this.songVolumenHandle.y=s;const n=(a-e)/(t-e);this.setRadioVolume(n)}),this.input.keyboard?.on("keydown-LEFT",()=>{const i=Phaser.Math.Clamp(this.getRadioVolume()-.05,0,1);this.applyVolumeToUI(i,e,t,s)}),this.input.keyboard?.on("keydown-RIGHT",()=>{const i=Phaser.Math.Clamp(this.getRadioVolume()+.05,0,1);this.applyVolumeToUI(i,e,t,s)})}setRadioVolume(e){e=Phaser.Math.Clamp(e,0,1),this.radioAudio&&(this.radioAudio.volume=e);try{localStorage.setItem("MusicVolume",String(e))}catch{}this.registry.set("MusicVolume",e)}getRadioVolume(){return this.radioAudio?this.radioAudio.volume:this.registry.get("MusicVolume")??1}applyVolumeToUI(e,t,s,i){this.setRadioVolume(e),this.songVolumenHandle.x=Phaser.Math.Linear(t,s,e),this.songVolumenHandle.y=i}logRadio(e){const t=`[Radio] ${e}`;console.log(t),this.radioLog.push(t),this.radioLog.length>100&&this.radioLog.shift(),this.registry.set("RadioLog",this.radioLog)}locatePlayerOnMap(){let e,t=1;for(let s=1;s<=10;s++){const i=this.getMapDot(s);i&&i.IsDotActive&&(e=i,t=s)}if(e)this.mapPlayer.x=e.x,this.mapPlayer.y=e.y-20,console.log(`Player located on MapDot for level ${t}`),this.mapPlayer.startFloating(e.y);else{console.warn("No active MapDot found, defaulting to level 1");const e=this.getMapDot(1);e&&(this.mapPlayer.x=e.x,this.mapPlayer.y=e.y-20,this.mapPlayer.startFloating(e.y))}}loadMapState(){let e=1;try{const t=localStorage.getItem("PlayerMaxLevel");e=t?Math.max(1,Number(t)):1}catch{const t=this.registry.get("PlayerMaxLevel");"number"==typeof t&&(e=Math.max(1,t))}try{this.registry.set("PlayerMaxLevel",e)}catch{}console.log(`PlayerMaxLevel (localStorage): ${e}`);for(let t=1;t<=10;t++){const s=this.getMapDot(t);s&&(s.IsDotActive=t<=e,s.awake())}}getMapDot(e){switch(e){case 1:return this.mapDot1;case 2:return this.mapDot2;case 3:return this.mapDot3;case 4:return this.mapDot4;case 5:return this.mapDot5;case 6:return this.mapDot6;case 7:return this.mapDot7;case 8:return this.mapDot8;case 9:return this.mapDot9;case 10:return this.mapDot10;default:return}}toggleMapOverlay(){this.closeToTopAndResume()}closeToTopAndResume(){const e=this.scale.height,t=this.cameras.main;this.tweens.add({targets:t,y:-e,duration:350,ease:"Cubic.In",onComplete:()=>{this.input.enabled=!1;const e=this.registry.get("LastActiveSceneKey")||this.findUnderlyingActiveSceneKey();if(e){this.scene.resume(e);const t=this.scene.get(e);try{t.physics?.world?.resume?.()}catch{}try{t.input.enabled=!0}catch{}this.scene.bringToTop(e)}this.scene.sendToBack(this.scene.key)}})}findUnderlyingActiveSceneKey(){const e=this.scene.manager||this.game.scene,t=(e.getScenes?e.getScenes(!0):e.scenes)||[];for(let e=t.length-1;e>=0;e--){const s=t[e];if(s&&s.sys&&s.sys.settings&&"Map"!==s.sys.settings.key&&s.sys.isActive())return s.sys.settings.key}}prepareRadioElement(){this.radioAudio||(this.radioAudio=document.createElement("audio"),this.radioAudio.id="radioPlayer",this.radioAudio.style.position="absolute",this.radioAudio.style.left="-9999px",this.radioAudio.style.width="1px",this.radioAudio.style.height="1px",this.radioAudio.autoplay=!1,this.radioAudio.controls=!1,document.body.appendChild(this.radioAudio))}loadRadio(e){const t=e.replace(/\b\w/g,e=>e.toUpperCase());this.registry.set("RadioStyle",t),this.logRadio(`Loading music style: ${t}...`);const s=["https://de1.api.radio-browser.info","https://de2.api.radio-browser.info","https://nl1.api.radio-browser.info","https://fr1.api.radio-browser.info"],i=a=>{if(a>=s.length)return void this.fallbackToLocalTrack(`All mirrors failed for ${e}`);const n=s[a],r=`${n}/json/stations/search?name=${encodeURIComponent(e)}&limit=1`;this.logRadio(`Trying mirror ${n} ...`),fetch(r).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json()}).then(s=>{if(Array.isArray(s)&&s.length){const e=s[0];if(this.currentStationUrl=e.url_resolved,this.logRadio(`Station loaded from ${n}: ${e.name}`),!this.radioAudio||!this.currentStationUrl)return;this.radioAudio.src!==this.currentStationUrl&&(this.radioAudio.src=this.currentStationUrl);const i=()=>this.logRadio(`Now playing ${t}`);try{this.radioAudio.addEventListener("playing",i,{once:!0}),this.radioAudio.addEventListener("canplay",i,{once:!0})}catch{}const a=this.radioAudio.play();a&&a.catch(e=>this.logRadio(`Autoplay blocked: ${e?.message||e}`))}else this.logRadio(`No station found for: ${e} on ${n}`),i(a+1)}).catch(t=>{this.logRadio(`Error on ${n} for ${e}: ${t?.message||t}`),i(a+1)})};i(0)}fallbackToLocalTrack(e){this.logRadio(`Falling back to local track (music1). Reason: ${e}`),this.radioAudio||this.prepareRadioElement();const t="assets/music/music1.mp3";if(this.currentStationUrl=t,!this.radioAudio)return;this.radioAudio.loop=!0,this.radioAudio.src!==t&&(this.radioAudio.src=t),this.radioAudio.volume=this.getRadioVolume();const s=this.radioAudio.play();s&&s.catch(e=>this.logRadio(`Autoplay blocked (fallback): ${e?.message||e}`))}pauseRadio(){this.radioAudio&&(this.radioAudio.pause(),this.logRadio("Paused"))}playRadio(){if(!this.radioAudio||!this.currentStationUrl)return;this.radioAudio.src!==this.currentStationUrl&&(this.radioAudio.src=this.currentStationUrl);const e=this.radioAudio.play();e&&e.catch(e=>this.logRadio(`Autoplay blocked: ${e?.message||e}`)),this.logRadio("Play requested")}ensureUnlockedRadioPresetsList(){let e=[];try{const t=localStorage.getItem("UnlockedRadioPresets");e=t?JSON.parse(t):[],Array.isArray(e)||(e=[])}catch{e=[]}0!==e.length&&e.includes("Lofi")||(e=["Lofi",...e.filter(e=>"Lofi"!==e)]),this.radioPresets=e;try{localStorage.setItem("UnlockedRadioPresets",JSON.stringify(e))}catch{}this.game.registry.set("UnlockedRadioPresets",e)}hookRadioButtons(){this.playPauseBtn&&(this.playPauseBtn.setInteractive({useHandCursor:!0}),this.playPauseBtn.on("pointerdown",()=>{this.radioAudio&&(this.radioAudio.paused?(this.playRadio(),this.playPauseBtn.setTexture("PauseBtn")):(this.pauseRadio(),this.playPauseBtn.setTexture("PlayBtn")))})),this.nextBtn&&(this.nextBtn.setInteractive({useHandCursor:!0}),this.nextBtn.on("pointerdown",()=>{this.advancePreset(1)})),this.prevBtn&&(this.prevBtn.setInteractive({useHandCursor:!0}),this.prevBtn.on("pointerdown",()=>{this.advancePreset(-1)}))}advancePreset(e){if(!this.radioPresets.length)return;this.radioPresetIndex=(this.radioPresetIndex+e+this.radioPresets.length)%this.radioPresets.length;const t=this.radioPresets[this.radioPresetIndex];try{localStorage.setItem("RadioStylePreset",t)}catch{}this.registry.set("RadioStyle",t),this.loadRadio(t),this.logRadio(`Style selected: ${t}`)}ActivateSection(e){switch(console.log("Map button will activate section: "+e),e){case"Mundo":this.mapBigBtn2.unclickBtn(),this.ActivateMundoSection();break;case"Unlocks":this.mapBigBtn1.unclickBtn(),this.ActivateUnlocksSection();break;default:console.warn("Unknown section: "+e)}}ActivateMundoSection(){console.log("Activating Mundo Section"),this.tweens.add({targets:this.wholeMap,x:this.wholeMapOrigX,duration:550,ease:"Cubic.Out"}),this.tweens.add({targets:this.unlocks,x:757,duration:550,ease:"Cubic.Out"})}ActivateUnlocksSection(){console.log("Activating Unlocks Section"),this.tweens.add({targets:this.wholeMap,x:this.wholeMap.x+600,duration:550,ease:"Cubic.Out"}),this.tweens.add({targets:this.unlocks,x:this.unlocks.x-570,duration:550,ease:"Cubic.Out"})}}const Di=s.p+"asset-packs/preload-asset-pack-28f690cb2a1516ac56a7.json",_i=s.p+"asset-packs/asset-pack-fee3001cfd2c5d7bf4fd.json";class Vi extends Phaser.Scene{constructor(){super("Preload")}editorCreate(){const e=.5*this.scale.width,t=.5*this.scale.height,s=Math.min(.55*this.scale.width,360),i=7032485,a=this.add.rectangle(e,t,s,28);a.setOrigin(.5,.5),a.isFilled=!0,a.fillColor=0,a.fillAlpha=.15,a.isStroked=!0,a.strokeColor=i,a.lineWidth=4;const n=this.add.rectangle(e-.5*s,t,s,28);n.setOrigin(0,.5),n.isFilled=!0,n.fillColor=13206212,n.isStroked=!0,n.strokeColor=i,n.lineWidth=2;const r=this.add.text(e,t-40,"",{});r.text="Loading...",r.setOrigin(.5,.5),r.setStyle({color:"#e0e0e0",fontFamily:"arial",fontSize:"22px",fontStyle:"bold"}),this.progressBar=n,this.progressBarBg=a,this.loadingText=r,this.events.emit("scene-awake")}progressBar;progressBarBg;loadingText;preload(){this.editorCreate(),this.load.pack("asset-pack",_i);const e=this.progressBar.width;this.load.on("progress",t=>{this.progressBar.width=e*t})}create(){this.scene.start("TitleScene")}}class Ui extends a().Scene{constructor(){super("Boot")}preload(){this.load.pack("pack",Di)}create(){this.scene.start("Preload")}}window.addEventListener("load",function(){new(a().Game)({type:a().WEBGL,width:1031,height:580,backgroundColor:"#6B5CB4",roundPixels:!0,antialias:!0,scale:{mode:a().Scale.ScaleModes.FIT,autoCenter:a().Scale.Center.CENTER_BOTH},plugins:{scene:[{key:"spine.SpinePlugin",plugin:Hs,mapping:"spine"}]},physics:{default:"arcade",arcade:{debug:!1}},fps:{target:60},scene:[Ui,Vi,Ri,ii,Xi,li,pi,yi,wi,vi,Ci,Ti,Pi,Ai,Mi]}).scene.start("Boot")})}},a={};function n(e){var t=a[e];if(void 0!==t){if(void 0!==t.error)throw t.error;return t.exports}var s=a[e]={exports:{}};try{var r={id:e,module:s,factory:i[e],require:n};n.i.forEach(function(e){e(r)}),s=r.module,r.factory.call(s.exports,s,s.exports,r.require)}catch(e){throw s.error=e,e}return s.exports}n.m=i,n.c=a,n.i=[],e=[],n.O=(t,s,i,a)=>{if(!s){var r=1/0;for(c=0;c<e.length;c++){for(var[s,i,a]=e[c],o=!0,l=0;l<s.length;l++)(!1&a||r>=a)&&Object.keys(n.O).every(e=>n.O[e](s[l]))?s.splice(l--,1):(o=!1,a<r&&(r=a));if(o){e.splice(c--,1);var h=i();void 0!==h&&(t=h)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[s,i,a]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.hu=e=>e+"."+n.h()+".hot-update.js",n.hmrF=()=>"main."+n.h()+".hot-update.json",n.h=()=>"1e50744821011a994582",n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},s="phaser3-webpack-template:",n.l=(e,i,a,r)=>{if(t[e])t[e].push(i);else{var o,l;if(void 0!==a)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var d=h[c];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==s+a){o=d;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",s+a),o.src=e),t[e]=[i];var u=(s,i)=>{o.onerror=o.onload=null,clearTimeout(g);var a=t[e];if(delete t[e],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach(e=>e(i)),s)return s(i)},g=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},(()=>{var e,t,s,i={},a=n.c,r=[],o=[],l="idle",h=0,c=[];function d(e){l=e;for(var t=[],s=0;s<o.length;s++)t[s]=o[s].call(null,e);return Promise.all(t).then(function(){})}function u(){0===--h&&d("ready").then(function(){if(0===h){var e=c;c=[];for(var t=0;t<e.length;t++)e[t]()}})}function g(e){if("idle"!==l)throw new Error("check() is only allowed in idle status");return d("check").then(n.hmrM).then(function(s){return s?d("prepare").then(function(){var i=[];return t=[],Promise.all(Object.keys(n.hmrC).reduce(function(e,a){return n.hmrC[a](s.c,s.r,s.m,e,t,i),e},[])).then(function(){return t=function(){return e?p(e):d("ready").then(function(){return i})},0===h?t():new Promise(function(e){c.push(function(){e(t())})});var t})}):d(f()?"ready":"idle").then(function(){return null})})}function m(e){return"ready"!==l?Promise.resolve().then(function(){throw new Error("apply() is only allowed in ready status (state: "+l+")")}):p(e)}function p(e){e=e||{},f();var i=t.map(function(t){return t(e)});t=void 0;var a=i.map(function(e){return e.error}).filter(Boolean);if(a.length>0)return d("abort").then(function(){throw a[0]});var n=d("dispose");i.forEach(function(e){e.dispose&&e.dispose()});var r,o=d("apply"),l=function(e){r||(r=e)},h=[];return Promise.all(i.filter(function(e){return e.apply}).map(function(e){return e.apply(l)})).then(function(e){e.forEach(function(e){if(e)for(var t=0;t<e.length;t++)h.push(e[t])})}).then(function(){return Promise.all([n,o]).then(function(){return r?d("fail").then(function(){throw r}):s?p(e).then(function(e){return h.forEach(function(t){e.indexOf(t)<0&&e.push(t)}),e}):d("idle").then(function(){return h})})})}function f(){if(s)return t||(t=[]),Object.keys(n.hmrI).forEach(function(e){s.forEach(function(s){n.hmrI[e](s,t)})}),s=void 0,!0}n.hmrD=i,n.i.push(function(c){var p,f,y,w,x=c.module,b=function(t,s){var i=a[s];if(!i)return t;var n=function(n){if(i.hot.active){if(a[n]){var o=a[n].parents;-1===o.indexOf(s)&&o.push(s)}else r=[s],e=n;-1===i.children.indexOf(n)&&i.children.push(n)}else console.warn("[HMR] unexpected require("+n+") from disposed module "+s),r=[];return t(n)},o=function(e){return{configurable:!0,enumerable:!0,get:function(){return t[e]},set:function(s){t[e]=s}}};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&"e"!==c&&Object.defineProperty(n,c,o(c));return n.e=function(e,s){return function(e){switch(l){case"ready":d("prepare");case"prepare":return h++,e.then(u,u),e;default:return e}}(t.e(e,s))},n}(c.require,c.id);x.hot=(p=c.id,f=x,w={_acceptedDependencies:{},_acceptedErrorHandlers:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:y=e!==p,_requireSelf:function(){r=f.parents.slice(),e=y?void 0:p,n(p)},active:!0,accept:function(e,t,s){if(void 0===e)w._selfAccepted=!0;else if("function"==typeof e)w._selfAccepted=e;else if("object"==typeof e&&null!==e)for(var i=0;i<e.length;i++)w._acceptedDependencies[e[i]]=t||function(){},w._acceptedErrorHandlers[e[i]]=s;else w._acceptedDependencies[e]=t||function(){},w._acceptedErrorHandlers[e]=s},decline:function(e){if(void 0===e)w._selfDeclined=!0;else if("object"==typeof e&&null!==e)for(var t=0;t<e.length;t++)w._declinedDependencies[e[t]]=!0;else w._declinedDependencies[e]=!0},dispose:function(e){w._disposeHandlers.push(e)},addDisposeHandler:function(e){w._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=w._disposeHandlers.indexOf(e);t>=0&&w._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,l){case"idle":t=[],Object.keys(n.hmrI).forEach(function(e){n.hmrI[e](p,t)}),d("ready");break;case"ready":Object.keys(n.hmrI).forEach(function(e){n.hmrI[e](p,t)});break;case"prepare":case"check":case"dispose":case"apply":(s=s||[]).push(p)}},check:g,apply:m,status:function(e){if(!e)return l;o.push(e)},addStatusHandler:function(e){o.push(e)},removeStatusHandler:function(e){var t=o.indexOf(e);t>=0&&o.splice(t,1)},data:i[p]},e=void 0,w),x.parents=r,x.children=[],r=[],c.require=b}),n.hmrC={},n.hmrI={}})(),n.p="./",(()=>{var e,t,s,i,a,r=n.hmrS_jsonp=n.hmrS_jsonp||{792:0},o={};function l(t,s){return e=s,new Promise((e,s)=>{o[t]=e;var i=n.p+n.hu(t),a=new Error;n.l(i,e=>{if(o[t]){o[t]=void 0;var i=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src;a.message="Loading hot update chunk "+t+" failed.\n("+i+": "+n+")",a.name="ChunkLoadError",a.type=i,a.request=n,s(a)}})})}function h(e){function o(e){for(var t=[e],s={},i=t.map(function(e){return{chain:[e],id:e}});i.length>0;){var a=i.pop(),r=a.id,o=a.chain,h=n.c[r];if(h&&(!h.hot._selfAccepted||h.hot._selfInvalidated)){if(h.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:r};if(h.hot._main)return{type:"unaccepted",chain:o,moduleId:r};for(var c=0;c<h.parents.length;c++){var d=h.parents[c],u=n.c[d];if(u){if(u.hot._declinedDependencies[r])return{type:"declined",chain:o.concat([d]),moduleId:r,parentId:d};-1===t.indexOf(d)&&(u.hot._acceptedDependencies[r]?(s[d]||(s[d]=[]),l(s[d],[r])):(delete s[d],t.push(d),i.push({chain:o.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:s}}function l(e,t){for(var s=0;s<t.length;s++){var i=t[s];-1===e.indexOf(i)&&e.push(i)}}n.f&&delete n.f.jsonpHmr,t=void 0;var h={},c=[],d={},u=function(e){console.warn("[HMR] unexpected require("+e.id+") to disposed module")};for(var g in s)if(n.o(s,g)){var m=s[g],p=m?o(g):{type:"disposed",moduleId:g},f=!1,y=!1,w=!1,x="";switch(p.chain&&(x="\nUpdate propagation: "+p.chain.join(" -> ")),p.type){case"self-declined":e.onDeclined&&e.onDeclined(p),e.ignoreDeclined||(f=new Error("Aborted because of self decline: "+p.moduleId+x));break;case"declined":e.onDeclined&&e.onDeclined(p),e.ignoreDeclined||(f=new Error("Aborted because of declined dependency: "+p.moduleId+" in "+p.parentId+x));break;case"unaccepted":e.onUnaccepted&&e.onUnaccepted(p),e.ignoreUnaccepted||(f=new Error("Aborted because "+g+" is not accepted"+x));break;case"accepted":e.onAccepted&&e.onAccepted(p),y=!0;break;case"disposed":e.onDisposed&&e.onDisposed(p),w=!0;break;default:throw new Error("Unexception type "+p.type)}if(f)return{error:f};if(y)for(g in d[g]=m,l(c,p.outdatedModules),p.outdatedDependencies)n.o(p.outdatedDependencies,g)&&(h[g]||(h[g]=[]),l(h[g],p.outdatedDependencies[g]));w&&(l(c,[p.moduleId]),d[g]=u)}s=void 0;for(var b,v=[],k=0;k<c.length;k++){var S=c[k],C=n.c[S];C&&(C.hot._selfAccepted||C.hot._main)&&d[S]!==u&&!C.hot._selfInvalidated&&v.push({module:S,require:C.hot._requireSelf,errorHandler:C.hot._selfAccepted})}return{dispose:function(){var e;i.forEach(function(e){delete r[e]}),i=void 0;for(var t,s=c.slice();s.length>0;){var a=s.pop(),o=n.c[a];if(o){var l={},d=o.hot._disposeHandlers;for(k=0;k<d.length;k++)d[k].call(null,l);for(n.hmrD[a]=l,o.hot.active=!1,delete n.c[a],delete h[a],k=0;k<o.children.length;k++){var u=n.c[o.children[k]];u&&(e=u.parents.indexOf(a))>=0&&u.parents.splice(e,1)}}}for(var g in h)if(n.o(h,g)&&(o=n.c[g]))for(b=h[g],k=0;k<b.length;k++)t=b[k],(e=o.children.indexOf(t))>=0&&o.children.splice(e,1)},apply:function(t){var s=[];for(var i in d)n.o(d,i)&&(n.m[i]=d[i]);for(var r=0;r<a.length;r++)a[r](n);for(var o in h)if(n.o(h,o)){var l=n.c[o];if(l){b=h[o];for(var u=[],g=[],m=[],p=0;p<b.length;p++){var f=b[p],y=l.hot._acceptedDependencies[f],w=l.hot._acceptedErrorHandlers[f];if(y){if(-1!==u.indexOf(y))continue;u.push(y),g.push(w),m.push(f)}}for(var x=0;x<u.length;x++){var k;try{k=u[x].call(null,b)}catch(s){if("function"==typeof g[x])try{g[x](s,{moduleId:o,dependencyId:m[x]})}catch(i){e.onErrored&&e.onErrored({type:"accept-error-handler-errored",moduleId:o,dependencyId:m[x],error:i,originalError:s}),e.ignoreErrored||(t(i),t(s))}else e.onErrored&&e.onErrored({type:"accept-errored",moduleId:o,dependencyId:m[x],error:s}),e.ignoreErrored||t(s)}k&&"function"==typeof k.then&&s.push(k)}}}return Promise.all(s).then(function(){for(var s=0;s<v.length;s++){var i=v[s],a=i.module;try{i.require(a)}catch(s){if("function"==typeof i.errorHandler)try{i.errorHandler(s,{moduleId:a,module:n.c[a]})}catch(i){e.onErrored&&e.onErrored({type:"self-accept-error-handler-errored",moduleId:a,error:i,originalError:s}),e.ignoreErrored||(t(i),t(s))}else e.onErrored&&e.onErrored({type:"self-accept-errored",moduleId:a,error:s}),e.ignoreErrored||t(s)}}}).then(function(){return c})}}}self.webpackHotUpdatephaser3_webpack_template=(t,i,r)=>{for(var l in i)n.o(i,l)&&(s[l]=i[l],e&&e.push(l));r&&a.push(r),o[t]&&(o[t](),o[t]=void 0)},n.hmrI.jsonp=function(e,t){s||(s={},a=[],i=[],t.push(h)),n.o(s,e)||(s[e]=n.m[e])},n.hmrC.jsonp=function(e,o,c,d,u,g){u.push(h),t={},i=o,s=c.reduce(function(e,t){return e[t]=!1,e},{}),a=[],e.forEach(function(e){n.o(r,e)&&void 0!==r[e]?(d.push(l(e,g)),t[e]=!0):t[e]=!1}),n.f&&(n.f.jsonpHmr=function(e,s){t&&n.o(t,e)&&!t[e]&&(s.push(l(e)),t[e]=!0)})},n.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(n.p+n.hmrF()).then(e=>{if(404!==e.status){if(!e.ok)throw new Error("Failed to fetch update manifest "+e.statusText);return e.json()}})},n.O.j=e=>0===r[e];var c=(e,t)=>{var s,i,[a,o,l]=t,h=0;if(a.some(e=>0!==r[e])){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)var c=l(n)}for(e&&e(t);h<a.length;h++)i=a[h],n.o(r,i)&&r[i]&&r[i][0](),r[i]=0;return n.O(c)},d=self.webpackChunkphaser3_webpack_template=self.webpackChunkphaser3_webpack_template||[];d.forEach(c.bind(null,0)),d.push=c.bind(null,d.push.bind(d))})();var r=n.O(void 0,[418],()=>n(792));r=n.O(r)})();